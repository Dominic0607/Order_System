import{r as c,A as xe,j as e,c as C,S as ie,L as Se,W as me,M as Ce,u as Pe}from"./index-BM8GdCfH.js";import{M as Ie,B as Le,T as De,a as Me,S as Te,b as $e,c as Oe}from"./TelegramScheduler-BnraIUtC.js";const Fe=({orders:w,onEdit:v,showActions:X,visibleColumns:x,selectedIds:L=new Set,onToggleSelect:k,onToggleSelectAll:R})=>{const{appData:f,refreshData:M,previewImage:J}=c.useContext(xe),[B,D]=c.useState(null),[a,y]=c.useState(new Set),[z,$]=c.useState(w);c.useEffect(()=>{$(w)},[w]);const u=t=>t==="actions"&&!X?!1:!x||x.has(t),U=w.length>0&&w.every(t=>L.has(t["Order ID"])),W=async(t,p)=>{const h=!p;$(m=>m.map(g=>g["Order ID"]===t?{...g,IsVerified:h}:g)),y(m=>new Set(m).add(t));try{if(!(await fetch(`${me}/api/admin/update-sheet`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sheetName:"AllOrders",primaryKey:{"Order ID":t},newData:{IsVerified:h}})})).ok)throw new Error("Failed to save");M()}catch(m){console.error("Verification toggle failed:",m),$(g=>g.map(j=>j["Order ID"]===t?{...j,IsVerified:p}:j)),alert("រក្សាទុកស្ថានភាពមិនបានសម្រេច!")}finally{y(m=>{const g=new Set(m);return g.delete(t),g})}},O=t=>{let p=(t||"").replace(/[^0-9]/g,"");return p.length>0&&(p="0"+p.replace(/^0+/,"")),p},q=t=>{navigator.clipboard.writeText(t),D(t),setTimeout(()=>D(null),2e3)},K=t=>{if(!t)return;const p=O(t["Customer Phone"]),h=new URLSearchParams({id:t["Order ID"],name:t["Customer Name"]||"",phone:p,location:t.Location||"",address:t["Address Details"]||"",total:(t["Grand Total"]||0).toString(),payment:t["Payment Status"]||"Unpaid",shipping:t["Internal Shipping Method"]||"N/A",page:t.Page||"",user:t.User||""}),g=(t.Note||"").match(/https?:\/\/(www\.)?(google\.com\/maps|maps\.app\.goo\.gl)\/[^\s]+/);g&&h.set("map",g[0]),window.open(`${Se}?${h.toString()}`,"_blank")},_=t=>{if(!t||!f.phoneCarriers)return null;const h=t.replace(/\s/g,"").substring(0,3),m=f.phoneCarriers.find(g=>g.Prefixes.split(",").map(j=>j.trim()).includes(h));return m?C(m.CarrierLogoURL):null},b=t=>{if(!t||!f.shippingMethods)return null;const p=f.shippingMethods.find(h=>h.MethodName===t);return p?C(p.LogosURL):null};return e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsxs("div",{className:"flex-grow space-y-4",children:[e.jsx("div",{className:"hidden md:block page-card !p-0 shadow-2xl border-gray-700/50 min-h-[1500px] overflow-visible",children:e.jsxs("table",{className:"admin-table w-full border-collapse",style:{tableLayout:"fixed"},children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800/80 border-b border-gray-700",children:[R&&e.jsx("th",{className:"px-4 py-4 w-12 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 rounded border-gray-600 bg-gray-900 text-blue-500 cursor-pointer",checked:U,onChange:()=>R(w.map(t=>t["Order ID"]))})}),u("index")&&e.jsx("th",{className:"px-4 py-4 text-xs font-black uppercase tracking-wider text-center text-gray-400 w-12",children:"#"}),u("orderId")&&e.jsx("th",{className:"px-2 py-4 text-xs font-black uppercase tracking-wider text-center text-gray-400 w-16",children:"ID"}),u("customerName")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-44",children:"ឈ្មោះអតិថិជន"}),u("productInfo")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-36",children:"ព័ត៌មាន Product"}),u("location")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-48",children:"ទីតាំង"}),u("pageInfo")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-40",children:"Page"}),u("total")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-28",children:"សរុបទឹកប្រាក់"}),u("shippingService")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-44",children:"សេវាដឹក"}),u("shippingCost")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-24",children:"តម្លៃដឹកដើម"}),u("status")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-28",children:"ស្ថានភាព"}),u("date")&&e.jsx("th",{className:"px-5 py-4 text-xs font-black uppercase tracking-wider text-left text-gray-400 w-32",children:"កាលបរិច្ឆេទ"}),u("print")&&e.jsx("th",{className:"px-4 py-4 text-xs font-black uppercase tracking-wider text-center text-gray-400 w-16",children:"ព្រីន"}),u("actions")&&e.jsx("th",{className:"px-4 py-4 text-xs font-black uppercase tracking-wider text-center text-gray-400 w-24",children:"សកម្មភាព"}),u("check")&&e.jsx("th",{className:"px-4 py-4 text-xs font-black uppercase tracking-wider text-center text-emerald-500 w-16",children:"Verified"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700/50",children:z.map((t,p)=>{var Q;const h=(Q=f.pages)==null?void 0:Q.find(S=>S.PageName===t.Page),m=h?C(h.PageLogoURL):"",g=O(t["Customer Phone"]),j=_(g),P=B===t["Order ID"],E=b(t["Internal Shipping Method"]),V=t["Order ID"],H=t.IsVerified===!0||String(t.IsVerified).toUpperCase()==="TRUE",se=a.has(V),Y=L.has(V),I=p>z.length-3&&z.length>4,ae=I?"bottom-full mb-3":"top-full mt-3",T=I?"-bottom-2 border-r border-b":"-top-2 border-t border-l";return e.jsxs("tr",{className:`${H?"bg-emerald-500/5":Y?"bg-blue-500/10":"hover:bg-gray-700/20"} transition-all group relative`,children:[k&&e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("input",{type:"checkbox",className:"h-5 w-5 rounded border-gray-600 bg-gray-900 text-blue-500 cursor-pointer",checked:Y,onChange:()=>k(V)})}),u("index")&&e.jsx("td",{className:"px-4 py-4 text-center text-xs font-bold text-gray-500",children:p+1}),u("orderId")&&e.jsx("td",{className:"px-2 py-4 text-center",children:e.jsx("button",{onClick:()=>q(t["Order ID"]),className:`p-2 rounded-lg transition-all border ${P?"bg-green-500/20 border-green-500/40 text-green-400":"bg-gray-800 border-gray-700 text-gray-400 hover:text-blue-400"}`,children:e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:P?"✓":"ID"})})}),u("customerName")&&e.jsxs("td",{className:"px-5 py-4",children:[e.jsx("div",{className:"font-bold text-gray-100 truncate mb-1",children:t["Customer Name"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[j&&e.jsx("img",{src:j,className:"w-4 h-4 object-contain",alt:"carrier"}),e.jsx("div",{className:"text-[11px] text-gray-400 font-mono tracking-tighter",children:g})]})]}),u("productInfo")&&e.jsx("td",{className:"px-5 py-4 relative overflow-visible",children:e.jsxs("div",{className:"group/prod flex flex-col gap-1 cursor-help",children:[t.Products.slice(0,2).map((S,A)=>e.jsxs("div",{className:"text-[11px] bg-gray-900/50 p-1.5 rounded border border-white/5 flex flex-col",children:[e.jsx("span",{className:"font-black text-gray-200 line-clamp-1",children:S.name}),e.jsx("div",{className:"flex justify-between items-center mt-0.5",children:e.jsxs("span",{className:"text-blue-400 font-bold",children:["Qty: ",S.quantity]})})]},A)),t.Products.length>2&&e.jsxs("p",{className:"text-[9px] text-gray-500 font-bold ml-1",children:["+ ",t.Products.length-2," items more..."]}),e.jsxs("div",{className:`invisible group-hover/prod:visible opacity-0 group-hover/prod:opacity-100 absolute z-[200] left-1/2 -translate-x-1/2 ${ae} w-80 p-5 bg-gray-800 border border-gray-600 rounded-[2rem] shadow-[0_25px_60px_rgba(0,0,0,0.7)] transition-all duration-300 pointer-events-none`,children:[e.jsx("p",{className:"text-[10px] font-black text-blue-400 uppercase tracking-[0.2em] mb-4 border-b border-white/5 pb-3",children:"ព័ត៌មានទំនិញពេញលេញ"}),e.jsx("div",{className:"space-y-3 max-h-[350px] overflow-y-auto custom-scrollbar pr-1",children:t.Products.map((S,A)=>{var le;const re=(le=f.products)==null?void 0:le.find(Z=>Z.ProductName===S.name),ce=S.image||(re==null?void 0:re.ImageURL)||"";return e.jsxs("div",{className:"flex items-center gap-4 text-left p-2 bg-black/20 rounded-2xl border border-white/5",children:[e.jsx("div",{className:"w-14 h-14 flex-shrink-0 bg-gray-900 rounded-xl border border-gray-700 overflow-hidden shadow-inner",children:e.jsx("img",{src:C(ce),className:"w-full h-full object-cover",alt:S.name,onError:Z=>Z.currentTarget.src="https://placehold.co/100x100/1f2937/4b5563?text=N/A"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-[12px] font-black text-white leading-tight mb-1 line-clamp-2",children:S.name}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-[10px] font-black text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded-lg border border-blue-500/10",children:["x",S.quantity]}),S.colorInfo&&e.jsxs("span",{className:"text-[9px] text-purple-400 font-bold",children:["ពណ៌៖ ",S.colorInfo]})]})]})]},A)})}),e.jsx("div",{className:`absolute ${T} left-1/2 -translate-x-1/2 w-5 h-5 bg-gray-800 border-gray-600 rotate-45`})]})]})}),u("location")&&e.jsx("td",{className:"px-5 py-4 relative overflow-visible",children:e.jsxs("div",{className:"group/loc cursor-help",children:[e.jsx("div",{className:"text-[13px] font-black text-gray-100 leading-tight",children:t.Location}),e.jsx("div",{className:"text-[11px] font-bold text-gray-500 mt-1 line-clamp-1",children:t["Address Details"]}),e.jsxs("div",{className:`invisible group-hover/loc:visible opacity-0 group-hover/loc:opacity-100 absolute z-[200] left-1/2 -translate-x-1/2 ${ae} w-72 p-5 bg-gray-800 border border-gray-600 rounded-[2rem] shadow-[0_25px_60px_rgba(0,0,0,0.7)] transition-all duration-300 pointer-events-none`,children:[e.jsx("p",{className:"text-[10px] font-black text-blue-400 uppercase tracking-[0.2em] mb-3 border-b border-white/5 pb-2",children:"ទីតាំង និងអាសយដ្ឋាន"}),e.jsxs("div",{className:"space-y-3 text-left",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-black text-gray-500 uppercase",children:"Province / City"}),e.jsx("p",{className:"text-sm font-black text-white",children:t.Location})]}),e.jsxs("div",{className:"bg-black/20 p-3 rounded-xl border border-white/5",children:[e.jsx("span",{className:"text-[9px] font-black text-gray-500 uppercase block mb-1",children:"Details"}),e.jsx("p",{className:"text-[12px] text-gray-300 leading-relaxed font-medium",children:t["Address Details"]||"មិនមានអាសយដ្ឋានលម្អិត"})]})]}),e.jsx("div",{className:`absolute ${T} left-1/2 -translate-x-1/2 w-5 h-5 bg-gray-800 border-gray-600 rotate-45`})]})]})}),u("pageInfo")&&e.jsx("td",{className:"px-5 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx("img",{src:m,className:"w-7 h-7 rounded-full border border-gray-700 shadow-sm object-cover",alt:"logo"}):e.jsx("div",{className:"w-7 h-7 rounded-full bg-gray-800 border border-gray-700 flex items-center justify-center text-[7px] text-gray-600 font-bold",children:"Log"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"text-[13px] font-bold text-gray-200 block truncate",children:t.Page}),e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-black tracking-widest",children:t.Team})]})]})}),u("total")&&e.jsxs("td",{className:"px-5 py-4 font-black text-blue-400 text-base tracking-tight",children:["$",t["Grand Total"].toFixed(2)]}),u("shippingService")&&e.jsx("td",{className:"px-5 py-4 text-[11px] text-yellow-500/80 font-bold uppercase",children:e.jsxs("div",{className:"flex items-center gap-2",children:[E&&e.jsx("img",{src:E,className:"w-5 h-5 rounded-full object-contain",alt:"shipping"}),e.jsx("span",{className:"truncate",children:t["Internal Shipping Method"]||"-"})]})}),u("shippingCost")&&e.jsxs("td",{className:"px-5 py-4 text-[11px] text-orange-400 font-mono font-bold",children:["$",(Number(t["Internal Cost"])||0).toFixed(2)]}),u("status")&&e.jsx("td",{className:"px-5 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider shadow-sm border ${t["Payment Status"]==="Paid"?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`,children:t["Payment Status"]})}),u("date")&&e.jsx("td",{className:"px-5 py-4 text-[10px] text-gray-500 font-bold",children:new Date(t.Timestamp).toLocaleDateString("km-KH")}),u("print")&&e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>K(t),className:"text-emerald-400 hover:text-white bg-emerald-400/5 hover:bg-emerald-600 p-2 rounded-lg transition-all border border-emerald-400/20 shadow-sm active:scale-90",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})})})}),u("actions")&&e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("button",{onClick:()=>v&&v(t),className:"text-blue-400 hover:text-white bg-blue-400/5 hover:bg-blue-600 px-4 py-1.5 rounded-lg text-xs font-black transition-all border border-blue-400/20 shadow-sm active:scale-95",children:"Edit"})}),u("check")&&e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx("input",{type:"checkbox",checked:H,onChange:()=>W(V,H),className:`h-6 w-6 rounded border-gray-600 bg-gray-800 text-emerald-500 focus:ring-emerald-500/20 cursor-pointer transition-all active:scale-150 ${se?"opacity-30":"hover:scale-110"}`}),se&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx(ie,{size:"sm"})})]})})]},V)})})]})}),e.jsx("div",{className:"md:hidden space-y-4 min-h-[1200px] pb-64",children:z.map((t,p)=>{var Y;const h=(Y=f.pages)==null?void 0:Y.find(I=>I.PageName===t.Page),m=h?C(h.PageLogoURL):"",g=O(t["Customer Phone"]),j=_(g),P=t.IsVerified===!0||String(t.IsVerified).toUpperCase()==="TRUE",E=a.has(t["Order ID"]),V=L.has(t["Order ID"]),H=b(t["Internal Shipping Method"]),se=B===t["Order ID"];return e.jsxs("div",{className:`bg-gray-800/40 border ${V?"border-blue-500 shadow-blue-500/10":P?"border-emerald-500/50":"border-gray-700"} rounded-[2rem] p-5 shadow-lg space-y-4 animate-fade-in relative`,children:[k&&e.jsx("div",{className:"absolute top-5 left-5 z-10",children:e.jsx("input",{type:"checkbox",className:"h-6 w-6 rounded-lg border-gray-600 bg-gray-900 text-blue-500 focus:ring-blue-500/20 cursor-pointer",checked:V,onChange:()=>k(t["Order ID"])})}),e.jsxs("div",{className:`flex justify-between items-start ${k?"pl-10":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gray-900 border border-gray-700 flex items-center justify-center overflow-hidden shadow-inner",children:m?e.jsx("img",{src:m,className:"w-full h-full object-cover",alt:"logo"}):e.jsx("span",{className:"text-[10px] font-black text-gray-500",children:"Log"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[15px] font-black text-white leading-none",children:t["Customer Name"]}),e.jsxs("p",{className:"text-[10px] text-gray-500 uppercase font-black mt-1.5",children:[t.Page," (",t.Team,")"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("button",{onClick:()=>q(t["Order ID"]),className:`px-3 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border transition-all ${se?"bg-green-600 text-white border-green-500":"bg-gray-900 text-gray-400 border-gray-700"}`,children:B===t["Order ID"]?"Copied":t["Order ID"].substring(0,8)}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[9px] font-black uppercase border ${t["Payment Status"]==="Paid"?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`,children:t["Payment Status"]})]})]}),u("productInfo")&&t.Products&&t.Products.length>0&&e.jsxs("div",{className:"bg-black/20 rounded-[1.5rem] p-3 border border-white/5 space-y-2",children:[e.jsxs("p",{className:"text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1 ml-1 flex items-center gap-2",children:[e.jsx("svg",{className:"w-3.5 h-3.5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"ទំនិញដែលបានកម្មង់"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:t.Products.map((I,ae)=>{var S;const T=(S=f.products)==null?void 0:S.find(A=>A.ProductName===I.name),Q=I.image||(T==null?void 0:T.ImageURL)||"";return e.jsxs("div",{className:"flex items-center gap-3 bg-gray-900/40 p-2 rounded-xl border border-white/5",children:[e.jsx("div",{className:"w-10 h-10 flex-shrink-0 bg-gray-800 rounded-lg border border-gray-700 overflow-hidden",onClick:()=>J(C(Q)),children:e.jsx("img",{src:C(Q),className:"w-full h-full object-cover",alt:""})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start gap-2",children:[e.jsx("p",{className:"text-[12px] font-bold text-gray-200 truncate leading-tight",children:I.name}),e.jsxs("span",{className:"text-[10px] font-black text-blue-400 bg-blue-500/10 px-1.5 rounded-lg flex-shrink-0",children:["x",I.quantity]})]}),I.colorInfo&&e.jsxs("p",{className:"text-[9px] text-gray-500 italic mt-1 truncate",children:["ពណ៌៖ ",I.colorInfo]})]})]},ae)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-[12px]",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-gray-500 font-black uppercase text-[9px] tracking-widest",children:"លេខទូរស័ព្ទ"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[j&&e.jsx("img",{src:j,className:"w-4 h-4 object-contain",alt:""}),e.jsx("span",{className:"text-white font-mono font-bold tracking-tight",children:g})]})]}),e.jsxs("div",{className:"space-y-1 text-right",children:[e.jsx("p",{className:"text-gray-500 font-black uppercase text-[9px] tracking-widest",children:"សរុបទឹកប្រាក់"}),e.jsxs("p",{className:"text-blue-400 font-black text-base",children:["$",t["Grand Total"].toFixed(2)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-gray-500 font-black uppercase text-[9px] tracking-widest",children:"ទីតាំង"}),e.jsx("p",{className:"text-white font-bold truncate max-w-[140px]",children:t.Location})]}),e.jsxs("div",{className:"space-y-1 text-right",children:[e.jsx("p",{className:"text-gray-500 font-black uppercase text-[9px] tracking-widest",children:"ដឹកជញ្ជូន"}),e.jsxs("div",{className:"flex items-center justify-end gap-1.5",children:[H&&e.jsx("img",{src:H,className:"w-3.5 h-3.5 object-contain",alt:""}),e.jsx("span",{className:"text-white truncate max-w-[100px] font-bold",children:t["Internal Shipping Method"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u("actions")&&e.jsx("button",{onClick:()=>v&&v(t),className:"p-3 bg-blue-600/10 text-blue-400 rounded-2xl border border-blue-500/20 active:scale-90 transition-all",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),u("print")&&e.jsx("button",{onClick:()=>K(t),className:"p-3 bg-emerald-600/10 text-emerald-400 rounded-2xl border border-emerald-500/20 active:scale-90 transition-all",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-[10px] text-gray-500 font-bold italic",children:new Date(t.Timestamp).toLocaleDateString("km-KH")}),u("check")&&e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:()=>W(t["Order ID"],P),className:`h-9 w-9 rounded-xl border-gray-600 bg-gray-900 text-emerald-500 focus:ring-emerald-500/20 transition-all ${E?"opacity-20":"active:scale-125"}`}),E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ie,{size:"sm"})})]})]})]})]},t["Order ID"])})})]}),e.jsx("div",{className:"h-64 md:h-[400px] w-full pointer-events-none opacity-0 shrink-0","aria-hidden":"true"})]})},de={id:Date.now(),name:"",quantity:1,originalPrice:0,finalPrice:0,total:0,discountPercent:0,colorInfo:"",image:"",cost:0,discountType:"percent",discountAmountInput:"",discountPercentInput:"",finalPriceInput:"",applyDiscountToTotal:!1},ne=[{number:1,title:"អតិថិជន"},{number:2,title:"ផលិតផល"},{number:3,title:"ដឹកជញ្ជូន"},{number:4,title:"ផ្ទៀងផ្ទាត់"}],qe=({team:w,onSaveSuccess:v,onCancel:X})=>{const{appData:x,currentUser:L,apiKey:k,previewImage:R}=c.useContext(xe),[f,M]=c.useState(1),[J,B]=c.useState(!1),D=c.useMemo(()=>({page:"",telegramValue:"",fulfillmentStore:"",customer:{name:"",phone:"",province:"",district:"",sangkat:"",additionalLocation:"",shippingFee:""},products:[{...de,id:Date.now()}],shipping:{method:"",details:"",cost:""},payment:{status:"Unpaid",info:""},telegram:{schedule:!1,time:""},subtotal:0,grandTotal:0,note:""}),[]),[a,y]=c.useState(D),[z,$]=c.useState(!1),[u,U]=c.useState(""),[W,O]=c.useState(null),[q,K]=c.useState(null),[_,b]=c.useState(""),[t,p]=c.useState(""),[h,m]=c.useState(""),[g,j]=c.useState(!1),[P,E]=c.useState("charge"),[V,H]=c.useState(!1),[se,Y]=c.useState(""),[I,ae]=c.useState("increment"),T=c.useMemo(()=>`createOrderDraft_${L==null?void 0:L.UserName}_${w}`,[L,w]);c.useEffect(()=>{window.innerWidth<768&&window.scrollTo({top:0,behavior:"smooth"})},[f]),c.useEffect(()=>{var l,i;try{const r=localStorage.getItem(T);if(r){const n=JSON.parse(r);if(y(d=>({...d,...n})),n.customer&&typeof n.customer.shippingFee=="number"&&E(n.customer.shippingFee===0?"free":"charge"),n.customer.phone){const d=n.customer.phone,s=(l=x.phoneCarriers)==null?void 0:l.find(o=>(o.Prefixes||"").split(",").some(F=>d.startsWith(F.trim())));b(s?C(s.CarrierLogoURL):"")}if(n.shipping.method){const d=(i=x.shippingMethods)==null?void 0:i.find(s=>s.MethodName===n.shipping.method);K(d||null),p(d?C(d.LogosURL):"")}}}catch{localStorage.removeItem(T)}},[T,x.phoneCarriers,x.shippingMethods]),c.useEffect(()=>{const l=setTimeout(()=>{localStorage.setItem(T,JSON.stringify(a))},500);return()=>clearTimeout(l)},[a,T]);const Q=()=>B(!0),S=()=>{localStorage.removeItem(T),B(!1),X()},A=c.useMemo(()=>x.pages?x.pages.filter(l=>l.Team===w):[],[x.pages,w]);c.useEffect(()=>{if(A.length===1&&!a.page){const l=A[0];y(i=>({...i,page:l.PageName,telegramValue:l.TelegramValue,fulfillmentStore:l.DefaultStore||i.fulfillmentStore}))}},[A,a.page]);const re=c.useMemo(()=>x.locations?[...new Set(x.locations.map(l=>l.Province))]:[],[x.locations]),ce=c.useMemo(()=>!x.locations||!a.customer.province?[]:[...new Set(x.locations.filter(l=>l.Province===a.customer.province).map(l=>l.District))].sort((l,i)=>String(l).localeCompare(String(i),"km")),[x.locations,a.customer.province]),le=c.useMemo(()=>!x.locations||!a.customer.province||!a.customer.district?[]:[...new Set(x.locations.filter(l=>l.Province===a.customer.province&&l.District===a.customer.district).map(l=>l.Sangkat).filter(Boolean))].sort((l,i)=>String(l).localeCompare(String(i),"km")),[x.locations,a.customer.province,a.customer.district]);c.useEffect(()=>{const l=a.products.reduce((r,n)=>r+(n.total||0),0),i=l+(Number(a.customer.shippingFee)||0);(l!==a.subtotal||i!==a.grandTotal)&&y(r=>({...r,subtotal:l,grandTotal:i}))},[a.products,a.customer.shippingFee]);const Z=(l,i)=>{const r={...l},n=i.find(F=>F.ProductName===r.name);r.quantity=Math.max(1,Number(r.quantity)||1),r.originalPrice=Math.max(0,n&&Number(n.Price)||0),r.cost=Math.max(0,n&&Number(n.Cost)||0);const d=r.quantity*r.originalPrice;let s=d,o=0;switch(r.discountType){case"percent":const F=Math.max(0,Number(r.discountPercentInput)||0);o=d*(F/100),s=d-o;break;case"amount":const te=Math.max(0,Number(r.discountAmountInput)||0);o=r.quantity>1&&r.applyDiscountToTotal?te:te*r.quantity,s=d-o;break;case"custom":const N=Math.max(0,Number(r.finalPriceInput)||0);s=r.quantity*N,o=d-s,r.finalPrice=N;break}return r.total=Math.max(0,s),r.finalPrice=r.quantity>0?r.total/r.quantity:0,r.discountPercent=d>0?o/d*100:0,r.discountType!=="custom"&&(r.finalPriceInput=r.finalPrice.toFixed(2)),r},ge=c.useCallback(l=>{const i=x.products.find(r=>r.Barcode&&r.Barcode.trim()===l.trim());i&&(y(r=>{const n=r.products.findIndex(s=>s.name===i.ProductName);let d;if(n>-1){const s={...r.products[n]};I==="increment"&&(s.quantity+=1);const o=Z(s,x.products);d=[...r.products],d[n]=o}else{const s=r.products.findIndex(te=>!te.name),o={...de,id:Date.now(),name:i.ProductName,quantity:1,originalPrice:i.Price,cost:i.Cost,image:i.ImageURL},F=Z(o,x.products);s>-1?(d=[...r.products],d[s]=F):d=[...r.products,F]}return{...r,products:d}}),I==="single"&&j(!1))},[x.products,I]),ee=l=>{const{name:i,value:r}=l.target;if(i==="phone"){let n=r.replace(/[^0-9]/g,"");n.length>1&&n.startsWith("00")?n="0"+n.substring(2):n.length>0&&!n.startsWith("0")&&(n="0"+n);let d=null;n.length>=2&&x.phoneCarriers&&(d=x.phoneCarriers.find(s=>(s.Prefixes||"").split(",").some(o=>n.startsWith(o.trim())))),b(d?C(d.CarrierLogoURL):""),y(s=>({...s,customer:{...s.customer,phone:n}}));return}if(i==="shippingFee"){const n=r===""?"":Math.max(0,parseFloat(r));y(d=>({...d,customer:{...d.customer,shippingFee:n}}));return}y(n=>{let d={...n.customer,[i]:r};return i==="province"?(d.district="",d.sangkat=""):i==="district"&&(d.sangkat=""),{...n,customer:d}})},G=(l,i,r)=>{y(n=>{const d=[...n.products];let s={...d[l]};if(["discountPercentInput","discountAmountInput","finalPriceInput"].includes(i)){let o=String(r).replace(/[^0-9.]/g,"").replace(/(\..*?)\./g,"$1");o.startsWith("0")&&o.length>1&&!o.startsWith("0.")&&(o=String(parseFloat(o))),s[i]=o}else s[i]=r;if(i==="name"){const o=x.products.find(F=>F.ProductName===r);s.name=r,o?(s.originalPrice=o.Price,s.image=o.ImageURL,s.cost=o.Cost,s.discountType="percent",s.finalPrice=o.Price,s.finalPriceInput=String(o.Price)):(s.originalPrice=0,s.image="",s.cost=0,s.discountType="custom",s.finalPrice=0)}return i==="discountType"&&(s.discountPercentInput="",s.discountAmountInput="",s.finalPrice=s.originalPrice,s.finalPriceInput=String(s.originalPrice)),d[l]=Z(s,x.products),{...n,products:d}})},he=l=>{K(l),p(C(l.LogosURL)),y(i=>({...i,shipping:{...i.shipping,method:l.MethodName,details:l.RequireDriverSelection?"":l.MethodName}}))},be=l=>{const{name:i,value:r}=l.target;let n=r;i==="cost"&&(n.startsWith("0")&&n.length>1&&!n.startsWith("0.")&&(n=String(parseFloat(n))),n=String(Math.max(0,parseFloat(n)||0))),y(d=>({...d,shipping:{...d.shipping,[i]:n}}))},fe=l=>{y(i=>({...i,shipping:{...i.shipping,details:l}}))},ye=l=>{var r;const i=((r=x.bankAccounts)==null?void 0:r.find(n=>n.BankName===l))||null;m(i?C(i.LogoURL):""),y(n=>({...n,payment:{...n.payment,info:l}}))},pe=l=>{E(l),y(i=>({...i,customer:{...i.customer,shippingFee:l==="free"?0:""}}))},je=()=>{if(!k){alert("API Key Required for Maps.");return}const{province:l,district:i,sangkat:r,additionalLocation:n}=a.customer,d=[n,r,i,l,"Cambodia"].filter(Boolean).join(", ");Y(`https://www.google.com/maps/embed/v1/search?key=${k}&q=${encodeURIComponent(d)}`),H(!0)},ue=l=>{switch(U(""),l){case 1:return!a.customer.name||!a.customer.phone||!a.customer.province||!a.page||!a.fulfillmentStore?(U("សូមបំពេញឈ្មោះ, លេខទូរស័ព្ទ, ខេត្ត/ក្រុង, Page និងឃ្លាំងបញ្ចេញទំនិញ។"),!1):P==="charge"&&(a.customer.shippingFee===""||a.customer.shippingFee<0)?(U("សូមបញ្ចូលតម្លៃដឹកជញ្ជូនឱ្យបានត្រឹមត្រូវ។"),!1):!0;case 2:return a.products.length===0||a.products.some(i=>!i.name||i.quantity<=0)?(U("សូមពិនិត្យទិន្នន័យផលិតផល។"),!1):!0;case 3:return!a.shipping.method||q!=null&&q.RequireDriverSelection&&!a.shipping.details||a.shipping.cost===""||parseFloat(a.shipping.cost)<0?(U("សូមពិនិត្យព័ត៌មានដឹកជញ្ជូន។"),!1):!0;case 4:return a.payment.status==="Paid"&&!a.payment.info?(U("សូមជ្រើសរើសគណនីធនាគារ Tune។"),!1):a.telegram.schedule&&!a.telegram.time?(U("សូមជ្រើសរើសពេលវេលាផ្ញើសារ។"),!1):!0;default:return!0}},Ne=()=>{ue(f)&&M(f+1)},ve=()=>{f>1&&M(f-1)},we=async()=>{for(const r of ne)if(!ue(r.number)){M(r.number);return}$(!0);let l="0"+a.customer.phone.replace(/[^0-9]/g,"").replace(/^0+/,"");const i={currentUser:L,selectedTeam:w,page:a.page,telegramValue:a.telegramValue,customer:{...a.customer,phone:l,shippingFee:Number(a.customer.shippingFee)||0},products:a.products.map(r=>({name:r.name,quantity:Number(r.quantity)||1,originalPrice:Number(r.originalPrice)||0,finalPrice:Number(r.finalPrice)||0,total:Number(r.total)||0,colorInfo:r.colorInfo,cost:Number(r.cost)||0})),shipping:{...a.shipping,cost:Number(a.shipping.cost)||0},payment:a.payment,subtotal:Number(a.subtotal)||0,grandTotal:Number(a.grandTotal)||0,note:a.note,fulfillmentStore:a.fulfillmentStore,scheduledTime:a.telegram.schedule?a.telegram.time:""};try{const r=await fetch(`${me}/api/submit-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),n=await r.json();if(!r.ok||n.status!=="success")throw new Error(n.message||"Error");localStorage.removeItem(T),O({type:"success",message:`ជោគជ័យ! Order ID: ${n.orderId}`}),setTimeout(v,3e3)}catch(r){O({type:"error",message:`បរាជ័យ: ${r.message}`}),setTimeout(()=>O(null),3e3)}finally{$(!1)}},ke=()=>{var l,i,r,n;switch(f){case 1:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ព័ត៌មានអតិថិជន & Page"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"input-label font-black text-xs uppercase tracking-widest text-gray-500 mb-2 block",children:"Facebook Page*"}),e.jsx($e,{pages:A,selectedPageName:a.page,onSelect:s=>y({...a,page:s.PageName,telegramValue:s.TelegramValue,fulfillmentStore:s.DefaultStore||a.fulfillmentStore})})]})}),e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-1.5 h-4 bg-orange-500 rounded-full"}),e.jsx("label",{className:"input-label !mb-0 font-black text-xs uppercase tracking-widest text-orange-400",children:"ឃ្លាំងបញ្ចេញទំនិញ (Store)*"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:(l=x.stores)==null?void 0:l.map(s=>{const o=a.fulfillmentStore===s.StoreName;return e.jsxs("button",{type:"button",onClick:()=>y({...a,fulfillmentStore:s.StoreName}),className:`relative overflow-hidden group p-4 rounded-2xl border-2 transition-all duration-300 flex flex-col items-center text-center gap-2 ${o?"bg-orange-500/10 border-orange-500 shadow-[0_0_20px_rgba(249,115,22,0.2)]":"bg-gray-900 border-gray-800 hover:border-gray-600"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-colors ${o?"bg-orange-500 text-white":"bg-gray-800 text-gray-500 group-hover:text-gray-300"}`,children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("span",{className:`text-[11px] font-black uppercase tracking-tight ${o?"text-white":"text-gray-400"}`,children:s.StoreName}),o&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]},s.StoreName)})})]}),e.jsx("input",{type:"text",name:"name",value:a.customer.name,placeholder:"ឈ្មោះអតិថិជន*",className:"form-input !py-3 rounded-xl border-gray-700 bg-gray-900",onChange:ee,required:!0}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",name:"phone",value:a.customer.phone,placeholder:"លេខទូរស័ព្ទ*",className:"form-input !py-3 rounded-xl border-gray-700 bg-gray-900 pr-12",onChange:ee,required:!0}),_&&e.jsx("img",{src:_,alt:"Carrier",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-auto object-contain"})]}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsx(Oe,{provinces:re,selectedProvince:a.customer.province,onSelect:s=>ee({target:{name:"province",value:s}})}),e.jsxs("select",{name:"district",value:a.customer.district,className:"form-select",onChange:ee,disabled:!a.customer.province,children:[e.jsx("option",{value:"",children:"-- ស្រុក/ខណ្ឌ --"}),ce.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{name:"sangkat",value:a.customer.sangkat,className:"form-select",onChange:ee,disabled:!a.customer.district,children:[e.jsx("option",{value:"",children:"-- ឃុំ/សង្កាត់ --"}),le.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"ទីតាំងលម្អិត (ផ្ទះលេខ, ផ្លូវ)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"additionalLocation",value:a.customer.additionalLocation,placeholder:"បញ្ចូលទីតាំងលម្អិត...",className:"form-input !py-3 rounded-xl bg-gray-900 border-gray-700",onChange:ee}),e.jsx("button",{type:"button",onClick:je,className:"p-3 bg-blue-600/10 text-blue-400 rounded-xl border border-blue-500/20 hover:bg-blue-600 hover:text-white transition-all active:scale-90",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"ថ្លៃសេវាដឹកជញ្ជូន"}),e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>pe("charge"),className:`flex-1 py-3 px-4 rounded-xl text-xs font-black uppercase transition-all border ${P==="charge"?"bg-blue-600 border-blue-500 text-white shadow-lg shadow-blue-600/20 active:scale-95":"bg-gray-800 border-gray-700 text-gray-500 hover:text-gray-300"}`,children:"គិតថ្លៃសេវា"}),e.jsx("button",{type:"button",onClick:()=>pe("free"),className:`flex-1 py-3 px-4 rounded-xl text-xs font-black uppercase transition-all border ${P==="free"?"bg-emerald-600 border-emerald-500 text-white shadow-lg shadow-emerald-600/20 active:scale-95":"bg-gray-800 border-gray-700 text-gray-500 hover:text-gray-300"}`,children:"មិនគិតថ្លៃសេវា"})]}),P==="charge"&&e.jsx("input",{type:"number",min:"0",name:"shippingFee",value:a.customer.shippingFee,placeholder:"តម្លៃដឹកជញ្ជូន (ឧ. 1.5)*",className:"form-input !py-3 rounded-xl border-gray-700 bg-gray-900",onChange:ee,required:!0})]})]})]});case 2:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-4 sm:space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ផលិតផល & ការបញ្ចុះតម្លៃ"}),e.jsx("div",{className:"space-y-4 sm:space-y-6",children:a.products.map((s,o)=>{const F=(Number(s.quantity)||0)*(Number(s.originalPrice)||0),te=F-(Number(s.total)||0);return e.jsxs("div",{className:"p-3 sm:p-5 bg-gray-800/40 rounded-2xl sm:rounded-3xl border border-gray-700 relative shadow-xl overflow-hidden group",children:[e.jsx("button",{type:"button",onClick:()=>{a.products.length>1&&y({...a,products:a.products.filter((N,oe)=>oe!==o)})},className:"absolute top-2 right-2 sm:top-4 sm:right-4 text-red-400 bg-red-400/10 rounded-full h-6 w-6 sm:h-8 sm:w-8 flex items-center justify-center border border-red-400/20 hover:bg-red-600 hover:text-white transition-all z-10 active:scale-90",disabled:a.products.length<=1,children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 sm:gap-6 mb-4 sm:mb-6",children:[e.jsx("div",{className:"md:col-span-2 flex justify-center",children:e.jsx("div",{className:"w-20 h-20 sm:w-28 sm:h-28 bg-gray-900 rounded-xl sm:rounded-2xl overflow-hidden border-2 border-gray-700 shadow-inner group-hover:border-blue-500/50 transition-colors",children:e.jsx("img",{src:C(s.image),className:"w-full h-full object-cover",alt:""})})}),e.jsxs("div",{className:"md:col-span-10 grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ឈ្មោះផលិតផល*"}),e.jsx(Te,{products:x.products||[],selectedProductName:s.name,onSelect:N=>G(o,"name",N)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ចំនួន*"}),e.jsxs("div",{className:"quantity-stepper !max-w-full",children:[e.jsx("button",{type:"button",className:"active:scale-95 transition-transform",onClick:()=>G(o,"quantity",Math.max(1,s.quantity-1)),disabled:s.quantity<=1,children:"-"}),e.jsx("span",{className:"quantity-display text-sm",children:s.quantity}),e.jsx("button",{type:"button",className:"active:scale-95 transition-transform",onClick:()=>G(o,"quantity",s.quantity+1),children:"+"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ពណ៌/សម្គាល់"}),e.jsx("input",{type:"text",list:`colors-datalist-${s.id}`,value:s.colorInfo,onChange:N=>G(o,"colorInfo",N.target.value),className:"form-input text-sm !py-2.5 rounded-xl bg-gray-900 border-gray-700",placeholder:"ឧ. ខៀវ, XL"}),e.jsx("datalist",{id:`colors-datalist-${s.id}`,children:(x.colors||[]).map((N,oe)=>e.jsx("option",{value:N.ColorName},oe))})]})]})]})]}),e.jsxs("div",{className:"bg-black/20 rounded-xl sm:rounded-[2rem] p-3 sm:p-6 border border-white/5 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"h-px flex-grow bg-gray-700/50"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] sm:tracking-[0.3em] whitespace-nowrap",children:"Pricing & Discount"}),e.jsx("div",{className:"h-px flex-grow bg-gray-700/50"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"flex bg-gray-900/50 p-1 rounded-xl sm:rounded-2xl border border-gray-700 shadow-inner",children:["percent","amount","custom"].map(N=>e.jsx("button",{type:"button",onClick:()=>G(o,"discountType",N),className:`flex-1 flex flex-col items-center justify-center py-2 sm:py-2.5 rounded-lg sm:rounded-xl transition-all duration-300 active:scale-95 ${s.discountType===N?"bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:e.jsx("span",{className:"text-[9px] sm:text-[11px] font-black uppercase tracking-widest",children:N==="percent"?"បញ្ចុះ %":N==="amount"?"បញ្ចុះ $":"កែតម្លៃលក់"})},N))}),e.jsxs("div",{className:"relative animate-fade-in",children:[s.discountType==="percent"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"បញ្ចូលភាគរយបញ្ចុះតម្លៃ (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",max:"100",placeholder:"0",value:s.discountPercentInput,onChange:N=>G(o,"discountPercentInput",N.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-blue-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"%"})]})]}),s.discountType==="amount"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"បញ្ចូលទឹកប្រាក់បញ្ចុះតម្លៃ ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",placeholder:"0.00",value:s.discountAmountInput,onChange:N=>G(o,"discountAmountInput",N.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-red-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"$"})]}),s.quantity>1&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 bg-black/20 rounded-lg mt-1 sm:mt-2 border border-white/5 active:scale-95 transition-transform",children:[e.jsx("input",{type:"checkbox",checked:s.applyDiscountToTotal,onChange:N=>G(o,"applyDiscountToTotal",N.target.checked),className:"w-4 h-4 rounded border-gray-600 bg-gray-800 text-blue-500"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] text-gray-400 uppercase font-black",children:"បញ្ចុះលើតម្លៃសរុប"})]})]}),s.discountType==="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"កំណត់តម្លៃលក់ថ្មីក្នុង ១ ឯកតា ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"0.00",value:s.finalPriceInput,onChange:N=>G(o,"finalPriceInput",N.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-emerald-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"$"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-900/60 rounded-xl sm:rounded-[1.5rem] p-3 sm:p-5 border border-white/5 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px] sm:text-xs",children:[e.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Original Subtotal"}),e.jsxs("span",{className:"text-blue-400 font-black",children:["$",F.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] sm:text-xs",children:[e.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Discount Applied"}),e.jsxs("span",{className:"text-red-400 font-black",children:["-",te>0?`$${te.toFixed(2)}`:"$0.00"]})]}),e.jsx("div",{className:"h-px bg-gray-700/50 my-1"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Net Total"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-black text-white tracking-tighter",children:["$",(s.total||0).toFixed(2)]})]})]}),e.jsx("div",{className:"mt-3 sm:mt-4 pt-2 sm:pt-3 border-t border-white/5 flex justify-center",children:e.jsxs("span",{className:"text-[8px] sm:text-[9px] bg-emerald-500/10 text-emerald-400 px-2 sm:px-3 py-1 rounded-full border border-emerald-500/20 font-black uppercase tracking-widest",children:["Avg. $",(s.finalPrice||0).toFixed(2)," / unit"]})})]})]})]})]},s.id)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mt-6",children:[e.jsxs("button",{type:"button",onClick:()=>y({...a,products:[...a.products,{...de,id:Date.now()}]}),className:"flex-1 py-4 px-6 bg-gray-800 border border-gray-700 rounded-2xl text-gray-300 font-black uppercase text-[11px] tracking-widest hover:bg-gray-700 hover:border-blue-500 transition-all flex items-center justify-center gap-2 active:scale-95",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M12 4v16m8-8H4"})}),"បន្ថែមផលិតផល"]}),e.jsxs("button",{type:"button",onClick:()=>j(!0),className:"flex-1 py-4 px-6 bg-blue-600/10 border border-blue-500/30 rounded-2xl text-blue-400 font-black uppercase text-[11px] tracking-widest hover:bg-blue-600 hover:text-white transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-900/10 active:scale-95",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2M17 3h2a2 2 0 0 1 2 2v2M21 17v2a2 2 0 0 1-2 2h-2M7 21H5a2 2 0 0 1-2-2v-2M7 12h10",strokeWidth:"3"})}),"Scan Barcode"]})]})]});case 3:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-4 sm:space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ដឹកជញ្ជូន"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"វិធីសាស្រ្តដឹកជញ្ជូន*"}),e.jsx(Me,{methods:x.shippingMethods||[],selectedMethodName:a.shipping.method,onSelect:he})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"ថ្លៃសេវាឲ្យអ្នកដឹក (Cost)*"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",name:"cost",placeholder:"0.00",value:a.shipping.cost,className:"form-input !py-3 rounded-xl bg-gray-900 border-gray-700 text-blue-400 font-black pr-12",onChange:be,required:!0}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold",children:"$"})]})]}),(q==null?void 0:q.RequireDriverSelection)&&e.jsxs("div",{className:"md:col-span-2 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"h-4 w-1 bg-blue-500 rounded-full"}),e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]",children:"ជ្រើសរើសអ្នកដឹក (DriverSelection)*"})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-4",children:(i=x.drivers)==null?void 0:i.map(s=>{const o=a.shipping.details===s.DriverName;return e.jsxs("button",{type:"button",onClick:()=>fe(s.DriverName),className:`group relative flex flex-col items-center p-2 sm:p-3 rounded-2xl sm:rounded-[2rem] border-2 transition-all duration-300 active:scale-95 ${o?"bg-blue-600/20 border-blue-500 shadow-lg shadow-blue-900/20 scale-105":"bg-gray-800/40 border-transparent hover:bg-gray-800 hover:border-gray-700"}`,children:[e.jsx("div",{className:`w-12 h-12 sm:w-20 sm:h-20 rounded-full overflow-hidden mb-2 sm:mb-3 border-2 sm:border-4 transition-all duration-500 ${o?"border-blue-500 shadow-xl":"border-gray-700 group-hover:border-gray-600"}`,children:e.jsx("img",{src:C(s.ImageURL),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:s.DriverName})}),e.jsx("span",{className:`text-[9px] sm:text-[11px] font-black uppercase tracking-widest text-center truncate w-full ${o?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:s.DriverName}),o&&e.jsx("div",{className:"absolute top-0.5 right-0.5 bg-blue-500 text-white rounded-full p-0.5 sm:p-1 shadow-lg animate-fade-in-scale",children:e.jsx("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:4,children:e.jsx("path",{d:"M5 13l4 4L19 7"})})})]},s.DriverName)})}),!a.shipping.details&&e.jsx("p",{className:"text-center text-[9px] text-gray-500 italic mt-1",children:"សូមជ្រើសរើសអ្នកដឹកម្នាក់"})]})]})]});case 4:const d=(r=x.drivers)==null?void 0:r.find(s=>s.DriverName===a.shipping.details);return e.jsxs("div",{className:"animate-fade-in space-y-4 sm:space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," ព័ត៌មានអតិថិជន"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 bg-gray-900/60 p-3 sm:p-5 rounded-2xl sm:rounded-3xl border border-white/5 shadow-inner",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Customer Info"}),e.jsx("p",{className:"text-white font-black text-base sm:text-lg",children:a.customer.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-blue-400 font-bold font-mono text-sm",children:a.customer.phone}),_&&e.jsx("img",{src:_,className:"h-4 sm:h-5 w-auto object-contain",alt:"Carrier"})]})]}),e.jsxs("div",{className:"space-y-1 md:text-right",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Location / Store"}),e.jsx("p",{className:"text-gray-200 font-bold text-xs sm:text-sm leading-tight",children:`${a.customer.additionalLocation}, ${a.customer.sangkat}, ${a.customer.district}, ${a.customer.province}`.replace(/^,|,$/g,"").trim()}),e.jsxs("p",{className:"text-purple-400 font-black text-[9px] uppercase tracking-wider",children:["Fulfillment: ",a.fulfillmentStore]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-500"})," ព័ត៌មានដឹកជញ្ជូន"]}),e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-5 rounded-2xl sm:rounded-3xl border border-white/5 shadow-inner grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Shipping Method"}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("img",{src:t,className:"h-4 sm:h-5 w-auto object-contain",alt:"Logo"}),e.jsx("p",{className:"text-white font-black text-xs sm:text-sm",children:a.shipping.method})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Driver / Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("img",{src:C(d.ImageURL),className:"h-6 w-6 sm:h-8 sm:w-8 rounded-full object-cover border border-gray-700 cursor-pointer active:scale-95 transition-transform",alt:"Driver",onClick:()=>R(C(d.ImageURL))}),e.jsx("p",{className:"text-white font-bold text-xs sm:text-sm",children:a.shipping.details||"N/A"})]})]}),e.jsxs("div",{className:"space-y-1 sm:text-right",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Internal Cost ($)"}),e.jsxs("p",{className:"text-orange-400 font-black text-base sm:text-lg font-mono",children:["$",(Number(a.shipping.cost)||0).toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," បញ្ជីទំនិញកុម្ម៉ង់"]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:a.products.map(s=>e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 bg-gray-900/40 p-2 sm:p-3 rounded-xl sm:rounded-2xl border border-white/5 group hover:border-blue-500/30 transition-all",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gray-800 rounded-lg sm:rounded-xl overflow-hidden border border-gray-700 flex-shrink-0 relative",children:e.jsx("img",{src:C(s.image),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:s.name})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-0.5 sm:mb-1",children:[e.jsx("h4",{className:"text-white font-black text-xs sm:text-sm truncate leading-tight",children:s.name}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("span",{className:"bg-blue-600/10 text-blue-400 text-[9px] sm:text-[10px] font-black px-1.5 sm:px-2.5 py-0.5 sm:py-1 rounded-lg border border-blue-500/20",children:["x",s.quantity]})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[s.colorInfo&&e.jsx("span",{className:"text-[9px] bg-purple-500/10 text-purple-400 px-1.5 py-0.5 rounded-md font-bold",children:s.colorInfo}),e.jsxs("p",{className:"text-[9px] text-gray-500 font-bold uppercase tracking-tight",children:[e.jsxs("span",{children:["$",(s.finalPrice||0).toFixed(2)]})," / unit"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-black text-sm sm:text-base tracking-tight",children:["$",(s.total||0).toFixed(2)]}),e.jsx("p",{className:"text-[8px] text-gray-600 font-bold uppercase",children:"Subtotal"})]})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-white/5 text-center",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] text-gray-500 font-black uppercase mb-1",children:"សរុបទំនិញ"}),e.jsxs("p",{className:"text-white font-black text-base sm:text-lg",children:["$",(a.subtotal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-white/5 text-center",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] text-gray-500 font-black uppercase mb-1",children:"សេវាដឹក"}),e.jsxs("p",{className:"text-white font-black text-base sm:text-lg",children:["$",(Number(a.customer.shippingFee)||0).toFixed(2)]})]}),e.jsxs("div",{className:"col-span-2 bg-blue-600/10 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-blue-500/20 text-center shadow-lg shadow-blue-900/20",children:[e.jsx("p",{className:"text-[9px] sm:text-[10px] text-blue-400 font-black uppercase mb-1 tracking-widest",children:"សរុបរួម (Grand Total)"}),e.jsxs("p",{className:"text-white font-black text-2xl sm:text-3xl tracking-tighter",children:["$",(a.grandTotal||0).toFixed(2)]})]})]}),e.jsxs("fieldset",{className:"border border-gray-700 p-4 sm:p-6 rounded-2xl sm:rounded-3xl bg-gray-900/20",children:[e.jsx("legend",{className:"px-3 text-[10px] sm:text-xs font-black text-blue-400 uppercase tracking-[0.2em]",children:"ស្ថានភាពទូទាត់"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("select",{value:a.payment.status,onChange:s=>y({...a,payment:{...a.payment,status:s.target.value,info:""}}),className:"form-select bg-gray-800 text-sm",children:[e.jsx("option",{value:"Unpaid",children:"មិនទាន់ទូទាត់ (COD)"}),e.jsx("option",{value:"Paid",children:"ទូទាត់រួច (Paid)"})]}),a.payment.status==="Paid"&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 animate-fade-in",children:[e.jsxs("select",{value:a.payment.info,onChange:s=>ye(s.target.value),className:"form-select bg-gray-800 flex-grow text-sm",children:[e.jsx("option",{value:"",children:"ជ្រើសរើសធនាគារ"}),(n=x.bankAccounts)==null?void 0:n.map(s=>e.jsx("option",{value:s.BankName,children:s.BankName},s.BankName))]}),h&&e.jsx("img",{src:h,className:"h-8 w-12 sm:h-10 sm:w-16 object-contain bg-white/10 p-1 rounded-lg sm:rounded-xl active:scale-95 transition-transform",alt:"bank"})]})]})]}),e.jsx(De,{schedule:a.telegram.schedule,time:a.telegram.time,onChange:s=>y({...a,telegram:s})}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 pt-4",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ចំណាំ & Link Google Map"}),e.jsx("textarea",{placeholder:"ចំណាំបន្ថែម...",value:a.note,rows:4,onChange:s=>y({...a,note:s.target.value}),className:"form-textarea bg-gray-900/60 !rounded-[1.5rem] sm:!rounded-[2rem] border-white/5 focus:border-blue-500/50 text-sm"})]})]});default:return null}};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto mt-2 sm:mt-10 lg:mt-14 px-1 sm:px-0",children:[e.jsx("style",{children:`
                @keyframes shimmer {
                    0% { background-position: -200% 0; }
                    100% { background-position: 200% 0; }
                }
                .btn-shimmer {
                    background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
                    background-size: 200% 100%;
                    animation: shimmer 3s infinite linear;
                }
                @keyframes pulse-glow {
                    0%, 100% { box-shadow: 0 0 15px rgba(37,99,235,0.3); }
                    50% { box-shadow: 0 0 30px rgba(37,99,235,0.6); }
                }
                .btn-pulse { animation: pulse-glow 2s infinite ease-in-out; }
             `}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[100] animate-fade-in p-4",children:e.jsxs("div",{className:"page-card text-center flex flex-col items-center animate-fade-in-scale",children:[W.type==="success"?e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-green-500/20 text-green-400 rounded-full flex items-center justify-center mb-4 border border-green-500/30 shadow-[0_0_30px_rgba(34,197,94,0.2)]",children:e.jsx("svg",{className:"h-8 w-8 sm:h-10 sm:w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}):e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-500/20 text-red-400 rounded-full flex items-center justify-center mb-4 border border-red-500/30",children:e.jsx("svg",{className:"h-8 w-8 sm:h-10 sm:w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("p",{className:"text-base sm:text-lg font-black text-white",children:W.message})]})}),e.jsx(Ie,{isOpen:V,onClose:()=>H(!1),url:se}),g&&e.jsx(Le,{onClose:()=>j(!1),onCodeScanned:ge,scanMode:I,setScanMode:ae,productsInOrder:a.products,masterProducts:x.products||[]}),e.jsx(Ce,{isOpen:J,onClose:()=>B(!1),maxWidth:"max-w-sm",children:e.jsxs("div",{className:"p-6 text-center space-y-6",children:[e.jsx("div",{className:"mx-auto w-14 h-14 sm:w-16 sm:h-16 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center border border-red-500/20 shadow-xl shadow-red-900/10 animate-bounce-slow",children:e.jsx("svg",{className:"h-7 w-7 sm:h-8 sm:w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg sm:text-xl font-black text-white uppercase tracking-tighter",children:"បោះបង់ការបញ្ចូល?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>B(!1),className:"px-6 py-3 bg-gray-800 border border-gray-700 text-gray-300 rounded-2xl flex-1 font-black text-xs sm:text-sm transition-all hover:bg-gray-700 active:scale-95",children:"ទេ (ត្រឡប់)"}),e.jsx("button",{onClick:S,className:"px-6 py-3 bg-red-600 border border-red-500 text-white rounded-2xl flex-1 font-black text-xs sm:text-sm transition-all hover:bg-red-700 active:scale-95 shadow-lg shadow-red-900/20",children:"បាទ (បោះបង់)"})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-10 gap-4",children:[e.jsxs("h1",{className:"hidden md:flex text-2xl sm:text-3xl font-black text-white uppercase tracking-tighter items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-blue-500",children:"កុម្ម៉ង់ថ្មី"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] bg-blue-600/20 text-blue-400 px-3 sm:px-4 py-1.5 rounded-full border border-blue-500/20 uppercase tracking-[0.15em] sm:tracking-[0.2em]",children:w})]}),e.jsx("button",{onClick:Q,className:"hidden md:block px-6 py-2.5 bg-gray-800 border border-gray-700 hover:border-red-500 hover:bg-red-500/10 text-gray-400 hover:text-red-400 font-black rounded-2xl uppercase text-[10px] sm:text-[11px] tracking-widest transition-all active:scale-90",children:"បោះបង់"})]}),e.jsxs("div",{className:"bg-gray-800/30 backdrop-blur-3xl border border-white/5 rounded-[1.5rem] sm:rounded-[3rem] p-3 sm:p-10 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 sm:mb-12 relative px-2 sm:px-4",children:[e.jsx("div",{className:"absolute left-6 right-6 sm:left-10 sm:right-10 top-1/2 w-[calc(100%-48px)] sm:w-[calc(100%-80px)] h-0.5 bg-gray-700 -z-10"}),e.jsx("div",{className:"absolute left-6 sm:left-10 top-1/2 h-0.5 bg-blue-500 -z-10 transition-all duration-500",style:{width:`${(f-1)/(ne.length-1)*(100-48/400*100)}%`}}),ne.map(l=>e.jsxs("div",{className:`relative flex flex-col items-center z-10 transition-all duration-500 ${f>=l.number?"scale-110":"opacity-40 scale-90"}`,children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex items-center justify-center font-black text-[10px] sm:text-xs border-2 transition-all duration-500 ${f>=l.number?"border-blue-500 bg-blue-600 text-white shadow-[0_0_20px_rgba(37,99,235,0.4)]":"border-gray-600 bg-gray-800 text-gray-500"}`,children:f>l.number?"✓":l.number}),e.jsx("span",{className:`absolute -bottom-6 sm:-bottom-7 text-[8px] sm:text-[9px] font-black uppercase tracking-widest whitespace-nowrap ${f>=l.number?"text-blue-400":"text-gray-600"}`,children:l.title})]},l.number))]}),e.jsx("div",{className:"mt-8 sm:mt-16",children:ke()}),u&&e.jsx("div",{className:"mt-4 sm:mt-6 p-3 sm:p-4 bg-red-500/10 border border-red-500/20 rounded-xl sm:rounded-2xl text-red-400 text-center text-[10px] sm:text-xs font-bold animate-shake",children:u}),e.jsxs("div",{className:"mt-8 sm:mt-10 pt-6 sm:pt-8 border-t border-white/5 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex gap-3 sm:gap-4 h-12 sm:h-16",children:[f>1&&e.jsxs("button",{type:"button",onClick:ve,className:"flex-1 px-4 sm:px-8 bg-gray-800 border border-gray-700 text-gray-300 rounded-2xl font-black uppercase text-[10px] sm:text-[12px] tracking-[0.15em] transition-all hover:bg-gray-700 flex items-center justify-center gap-2 active:scale-95",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:3,children:e.jsx("path",{d:"M15 19l-7-7 7-7"})}),"ត្រឡប់"]}),f<ne.length?e.jsxs("button",{type:"button",onClick:Ne,className:"relative flex-[2] bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-black uppercase text-[12px] sm:text-[14px] tracking-[0.2em] shadow-2xl active:scale-95 transition-all flex items-center justify-center gap-3 group overflow-hidden btn-pulse",children:[e.jsx("div",{className:"absolute inset-0 btn-shimmer pointer-events-none"}),e.jsx("span",{className:"relative z-10",children:"ជំហានបន្ទាប់"}),e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10 transform group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:3,children:e.jsx("path",{d:"M9 5l7 7-7 7"})})]}):e.jsxs("button",{type:"button",onClick:we,className:"relative flex-[2] bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-black uppercase text-[12px] sm:text-[14px] tracking-[0.2em] shadow-2xl active:scale-95 transition-all flex items-center justify-center gap-3 overflow-hidden",disabled:z,children:[e.jsx("div",{className:"absolute inset-0 btn-shimmer pointer-events-none"}),z?e.jsx(ie,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative z-10",children:"បញ្ជូនកម្ម៉ង់ឥឡូវនេះ"}),e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10 animate-bounce-x",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:3,children:e.jsx("path",{d:"M5 13l4 4L19 7"})})]})]})]}),e.jsx("button",{onClick:Q,className:"md:hidden w-full py-4 bg-gray-800/40 text-gray-500 hover:text-red-400 font-black rounded-2xl uppercase text-[10px] tracking-widest transition-all active:scale-95 border border-white/5",children:"បោះបង់ការបញ្ចូល"})]})]}),e.jsx("style",{children:".animate-bounce-x { animation: bounce-x 1s infinite ease-in-out; } @keyframes bounce-x { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }"})]})},Re=({team:w})=>{const[v,X]=c.useState([]),[x,L]=c.useState([]),[k,R]=c.useState(!0),[f,M]=c.useState(""),[J,B]=c.useState(""),[D,a]=c.useState("this_month"),[y,z]=c.useState(new Date().toISOString().split("T")[0]),[$,u]=c.useState(new Date().toISOString().split("T")[0]),U=c.useMemo(()=>new Set(["index","orderId","customerName","productInfo","location","pageInfo","total","shippingService","status","date","print"]),[]);c.useEffect(()=>{(async()=>{R(!0),M("");try{const p=await(await fetch(`${me}/api/admin/all-orders`)).json();if(p.status==="success"){const m=(Array.isArray(p.data)?p.data.filter(j=>j!==null):[]).map(j=>{let P=[];try{j["Products (JSON)"]&&(P=JSON.parse(j["Products (JSON)"]))}catch{}return{...j,Products:P}});L(m);const g=m.filter(j=>(j.Team||"").trim()===(w||"").trim());X(g.sort((j,P)=>new Date(P.Timestamp).getTime()-new Date(j.Timestamp).getTime()))}}catch(t){M(t.message)}finally{R(!1)}})()},[w]);const W=b=>{const t=new Date,p=new Date(t.getFullYear(),t.getMonth(),t.getDate());let h=null,m=new Date;switch(b){case"today":h=p;break;case"yesterday":h=new Date(p),h.setDate(p.getDate()-1),m=new Date(p),m.setMilliseconds(-1);break;case"this_week":const g=t.getDay();h=new Date(p),h.setDate(p.getDate()-(g===0?6:g-1));break;case"this_month":h=new Date(t.getFullYear(),t.getMonth(),1);break;case"custom":h=new Date(y+"T00:00:00"),m=new Date($+"T23:59:59");break}return{start:h,end:m}},O=c.useMemo(()=>{const{start:b,end:t}=W(D);return v.filter(p=>{const h=new Date(p.Timestamp);if(b&&h<b||t&&h>t)return!1;if(J.trim()){const m=J.toLowerCase();if(!(p["Order ID"].toLowerCase().includes(m)||(p["Customer Name"]||"").toLowerCase().includes(m)||(p["Customer Phone"]||"").includes(m)))return!1}return!0})},[v,J,D,y,$]),q=c.useMemo(()=>O.reduce((b,t)=>b+(Number(t["Grand Total"])||0),0),[O]),K=c.useMemo(()=>{const{start:b,end:t}=W(D),p=x.filter(m=>{const g=new Date(m.Timestamp);return!(b&&g<b||t&&g>t)}),h={};return p.forEach(m=>{const g=(m.Team||"Unassigned").trim();h[g]=(h[g]||0)+(Number(m["Grand Total"])||0)}),Object.entries(h).map(([m,g])=>({name:m,revenue:g})).sort((m,g)=>g.revenue-m.revenue).slice(0,3)},[x,D,y,$]),_=c.useMemo(()=>{switch(D){case"today":return"ថ្ងៃនេះ";case"yesterday":return"ម្សិលមិញ";case"this_week":return"សប្តាហ៍នេះ";case"this_month":return"ខែនេះ";case"custom":return`${y} ដល់ ${$}`;default:return""}},[D,y,$]);return k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ie,{size:"lg"})}):e.jsxs("div",{className:"space-y-6 flex flex-col min-h-[2000px]",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"h-6 w-1.5 bg-yellow-500 rounded-full shadow-[0_0_10px_rgba(234,179,8,0.3)]"}),e.jsxs("h3",{className:"text-sm font-black text-white uppercase tracking-wider",children:["ចំណាត់ថ្នាក់លក់បានច្រើនជាងគេ (",D==="custom"?"តាមកាលបរិច្ឆេទកំណត់":_,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:K.length>0?K.map((b,t)=>e.jsxs("div",{className:"relative overflow-hidden bg-gray-800/40 border border-white/5 p-4 rounded-2xl flex items-center gap-4 transition-all duration-500 hover:bg-gray-800/60 shadow-xl",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg ${t===0?"bg-yellow-500/20 text-yellow-500 border border-yellow-500/50":t===1?"bg-gray-400/20 text-gray-300 border border-gray-400/50":"bg-orange-600/20 text-orange-500 border border-orange-600/50"}`,children:t===0?"🥇":t===1?"🥈":"🥉"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:["TOP ",t+1," TEAM"]}),e.jsx("h4",{className:"text-sm font-black text-white truncate",children:b.name})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-blue-400 font-black",children:["$",b.revenue.toLocaleString(void 0,{maximumFractionDigits:0})]})})]},b.name)):e.jsx("div",{className:"col-span-full py-4 text-center bg-gray-800/20 rounded-2xl border border-dashed border-gray-700",children:e.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest",children:"មិនទាន់មានទិន្នន័យលក់"})})}),e.jsxs("div",{className:"bg-gray-900/40 p-4 rounded-2xl border border-gray-700 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx("input",{type:"text",placeholder:"ស្វែងរក ID, ឈ្មោះ...",value:J,onChange:b=>B(b.target.value),className:"form-input !pl-10 w-full !py-2 bg-gray-900/60"}),e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"bg-blue-600/10 px-4 py-2 rounded-xl border border-blue-500/20 hidden sm:block",children:[e.jsxs("p",{className:"text-[9px] font-black text-blue-400 uppercase tracking-widest leading-none mb-1",children:["សរុបលក់បាន (",D==="custom"?"កំណត់":_,")"]}),e.jsxs("p",{className:"text-lg font-black text-white leading-none",children:["$",q.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"flex items-center gap-1 bg-gray-800/80 p-1 rounded-lg border border-gray-700",children:["today","this_week","this_month","custom"].map(b=>e.jsx("button",{onClick:()=>a(b),className:`px-3 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all ${D===b?"bg-blue-600 text-white shadow-md":"text-gray-500 hover:text-gray-300"}`,children:b==="today"?"ថ្ងៃនេះ":b==="this_week"?"សប្តាហ៍នេះ":b==="this_month"?"ខែនេះ":"កំណត់"},b))})]})]}),D==="custom"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-3 border-t border-gray-800 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:"ចាប់ពី"}),e.jsx("input",{type:"date",value:y,onChange:b=>z(b.target.value),className:"form-input !py-1.5 !px-3 bg-gray-800 border-gray-700 text-xs rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:"ដល់"}),e.jsx("input",{type:"date",value:$,onChange:b=>u(b.target.value),className:"form-input !py-1.5 !px-3 bg-gray-800 border-gray-700 text-xs rounded-xl"})]})]})]}),O.length===0?e.jsx("div",{className:"text-center py-20 bg-gray-800/20 rounded-3xl border-2 border-dashed border-gray-700/50",children:e.jsx("p",{className:"text-gray-500 font-bold uppercase tracking-widest text-xs",children:"មិនមានទិន្នន័យត្រូវបានរកឃើញ"})}):e.jsxs("div",{className:"space-y-4 flex-grow",children:[e.jsx(Fe,{orders:O,showActions:!1,visibleColumns:U}),e.jsxs("div",{className:"md:hidden bg-blue-600 p-5 rounded-[2rem] shadow-2xl flex justify-between items-center border border-white/10",children:[e.jsxs("span",{className:"text-white font-black uppercase text-xs tracking-widest",children:["សរុបលក់បាន (",O.length,")"]}),e.jsxs("span",{className:"text-white font-black text-xl",children:["$",q.toLocaleString(void 0,{minimumFractionDigits:2})]})]})]}),e.jsx("div",{className:"h-64 md:h-[600px] pointer-events-none opacity-0 shrink-0"})]})},_e=({onBackToRoleSelect:w})=>{const{currentUser:v,setChatVisibility:X}=c.useContext(xe),[x,L]=c.useState("list"),[k,R]=Pe("team",""),f=c.useMemo(()=>((v==null?void 0:v.Team)||"").split(",").map(M=>M.trim()).filter(Boolean),[v]);return c.useEffect(()=>{X(x!=="create")},[x]),c.useEffect(()=>{f.length===1&&!k&&R(f[0])},[f,k]),f.length===0?e.jsxs("div",{className:"page-card text-center p-12 mt-20 max-w-2xl mx-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["សួស្តី, ",v==null?void 0:v.FullName]}),e.jsx("p",{className:"text-gray-400",children:"មិនមានទិន្នន័យក្រុម"}),e.jsx("button",{onClick:w,className:"btn btn-secondary mt-6",children:"ត្រឡប់"})]}):k?x==="create"?e.jsx(qe,{team:k,onSaveSuccess:()=>L("list"),onCancel:()=>L("list")}):e.jsxs("div",{className:"w-full max-w-[115rem] mx-auto p-2 sm:p-4 animate-fade-in overflow-x-hidden min-h-[2000px]",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-white flex items-center gap-3",children:["ការកម្មង់របស់ខ្ញុំ",e.jsx("span",{className:"text-[10px] bg-blue-600/20 text-blue-400 px-3 py-1 rounded-full border border-blue-500/20 uppercase tracking-[0.2em]",children:k})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[f.length>1&&e.jsxs("button",{onClick:()=>R(""),className:"flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-blue-600 text-gray-300 hover:text-white rounded-xl text-[11px] font-black uppercase transition-all border border-gray-700 hover:border-blue-500 hover:shadow-lg hover:shadow-blue-600/20 active:scale-95",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"ប្តូរក្រុម"]}),(v==null?void 0:v.IsSystemAdmin)&&e.jsxs("button",{onClick:w,className:"flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-yellow-600 text-gray-300 hover:text-white rounded-xl text-[11px] font-black uppercase transition-all border border-gray-700 hover:border-yellow-500 hover:shadow-lg hover:shadow-yellow-600/20 active:scale-95",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z"})}),"ជ្រើសរើសតួនាទី"]})]})]}),e.jsx("button",{onClick:()=>L("create"),className:"btn btn-primary w-full md:w-auto px-10 shadow-xl shadow-blue-600/20 h-14 text-base font-black active:scale-95 transition-all rounded-2xl uppercase tracking-widest",children:"បង្កើតការកម្មង់ថ្មី"})]}),e.jsx("div",{className:"bg-gray-800/20 border border-gray-700/50 rounded-[2.5rem] p-2 sm:p-6 shadow-2xl overflow-visible min-h-[2000px]",children:e.jsx(Re,{team:k})})]}):e.jsxs("div",{className:"w-full max-w-5xl mx-auto p-4 mt-10 md:mt-20 animate-fade-in text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-8",children:"សូមជ្រើសរើសក្រុមដើម្បីបន្ត"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:f.map(M=>e.jsx("button",{onClick:()=>R(M),className:"bg-gray-800/50 border border-gray-700 rounded-2xl p-8 hover:border-blue-500 transition-all group shadow-xl",children:e.jsx("span",{className:"text-xl font-bold text-white group-hover:text-blue-400 transition-colors",children:M})},M))})]})};export{_e as default};
