import{r as a,A as J,j as e,M as G,c as H,S as B,W as P,f as _}from"./index-D_lpKiAk.js";import{c as q}from"./imageCompressor-D5vYYzIg.js";const X=({onClose:l})=>{const{currentUser:t,refreshData:A,updateCurrentUser:E}=a.useContext(J),[f,C]=a.useState("general"),[b,I]=a.useState((t==null?void 0:t.FullName)||""),[u,L]=a.useState((t==null?void 0:t.ProfilePictureURL)||""),[g,S]=a.useState(""),[m,M]=a.useState(""),[W,T]=a.useState(""),[j,R]=a.useState(!1),[w,D]=a.useState(!1),[y,F]=a.useState(!1),[x,o]=a.useState(""),[p,c]=a.useState(""),[h,n]=a.useState(!1),[v,O]=a.useState(!1),N=a.useRef(null),U=async s=>{if(s){O(!0),o("");try{const r=await q(s,.8,1024),i={fileData:await _(r),fileName:s.name,mimeType:r.type,userName:(t==null?void 0:t.UserName)||"unknown"},z=await fetch(`${P}/api/upload-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),k=await z.json();if(!z.ok||k.status!=="success")throw new Error(k.message||"Image upload failed");L(k.url)}catch(r){console.error(r),o(r.message)}finally{O(!1)}}},V=async s=>{s.preventDefault(),o(""),c(""),n(!0);try{const r={userName:t==null?void 0:t.UserName,fullName:b,profilePictureURL:u},d=await fetch(`${P}/api/profile/update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await d.json();if(!d.ok||i.status!=="success")throw new Error(i.message||"Failed to update profile.");E({FullName:b,ProfilePictureURL:u}),await A(),c("ព័ត៌មានផ្ទាល់ខ្លួនត្រូវបានកែប្រែជោគជ័យ!"),setTimeout(l,1500)}catch(r){o(r.message)}finally{n(!1)}},$=async s=>{if(s.preventDefault(),o(""),c(""),n(!0),!g){o("សូមបញ្ចូលពាក្យសម្ងាត់បច្ចុប្បន្នរបស់អ្នក។"),n(!1);return}if(!m){o("សូមបញ្ចូលពាក្យសម្ងាត់ថ្មី។"),n(!1);return}if(m.length<6){o("ពាក្យសម្ងាត់ថ្មីត្រូវមានយ៉ាងតិច ៦ តួអក្សរ។"),n(!1);return}if(m!==W){o("ពាក្យសម្ងាត់ថ្មី និងការបញ្ជាក់មិនตรงគ្នាទេ។"),n(!1);return}try{const r={userName:t==null?void 0:t.UserName,oldPassword:g,newPassword:m},d=await fetch(`${P}/api/profile/change-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await d.json();if(!d.ok||i.status!=="success")throw new Error(i.message||"Failed to change password.");c("ពាក្យសម្ងាត់ត្រូវបានផ្លាស់ប្តូរជោគជ័យ!"),S(""),M(""),T(""),setTimeout(l,1500)}catch(r){o(r.message)}finally{n(!1)}};return e.jsxs(G,{isOpen:!0,onClose:l,children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"កែសម្រួល Profile"}),e.jsx("button",{onClick:l,className:"text-2xl text-gray-500 hover:text-white",children:"×"})]}),e.jsxs("div",{className:"flex border-b border-gray-700 mb-6",children:[e.jsx("button",{className:`flex-1 pb-2 text-sm font-medium transition-colors ${f==="general"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"}`,onClick:()=>{C("general"),o(""),c("")},children:"ព័ត៌មានទូទៅ"}),e.jsx("button",{className:`flex-1 pb-2 text-sm font-medium transition-colors ${f==="security"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-gray-300"}`,onClick:()=>{C("security"),o(""),c("")},children:"សុវត្ថិភាព (Password)"})]}),f==="general"?e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:H(u),alt:"Profile",className:"w-24 h-24 rounded-full object-cover border-4 border-gray-700"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",onClick:()=>{var s;return(s=N.current)==null?void 0:s.click()},children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),e.jsx("input",{type:"file",accept:"image/*",ref:N,onChange:s=>s.target.files&&U(s.target.files[0]),className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>{var s;return(s=N.current)==null?void 0:s.click()},className:"text-sm text-blue-400 mt-2 hover:underline",disabled:v,children:v?"កំពុង Upload...":"ប្តូររូបភាព"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"ឈ្មោះគណនី (UserName)"}),e.jsx("input",{type:"text",value:(t==null?void 0:t.UserName)||"",className:"form-input bg-gray-800 cursor-not-allowed text-gray-500",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-fullname",className:"block text-sm font-medium text-gray-400 mb-2",children:"ឈ្មោះពេញ (Full Name)"}),e.jsx("input",{type:"text",id:"edit-fullname",value:b,onChange:s=>I(s.target.value),className:"form-input",required:!0})]}),e.jsxs("div",{className:"hidden",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Image URL"}),e.jsx("input",{type:"text",value:u,onChange:s=>L(s.target.value),className:"form-input"})]}),x&&e.jsx("p",{className:"text-red-400 text-sm bg-red-900/20 p-2 rounded",children:x}),p&&e.jsx("p",{className:"text-green-400 text-sm bg-green-900/20 p-2 rounded",children:p}),e.jsxs("div",{className:"flex justify-end pt-4 space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"btn btn-secondary",children:"បោះបង់"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:h||v,children:h?e.jsx(B,{size:"sm"}):"រក្សាទុក"})]})]}):e.jsxs("form",{onSubmit:$,className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"ពាក្យសម្ងាត់បច្ចុប្បន្ន"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:j?"text":"password",value:g,onChange:s=>S(s.target.value),className:"form-input pr-10"}),e.jsx("button",{type:"button",onClick:()=>R(!j),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white",children:j?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 1.274-4.057 5.064-7 9.542-7 .847 0 1.67 .126 2.454 .364m-3.033 2.446a3 3 0 11-4.243 4.243m4.242-4.242l4.243 4.243M3 3l18 18"})}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"ពាក្យសម្ងាត់ថ្មី"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:w?"text":"password",value:m,onChange:s=>M(s.target.value),className:"form-input pr-10"}),e.jsx("button",{type:"button",onClick:()=>D(!w),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white",children:w?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 1.274-4.057 5.064-7 9.542-7 .847 0 1.67 .126 2.454 .364m-3.033 2.446a3 3 0 11-4.243 4.243m4.242-4.242l4.243 4.243M3 3l18 18"})}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"បញ្ជាក់ពាក្យសម្ងាត់ថ្មី"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",value:W,onChange:s=>T(s.target.value),className:"form-input pr-10"}),e.jsx("button",{type:"button",onClick:()=>F(!y),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white",children:y?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7 1.274-4.057 5.064-7 9.542-7 .847 0 1.67 .126 2.454 .364m-3.033 2.446a3 3 0 11-4.243 4.243m4.242-4.242l4.243 4.243M3 3l18 18"})}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),x&&e.jsx("p",{className:"text-red-400 text-sm bg-red-900/20 p-2 rounded",children:x}),p&&e.jsx("p",{className:"text-green-400 text-sm bg-green-900/20 p-2 rounded",children:p}),e.jsxs("div",{className:"flex justify-end pt-4 space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"btn btn-secondary",children:"បោះបង់"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:h,children:h?e.jsx(B,{size:"sm"}):"ផ្លាស់ប្តូរពាក្យសម្ងាត់"})]})]})]})};export{X as E};
