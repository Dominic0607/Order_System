import{r as l,j as e,M as ue,S as ne,A as xe,c as z,W as pe,u as Le}from"./index-fq51JQK_.js";import{S as Me,O as Te}from"./OrdersList-D-4rZ8k9.js";const Ie=({isOpen:b,onClose:h,url:N})=>{const[i,y]=l.useState(!0);return l.useEffect(()=>{b&&y(!0)},[b,N]),b?e.jsxs(ue,{isOpen:b,onClose:h,maxWidth:"max-w-4xl",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"ស្វែងរកទីតាំង"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:'បន្ទាប់ពីរកឃើញទីតាំងត្រឹមត្រូវ សូមចម្លង (Copy) អាសយដ្ឋាន ឬ Link រួចបិទផ្ទាំងនេះ ហើយបិទភ្ជាប់ (Paste) ចូលទៅក្នុងប្រអប់ "ទីតាំងលម្អិត" វិញ។'}),e.jsxs("div",{className:"relative w-full h-[70vh] bg-gray-900 rounded-lg overflow-hidden border border-gray-700",children:[i&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx(ne,{size:"lg"}),e.jsx("span",{className:"ml-3 text-gray-300",children:"កំពុងដំណើរការផែនទី..."})]}),e.jsx("iframe",{src:N,width:"100%",height:"100%",style:{border:0},allowFullScreen:!1,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",onLoad:()=>y(!1),className:i?"opacity-0":"opacity-100 transition-opacity duration-500"})]})]}):null},De=({onClose:b,onCodeScanned:h,scanMode:N,setScanMode:i,productsInOrder:y,masterProducts:v})=>{const m=l.useRef(null),u=l.useRef(null),[f,F]=l.useState(null),[_,q]=l.useState(!0),[t,g]=l.useState(null),[te,O]=l.useState(1),[E,I]=l.useState(null),[A,B]=l.useState(!1),[M,R]=l.useState(!1),[Q,Y]=l.useState(0),P=l.useCallback(j=>{var T;const C=parseFloat(j.target.value);O(C),(T=m.current)!=null&&T.isScanning&&m.current.applyVideoConstraints({advanced:[{zoom:C}]}).catch(D=>console.error("Failed to apply zoom",D))},[]),S=l.useCallback(async()=>{var j;if((j=m.current)!=null&&j.isScanning&&M){const C=!A;try{await m.current.applyVideoConstraints({advanced:[{torch:C}]}),B(C)}catch(T){console.error("Failed to toggle torch",T)}}},[A,M]);return l.useEffect(()=>{const j=new window.Html5Qrcode("barcode-reader-container");m.current=j;let C=0;const T=(p,W)=>{var X;const se=Date.now();if(se-C<1e3)return;C=se;const K=v.find(w=>w.Barcode&&w.Barcode.trim()===p.trim());if(K){const w=y.find(U=>U.name===K.ProductName),$=w?w.quantity:0;if(N==="single"&&w)F(`⚠️ ${K.ProductName} (មានរួចហើយ)`);else{const U=N==="increment"?$+1:1;F(`✅ ${K.ProductName} (ចំនួន: ${U})`),Y(H=>H+1)}}else F(`❌ រកមិនឃើញ Barcode: ${p}`);h(p);const Z=u.current,V=document.querySelector("#barcode-reader-container video");if(Z&&V&&((X=W.result)!=null&&X.points)){const w=Z.getContext("2d");if(!w)return;Z.width=V.clientWidth,Z.height=V.clientHeight;const $=V.clientWidth/V.videoWidth,U=V.clientHeight/V.videoHeight;w.clearRect(0,0,Z.width,Z.height),w.beginPath();const H=W.result.points;w.moveTo(H[0].x*$,H[0].y*U);for(let L=1;L<H.length;L++)w.lineTo(H[L].x*$,H[L].y*U);w.closePath(),w.lineWidth=4,w.strokeStyle="#4ade80",w.fillStyle="rgba(74, 222, 128, 0.3)",w.stroke(),w.fill(),setTimeout(()=>{if(F(null),u.current){const L=u.current.getContext("2d");L==null||L.clearRect(0,0,u.current.width,u.current.height)}},1500)}},D={fps:10,qrbox:{width:250,height:250},supportedScanTypes:[]};return j.start({facingMode:"environment"},D,T,()=>{}).then(()=>{const p=j.getRunningTrackCapabilities();p&&(p.zoom&&(I({min:p.zoom.min,max:p.zoom.max,step:p.zoom.step}),O(p.zoom.min||1)),p.torch&&R(!0)),q(!1)}).catch(p=>{g("មិនអាចបើក Camera បានទេ។"),q(!1)}),()=>{var p;(p=m.current)!=null&&p.isScanning&&m.current.stop().catch(()=>{})}},[h,y,v,N]),e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col p-2 sm:p-4 animate-fade-in",children:[e.jsx("style",{children:`
              #barcode-reader-container { width: 100%; height: 100%; overflow: hidden; }
              #barcode-reader-container video { width: 100% !important; height: 100% !important; object-fit: cover; }
            `}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center text-white mb-2 sm:mb-4",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold",children:["Scan Barcode",e.jsxs("span",{className:"text-gray-400 text-base font-normal ml-2",children:["(",Q," scanned)"]})]}),e.jsx("button",{onClick:b,className:"p-2 bg-gray-700/50 rounded-full hover:bg-gray-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-grow relative flex items-center justify-center min-h-0 w-full max-w-2xl mx-auto",children:[e.jsx("div",{id:"barcode-reader-container",className:"w-full h-full aspect-square bg-gray-900 rounded-lg overflow-hidden"}),e.jsx("canvas",{ref:u,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-0 border-[20px] sm:border-[30px] border-black/50 box-border rounded-lg"}),_&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white",children:[e.jsx(ne,{size:"lg"}),e.jsx("p",{className:"mt-4 font-semibold",children:"កំពុងបើក Camera..."})]}),t&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white p-4 text-center",children:[e.jsx("p",{className:"font-semibold text-red-400",children:"កំហុស Camera"}),e.jsx("p",{className:"mt-2 text-sm",children:t})]}),f&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-gray-800/80 border border-gray-600 text-white px-4 py-2 rounded-lg font-semibold z-20",children:f})]}),!_&&!t&&e.jsxs("div",{className:"flex-shrink-0 mt-4 space-y-4 w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4 items-center",children:[e.jsxs("div",{className:"flex justify-center items-center space-x-2 bg-gray-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>i("increment"),className:`flex-1 text-sm py-2 px-3 rounded-md transition-colors ${N==="increment"?"bg-blue-600 text-white":"hover:bg-gray-700"}`,children:"បូកចំនួន"}),e.jsx("button",{onClick:()=>i("single"),className:`flex-1 text-sm py-2 px-3 rounded-md transition-colors ${N==="single"?"bg-blue-600 text-white":"hover:bg-gray-700"}`,children:"រាប់មួយ"})]}),e.jsx("div",{className:"flex justify-center",children:M&&e.jsx("button",{onClick:S,className:`p-3 rounded-full transition-colors ${A?"bg-yellow-400 text-gray-900":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2zM5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1z",clipRule:"evenodd"})})})})]}),E&&e.jsx("div",{className:"flex items-center gap-2 sm:gap-4 bg-gray-800 p-2 rounded-lg",children:e.jsx("input",{type:"range",min:E.min,max:E.max,step:E.step,value:te,onChange:P,className:"w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer"})})]})]})},ce={id:Date.now(),name:"",quantity:1,originalPrice:0,finalPrice:0,total:0,discountPercent:0,colorInfo:"",image:"",cost:0,discountType:"percent",discountAmountInput:"",discountPercentInput:"",finalPriceInput:"",applyDiscountToTotal:!1},re=[{number:1,title:"អតិថិជន"},{number:2,title:"ផលិតផល"},{number:3,title:"ដឹកជញ្ជូន"},{number:4,title:"ផ្ទៀងផ្ទាត់"}],$e=({team:b,onSaveSuccess:h,onCancel:N})=>{const{appData:i,currentUser:y,apiKey:v,previewImage:m}=l.useContext(xe),[u,f]=l.useState(1),[F,_]=l.useState(!1),q=l.useMemo(()=>({page:"",telegramValue:"",fulfillmentStore:"",customer:{name:"",phone:"",province:"",district:"",sangkat:"",additionalLocation:"",shippingFee:""},products:[{...ce,id:Date.now()}],shipping:{method:"",details:"",cost:""},payment:{status:"Unpaid",info:""},telegram:{schedule:!1,time:null},subtotal:0,grandTotal:0,note:""}),[]),[t,g]=l.useState(q),[te,O]=l.useState(!1),[E,I]=l.useState(""),[A,B]=l.useState(null),[M,R]=l.useState(null),[Q,Y]=l.useState(""),[P,S]=l.useState(""),[j,C]=l.useState(""),[T,D]=l.useState(!1),[p,W]=l.useState("charge"),[se,K]=l.useState(!1),[Z,V]=l.useState(""),[X,w]=l.useState("increment"),$=l.useMemo(()=>`createOrderDraft_${y==null?void 0:y.UserName}_${b}`,[y,b]);l.useEffect(()=>{window.innerWidth<768&&window.scrollTo({top:0,behavior:"smooth"})},[u]),l.useEffect(()=>{var r,o;try{const a=localStorage.getItem($);if(a){const n=JSON.parse(a);if(g(c=>({...c,...n})),n.customer&&typeof n.customer.shippingFee=="number"&&W(n.customer.shippingFee===0?"free":"charge"),n.customer.phone){const c=n.customer.phone,d=(r=i.phoneCarriers)==null?void 0:r.find(s=>(s.Prefixes||"").split(",").some(x=>c.startsWith(x.trim())));Y(d?z(d.CarrierLogoURL):"")}if(n.shipping.method){const c=(o=i.shippingMethods)==null?void 0:o.find(d=>d.MethodName===n.shipping.method);R(c||null),S(c?z(c.LogosURL):"")}}}catch{localStorage.removeItem($)}},[$,i.phoneCarriers,i.shippingMethods]),l.useEffect(()=>{const r=setTimeout(()=>{localStorage.setItem($,JSON.stringify(t))},500);return()=>clearTimeout(r)},[t,$]);const U=()=>_(!0),H=()=>{localStorage.removeItem($),_(!1),N()},L=l.useMemo(()=>i.pages?i.pages.filter(r=>r.Team===b):[],[i.pages,b]),le=l.useMemo(()=>t.page&&L.find(r=>r.PageName===t.page)||null,[t.page,L]);l.useEffect(()=>{if(L.length===1&&!t.page){const r=L[0];g(o=>({...o,page:r.PageName,telegramValue:r.TelegramValue,fulfillmentStore:r.DefaultStore||o.fulfillmentStore}))}},[L,t.page]);const ge=l.useMemo(()=>{if(!i.locations)return[];const r=[...new Set(i.locations.map(o=>o.Province))];return r.sort((o,a)=>String(o).localeCompare(String(a),"km")),r},[i.locations]),he=l.useMemo(()=>!i.locations||!t.customer.province?[]:[...new Set(i.locations.filter(r=>r.Province===t.customer.province).map(r=>r.District))].sort((r,o)=>String(r).localeCompare(String(o),"km")),[i.locations,t.customer.province]),be=l.useMemo(()=>!i.locations||!t.customer.province||!t.customer.district?[]:[...new Set(i.locations.filter(r=>r.Province===t.customer.province&&r.District===t.customer.district).map(r=>r.Sangkat).filter(Boolean))].sort((r,o)=>String(r).localeCompare(String(o),"km")),[i.locations,t.customer.province,t.customer.district]);l.useEffect(()=>{const r=t.products.reduce((a,n)=>a+n.total,0),o=r+(Number(t.customer.shippingFee)||0);(r!==t.subtotal||o!==t.grandTotal)&&g(a=>({...a,subtotal:r,grandTotal:o}))},[t.products,t.customer.shippingFee]);const oe=(r,o)=>{const a={...r},n=o.find(x=>x.ProductName===a.name);a.quantity=Math.max(1,Number(a.quantity)||1),a.originalPrice=Math.max(0,n&&Number(n.Price)||0),a.cost=Math.max(0,n&&Number(n.Cost)||0);const c=a.quantity*a.originalPrice;let d=c,s=0;switch(a.discountType){case"percent":const x=Math.max(0,Number(a.discountPercentInput)||0);s=c*(x/100),d=c-s;break;case"amount":const J=Math.max(0,Number(a.discountAmountInput)||0);s=a.quantity>1&&a.applyDiscountToTotal?J:J*a.quantity,d=c-s;break;case"custom":const ae=Math.max(0,Number(a.finalPriceInput)||0);d=a.quantity*ae,s=c-d,a.finalPrice=ae;break}return a.total=Math.max(0,d),a.finalPrice=a.quantity>0?a.total/a.quantity:0,a.discountPercent=c>0?s/c*100:0,a.discountType!=="custom"&&(a.finalPriceInput=a.finalPrice.toFixed(2)),a},fe=l.useCallback(r=>{const o=i.products.find(a=>a.Barcode&&a.Barcode.trim()===r.trim());o&&(g(a=>{const n=a.products.findIndex(d=>d.name===o.ProductName);let c;if(n>-1){const d={...a.products[n]};X==="increment"&&(d.quantity+=1);const s=oe(d,i.products);c=[...a.products],c[n]=s}else{const d=a.products.findIndex(J=>!J.name),s={...ce,id:Date.now(),name:o.ProductName,quantity:1,originalPrice:o.Price,cost:o.Cost,image:o.ImageURL},x=oe(s,i.products);d>-1?(c=[...a.products],c[d]=x):c=[...a.products,x]}return{...a,products:c}}),X==="single"&&D(!1))},[i.products,X]),ee=r=>{const{name:o,value:a}=r.target;if(o==="phone"){let n=a.replace(/[^0-9]/g,"");n.length>1&&n.startsWith("00")?n="0"+n.substring(2):n.length>0&&!n.startsWith("0")&&(n="0"+n);let c=null;n.length>=2&&i.phoneCarriers&&(c=i.phoneCarriers.find(d=>(d.Prefixes||"").split(",").some(s=>n.startsWith(s.trim())))),Y(c?z(c.CarrierLogoURL):""),g(d=>({...d,customer:{...d.customer,phone:n}}));return}if(o==="shippingFee"){const n=a===""?"":Math.max(0,parseFloat(a));g(c=>({...c,customer:{...c.customer,shippingFee:n}}));return}g(n=>{let c={...n.customer,[o]:a};return o==="province"?(c.district="",c.sangkat=""):o==="district"&&(c.sangkat=""),{...n,customer:c}})},G=(r,o,a)=>{g(n=>{const c=[...n.products];let d={...c[r]};if(["discountPercentInput","discountAmountInput","finalPriceInput"].includes(o)){let s=String(a).replace(/[^0-9.]/g,"").replace(/(\..*?)\./g,"$1");s.startsWith("0")&&s.length>1&&!s.startsWith("0.")&&(s=String(parseFloat(s))),d[o]=s}else d[o]=a;if(o==="name"){const s=i.products.find(x=>x.ProductName===a);d.name=a,s?(d.originalPrice=s.Price,d.image=s.ImageURL,d.cost=s.Cost,d.discountType="percent",d.finalPrice=s.Price,d.finalPriceInput=String(s.Price)):(d.originalPrice=0,d.image="",d.cost=0,d.discountType="custom",d.finalPrice=0)}return o==="discountType"&&(d.discountPercentInput="",d.discountAmountInput="",d.finalPrice=d.originalPrice,d.finalPriceInput=String(d.originalPrice)),c[r]=oe(d,i.products),{...n,products:c}})},je=r=>{var n;const o=r.target.value,a=((n=i.shippingMethods)==null?void 0:n.find(c=>c.MethodName===o))||null;R(a),S(a?z(a.LogosURL):""),g(c=>({...c,shipping:{...c.shipping,method:o,details:a!=null&&a.RequireDriverSelection?"":o}}))},ye=r=>{const{name:o,value:a}=r.target;let n=a;o==="cost"&&(n.startsWith("0")&&n.length>1&&!n.startsWith("0.")&&(n=String(parseFloat(n))),n=String(Math.max(0,parseFloat(n)||0))),g(c=>({...c,shipping:{...c.shipping,[o]:n}}))},ve=r=>{g(o=>({...o,shipping:{...o.shipping,details:r}}))},Ne=r=>{var a;const o=((a=i.bankAccounts)==null?void 0:a.find(n=>n.BankName===r))||null;C(o?z(o.LogoURL):""),g(n=>({...n,payment:{...n.payment,info:r}}))},de=r=>{W(r),g(o=>({...o,customer:{...o.customer,shippingFee:r==="free"?0:""}}))},we=()=>{if(!v){alert("API Key Required for Maps.");return}const{province:r,district:o,sangkat:a,additionalLocation:n}=t.customer,c=[n,a,o,r,"Cambodia"].filter(Boolean).join(", ");V(`https://www.google.com/maps/embed/v1/search?key=${v}&q=${encodeURIComponent(c)}`),K(!0)},me=r=>{switch(I(""),r){case 1:return!t.customer.name||!t.customer.phone||!t.customer.province||!t.page||!t.fulfillmentStore?(I("សូមបំពេញឈ្មោះ, លេខទូរស័ព្ទ, ខេត្ត/ក្រុង, Page និងឃ្លាំងបញ្ចេញទំនិញ។"),!1):(t.customer.additionalLocation||"").match(/(https?:\/\/[^\s]+)|(www\.[^\s]+)|(maps\.app\.goo\.gl)/gi)?(I('ហាមបញ្ចូល Link ក្នុង "ទីតាំងលម្អិត"។ សូមប្រើ "ចំណាំ" នៅជំហានចុងក្រោយ។'),!1):p==="charge"&&(t.customer.shippingFee===""||t.customer.shippingFee<0)?(I("សូមបញ្ចូលតម្លៃដឹកជញ្ជូនឱ្យបានត្រឹមត្រូវ។"),!1):!0;case 2:return t.products.length===0||t.products.some(o=>!o.name||o.quantity<=0)?(I("សូមពិនិត្យទិន្នន័យផលិតផល។"),!1):!0;case 3:return!t.shipping.method||M!=null&&M.RequireDriverSelection&&!t.shipping.details||t.shipping.cost===""||parseFloat(t.shipping.cost)<0?(I("សូមពិនិត្យព័ត៌មានដឹកជញ្ជូន (តម្លៃដឹកមិនអាចអវិជ្ជមានទេ)។"),!1):!0;case 4:return t.payment.status==="Paid"&&!t.payment.info?(I("សូមជ្រើសរើសគណនីធនាគារ Tune។"),!1):t.telegram.schedule&&!t.telegram.time?(I("សូមជ្រើសរើសពេលវេលាផ្ញើសារ។"),!1):!0;default:return!0}},ke=()=>{me(u)&&f(u+1)},Se=()=>{u>1&&f(u-1)},Ce=async()=>{for(const a of re)if(!me(a.number)){f(a.number);return}O(!0);let r="0"+t.customer.phone.replace(/[^0-9]/g,"").replace(/^0+/,"");const o={currentUser:y,selectedTeam:b,page:t.page,fulfillmentStore:t.fulfillmentStore,telegramValue:t.telegramValue,customer:{...t.customer,phone:r,shippingFee:Number(t.customer.shippingFee)||0},products:t.products.map(a=>({name:a.name,quantity:a.quantity,originalPrice:a.originalPrice,finalPrice:a.finalPrice,total:a.total,colorInfo:a.colorInfo,cost:a.cost})),shipping:{...t.shipping,cost:Number(t.shipping.cost)||0},payment:t.payment,telegram:t.telegram,subtotal:t.subtotal,grandTotal:t.grandTotal,note:t.note};try{const a=await fetch(`${pe}/api/submit-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),n=await a.json();if(!a.ok||n.status!=="success")throw new Error(n.message||"Error");localStorage.removeItem($),B({type:"success",message:`ជោគជ័យ! Order ID: ${n.orderId}`}),setTimeout(h,3e3)}catch(a){B({type:"error",message:`បរាជ័យ: ${a.message}`}),setTimeout(()=>B(null),3e3)}finally{O(!1)}},Pe=()=>{var r,o,a,n,c;switch(u){case 1:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-4 sm:space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ព័ត៌មានអតិថិជន & Page"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Facebook Page*"}),e.jsxs("select",{name:"page",value:t.page,className:"form-select",onChange:s=>{const x=L.find(J=>J.PageName===s.target.value);g({...t,page:s.target.value,telegramValue:x?x.TelegramValue:"",fulfillmentStore:(x==null?void 0:x.DefaultStore)||t.fulfillmentStore})},required:!0,children:[e.jsx("option",{value:"",children:"-- ជ្រើសរើស Page* --"}),L.map(s=>e.jsx("option",{value:s.PageName,children:s.PageName},s.PageName))]})]}),le&&e.jsxs("div",{className:"bg-gray-900/60 p-3 sm:p-4 rounded-2xl border border-blue-500/20 flex items-center gap-3 sm:gap-4 shadow-inner",children:[e.jsx("img",{src:z(le.PageLogoURL),alt:"Page",className:"w-12 h-12 sm:w-16 sm:h-16 rounded-full object-cover border-2 border-blue-500 shadow-lg bg-gray-800"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-blue-400 text-[10px] font-black uppercase tracking-widest mb-0.5",children:"Selected Page"}),e.jsx("h4",{className:"text-white font-black text-sm sm:text-base truncate leading-tight",children:le.PageName})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"ឃ្លាំងបញ្ចេញទំនិញ (Store)*"}),e.jsxs("select",{value:t.fulfillmentStore,onChange:s=>g({...t,fulfillmentStore:s.target.value}),className:"form-select",children:[e.jsx("option",{value:"",children:"-- ជ្រើសរើសឃ្លាំង --"}),(r=i.stores)==null?void 0:r.map(s=>e.jsx("option",{value:s.StoreName,children:s.StoreName},s.StoreName))]})]}),e.jsx("input",{type:"text",name:"name",value:t.customer.name,placeholder:"ឈ្មោះអតិថិជន*",className:"form-input",onChange:ee,required:!0}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",name:"phone",value:t.customer.phone,placeholder:"លេខទូរស័ព្ទ*",className:"form-input pr-12",onChange:ee,required:!0}),Q&&e.jsx("img",{src:Q,alt:"Carrier",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-auto object-contain"})]}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("select",{name:"province",value:t.customer.province,className:"form-select",onChange:ee,required:!0,children:[e.jsx("option",{value:"",children:"-- ខេត្ត/រាជធានី* --"}),ge.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{name:"district",value:t.customer.district,className:"form-select",onChange:ee,disabled:!t.customer.province,children:[e.jsx("option",{value:"",children:"-- ស្រុក/ខណ្ឌ --"}),he.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{name:"sangkat",value:t.customer.sangkat,className:"form-select",onChange:ee,disabled:!t.customer.district,children:[e.jsx("option",{value:"",children:"-- ឃុំ/សង្កាត់ --"}),be.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"input-label",children:"ទីតាំងលម្អិត (ផ្ទះលេខ, ផ្លូវ)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"additionalLocation",value:t.customer.additionalLocation,placeholder:"បញ្ចូលទីតាំងលម្អិត...",className:"form-input",onChange:ee}),e.jsx("button",{type:"button",onClick:we,className:"btn btn-secondary !p-2 sm:!p-2.5 shadow-lg",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"input-label",children:"ថ្លៃសេវាដឹកជញ្ជូន"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{type:"button",onClick:()=>de("charge"),className:`flex-1 btn py-2 sm:py-2.5 text-xs sm:text-sm ${p==="charge"?"btn-primary":"btn-secondary"}`,children:"គិតថ្លៃសេវា"}),e.jsx("button",{type:"button",onClick:()=>de("free"),className:`flex-1 btn py-2 sm:py-2.5 text-xs sm:text-sm ${p==="free"?"!bg-red-600 hover:!bg-red-700":"btn-secondary"}`,children:"មិនគិតថ្លៃសេវា"})]}),p==="charge"&&e.jsx("input",{type:"number",min:"0",name:"shippingFee",value:t.customer.shippingFee,placeholder:"តម្លៃដឹកជញ្ជូន (ឧ. 1.5)*",className:"form-input",onChange:ee,required:!0})]})]})]});case 2:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-4 sm:space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ផលិតផល & ការបញ្ចុះតម្លៃ"}),e.jsx("div",{className:"space-y-4 sm:space-y-6",children:t.products.map((s,x)=>{const J=s.quantity*s.originalPrice,ae=J-s.total;return e.jsxs("div",{className:"p-3 sm:p-5 bg-gray-800/40 rounded-2xl sm:rounded-3xl border border-gray-700 relative shadow-xl overflow-hidden group",children:[e.jsx("button",{type:"button",onClick:()=>{t.products.length>1&&g({...t,products:t.products.filter((k,ie)=>ie!==x)})},className:"absolute top-2 right-2 sm:top-4 sm:right-4 text-red-400 bg-red-400/10 rounded-full h-6 w-6 sm:h-8 sm:w-8 flex items-center justify-center border border-red-400/20 hover:bg-red-600 hover:text-white transition-all z-10",disabled:t.products.length<=1,children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 sm:gap-6 mb-4 sm:mb-6",children:[e.jsx("div",{className:"md:col-span-2 flex justify-center",children:e.jsx("div",{className:"w-20 h-20 sm:w-28 sm:h-28 bg-gray-900 rounded-xl sm:rounded-2xl overflow-hidden border-2 border-gray-700 shadow-inner group-hover:border-blue-500/50 transition-colors",children:e.jsx("img",{src:z(s.image),className:"w-full h-full object-cover",alt:""})})}),e.jsxs("div",{className:"md:col-span-10 grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ឈ្មោះផលិតផល*"}),e.jsx(Me,{products:i.products||[],selectedProductName:s.name,onSelect:k=>G(x,"name",k)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ចំនួន*"}),e.jsxs("div",{className:"quantity-stepper !max-w-full",children:[e.jsx("button",{type:"button",onClick:()=>G(x,"quantity",Math.max(1,s.quantity-1)),disabled:s.quantity<=1,children:"-"}),e.jsx("span",{className:"quantity-display text-sm",children:s.quantity}),e.jsx("button",{type:"button",onClick:()=>G(x,"quantity",s.quantity+1),children:"+"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ពណ៌/សម្គាល់"}),e.jsx("input",{type:"text",list:`colors-datalist-${s.id}`,value:s.colorInfo,onChange:k=>G(x,"colorInfo",k.target.value),className:"form-input text-sm",placeholder:"ឧ. ខៀវ, XL"}),e.jsx("datalist",{id:`colors-datalist-${s.id}`,children:(i.colors||[]).map((k,ie)=>e.jsx("option",{value:k.ColorName},ie))})]})]})]})]}),e.jsxs("div",{className:"bg-black/20 rounded-xl sm:rounded-[2rem] p-3 sm:p-6 border border-white/5 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"h-px flex-grow bg-gray-700/50"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] sm:tracking-[0.3em] whitespace-nowrap",children:"Pricing & Discount"}),e.jsx("div",{className:"h-px flex-grow bg-gray-700/50"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"flex bg-gray-900/50 p-1 rounded-xl sm:rounded-2xl border border-gray-700 shadow-inner",children:["percent","amount","custom"].map(k=>e.jsx("button",{type:"button",onClick:()=>G(x,"discountType",k),className:`flex-1 flex flex-col items-center justify-center py-2 sm:py-2.5 rounded-lg sm:rounded-xl transition-all duration-300 ${s.discountType===k?"bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:e.jsx("span",{className:"text-[9px] sm:text-[11px] font-black uppercase tracking-widest",children:k==="percent"?"បញ្ចុះ %":k==="amount"?"បញ្ចុះ $":"កែតម្លៃលក់"})},k))}),e.jsxs("div",{className:"relative animate-fade-in",children:[s.discountType==="percent"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"បញ្ចូលភាគរយបញ្ចុះតម្លៃ (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",max:"100",placeholder:"0",value:s.discountPercentInput,onChange:k=>G(x,"discountPercentInput",k.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-blue-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"%"})]})]}),s.discountType==="amount"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"បញ្ចូលទឹកប្រាក់បញ្ចុះតម្លៃ ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",placeholder:"0.00",value:s.discountAmountInput,onChange:k=>G(x,"discountAmountInput",k.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-red-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"$"})]}),s.quantity>1&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 bg-black/20 rounded-lg mt-1 sm:mt-2 border border-white/5",children:[e.jsx("input",{type:"checkbox",checked:s.applyDiscountToTotal,onChange:k=>G(x,"applyDiscountToTotal",k.target.checked),className:"w-4 h-4 rounded border-gray-600 bg-gray-800 text-blue-500"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] text-gray-400 uppercase font-black",children:"បញ្ចុះលើតម្លៃសរុប"})]})]}),s.discountType==="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"កំណត់តម្លៃលក់ថ្មីក្នុង ១ ឯកតា ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"0.00",value:s.finalPriceInput,onChange:k=>G(x,"finalPriceInput",k.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-emerald-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"$"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-900/60 rounded-xl sm:rounded-[1.5rem] p-3 sm:p-5 border border-white/5 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px] sm:text-xs",children:[e.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Original Subtotal"}),e.jsxs("span",{className:"text-blue-400 font-black",children:["$",J.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] sm:text-xs",children:[e.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Discount Applied"}),e.jsxs("span",{className:"text-red-400 font-black",children:["-",ae>0?`$${ae.toFixed(2)}`:"$0.00"]})]}),e.jsx("div",{className:"h-px bg-gray-700/50 my-1"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Net Total"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-black text-white tracking-tighter",children:["$",s.total.toFixed(2)]})]})]}),e.jsx("div",{className:"mt-3 sm:mt-4 pt-2 sm:pt-3 border-t border-white/5 flex justify-center",children:e.jsxs("span",{className:"text-[8px] sm:text-[9px] bg-emerald-500/10 text-emerald-400 px-2 sm:px-3 py-1 rounded-full border border-emerald-500/20 font-black uppercase tracking-widest",children:["Avg. $",s.finalPrice.toFixed(2)," / unit"]})})]})]})]})]},s.id)})}),e.jsxs("div",{className:"flex gap-3 sm:gap-4 mt-4 sm:mt-8",children:[e.jsx("button",{type:"button",onClick:()=>g({...t,products:[...t.products,{...ce,id:Date.now()}]}),className:"btn btn-secondary flex-1 !rounded-xl sm:!rounded-2xl font-black uppercase text-[10px] sm:text-[11px] tracking-widest py-3 sm:py-4 border border-gray-700 hover:bg-gray-800 transition-all",children:"+ បន្ថែមផលិតផល"}),e.jsxs("button",{type:"button",onClick:()=>D(!0),className:"btn btn-secondary flex-1 flex items-center justify-center gap-2 sm:gap-3 !rounded-xl sm:!rounded-2xl font-black uppercase text-[10px] sm:text-[11px] tracking-widest py-3 sm:py-4 border border-gray-700 hover:bg-gray-800 transition-all",children:[e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2M17 3h2a2 2 0 0 1 2 2v2M21 17v2a2 2 0 0 1-2 2h-2M7 21H5a2 2 0 0 1-2-2v-2M7 12h10",strokeWidth:"2.5"})}),"Scan"]})]})]});case 3:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-4 sm:space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ដឹកជញ្ជូន"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"input-label",children:"វិធីសាស្រ្តដឹកជញ្ជូន*"}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("select",{value:t.shipping.method,onChange:je,className:"form-select flex-grow bg-gray-900 border-gray-700",children:[e.jsx("option",{value:"",children:"-- ជ្រើសរើសសេវាដឹក --"}),(o=i.shippingMethods)==null?void 0:o.map(s=>e.jsx("option",{value:s.MethodName,children:s.MethodName},s.MethodName))]}),P&&e.jsx("div",{className:"w-12 h-8 sm:w-16 sm:h-10 bg-white/5 border border-white/10 rounded-lg sm:rounded-xl flex items-center justify-center p-1 shadow-inner flex-shrink-0",children:e.jsx("img",{src:P,className:"h-full w-full object-contain",alt:"logo"})})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"input-label",children:"ថ្លៃសេវាឲ្យអ្នកដឹក (Cost)*"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",name:"cost",placeholder:"0.00",value:t.shipping.cost,className:"form-input !py-2 sm:!py-3 pr-12 bg-gray-900 border-gray-700 text-blue-400 font-black",onChange:ye,required:!0}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold",children:"$"})]})]}),(M==null?void 0:M.RequireDriverSelection)&&e.jsxs("div",{className:"md:col-span-2 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"h-4 w-1 bg-blue-500 rounded-full"}),e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]",children:"ជ្រើសរើសអ្នកដឹក (DriverSelection)*"})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-4",children:(a=i.drivers)==null?void 0:a.map(s=>{const x=t.shipping.details===s.DriverName;return e.jsxs("button",{type:"button",onClick:()=>ve(s.DriverName),className:`group relative flex flex-col items-center p-2 sm:p-3 rounded-2xl sm:rounded-[2rem] border-2 transition-all duration-300 ${x?"bg-blue-600/20 border-blue-500 shadow-lg shadow-blue-900/20 scale-105":"bg-gray-800/40 border-transparent hover:bg-gray-800 hover:border-gray-700"}`,children:[e.jsx("div",{className:`w-12 h-12 sm:w-20 sm:h-20 rounded-full overflow-hidden mb-2 sm:mb-3 border-2 sm:border-4 transition-all duration-500 ${x?"border-blue-500 shadow-xl":"border-gray-700 group-hover:border-gray-600"}`,children:e.jsx("img",{src:z(s.ImageURL),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:s.DriverName})}),e.jsx("span",{className:`text-[9px] sm:text-[11px] font-black uppercase tracking-widest text-center truncate w-full ${x?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:s.DriverName}),x&&e.jsx("div",{className:"absolute top-0.5 right-0.5 bg-blue-500 text-white rounded-full p-0.5 sm:p-1 shadow-lg animate-fade-in-scale",children:e.jsx("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:4,children:e.jsx("path",{d:"M5 13l4 4L19 7"})})})]},s.DriverName)})}),!t.shipping.details&&e.jsx("p",{className:"text-center text-[9px] text-gray-500 italic mt-1",children:"សូមជ្រើសរើសអ្នកដឹកម្នាក់"})]})]})]});case 4:const d=(n=i.drivers)==null?void 0:n.find(s=>s.DriverName===t.shipping.details);return e.jsxs("div",{className:"animate-fade-in space-y-4 sm:space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," ព័ត៌មានអតិថិជន"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 bg-gray-900/60 p-3 sm:p-5 rounded-2xl sm:rounded-3xl border border-white/5 shadow-inner",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Customer Info"}),e.jsx("p",{className:"text-white font-black text-base sm:text-lg",children:t.customer.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-blue-400 font-bold font-mono text-sm",children:t.customer.phone}),Q&&e.jsx("img",{src:Q,className:"h-4 sm:h-5 w-auto object-contain",alt:"Carrier"})]})]}),e.jsxs("div",{className:"space-y-1 md:text-right",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Location / Store"}),e.jsx("p",{className:"text-gray-200 font-bold text-xs sm:text-sm leading-tight",children:`${t.customer.additionalLocation}, ${t.customer.sangkat}, ${t.customer.district}, ${t.customer.province}`.replace(/^,|,$/g,"").trim()}),e.jsxs("p",{className:"text-purple-400 font-black text-[9px] uppercase tracking-wider",children:["Fulfillment: ",t.fulfillmentStore]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-500"})," ព័ត៌មានដឹកជញ្ជូន"]}),e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-5 rounded-2xl sm:rounded-3xl border border-white/5 shadow-inner grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Shipping Method"}),e.jsxs("div",{className:"flex items-center gap-2",children:[P&&e.jsx("img",{src:P,className:"h-4 sm:h-5 w-auto object-contain",alt:"Logo"}),e.jsx("p",{className:"text-white font-black text-xs sm:text-sm",children:t.shipping.method})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Driver / Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("img",{src:z(d.ImageURL),className:"h-6 w-6 sm:h-8 sm:w-8 rounded-full object-cover border border-gray-700 cursor-pointer",alt:"Driver",onClick:()=>m(z(d.ImageURL))}),e.jsx("p",{className:"text-white font-bold text-xs sm:text-sm",children:t.shipping.details||"N/A"})]})]}),e.jsxs("div",{className:"space-y-1 sm:text-right",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Internal Cost ($)"}),e.jsxs("p",{className:"text-orange-400 font-black text-base sm:text-lg font-mono",children:["$",(Number(t.shipping.cost)||0).toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," បញ្ជីទំនិញកុម្ម៉ង់"]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:t.products.map(s=>e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 bg-gray-900/40 p-2 sm:p-3 rounded-xl sm:rounded-2xl border border-white/5 group hover:border-blue-500/30 transition-all",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gray-800 rounded-lg sm:rounded-xl overflow-hidden border border-gray-700 flex-shrink-0 relative",children:e.jsx("img",{src:z(s.image),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:s.name})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-0.5 sm:mb-1",children:[e.jsx("h4",{className:"text-white font-black text-xs sm:text-sm truncate leading-tight",children:s.name}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("span",{className:"bg-blue-600/10 text-blue-400 text-[9px] sm:text-[10px] font-black px-1.5 sm:px-2.5 py-0.5 sm:py-1 rounded-lg border border-blue-500/20",children:["x",s.quantity]})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[s.colorInfo&&e.jsx("span",{className:"text-[9px] bg-purple-500/10 text-purple-400 px-1.5 py-0.5 rounded-md font-bold",children:s.colorInfo}),e.jsxs("p",{className:"text-[9px] text-gray-500 font-bold uppercase tracking-tight",children:[e.jsxs("span",{children:["$",s.finalPrice.toFixed(2)]})," / unit"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-black text-sm sm:text-base tracking-tight",children:["$",s.total.toFixed(2)]}),e.jsx("p",{className:"text-[8px] text-gray-600 font-bold uppercase",children:"Subtotal"})]})]},s.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-white/5 text-center",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] text-gray-500 font-black uppercase mb-1",children:"សរុបទំនិញ"}),e.jsxs("p",{className:"text-white font-black text-base sm:text-lg",children:["$",t.subtotal.toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-white/5 text-center",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] text-gray-500 font-black uppercase mb-1",children:"សេវាដឹក"}),e.jsxs("p",{className:"text-white font-black text-base sm:text-lg",children:["$",(Number(t.customer.shippingFee)||0).toFixed(2)]})]}),e.jsxs("div",{className:"col-span-2 bg-blue-600/10 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-blue-500/20 text-center shadow-lg shadow-blue-900/20",children:[e.jsx("p",{className:"text-[9px] sm:text-[10px] text-blue-400 font-black uppercase mb-1 tracking-widest",children:"សរុបរួម (Grand Total)"}),e.jsxs("p",{className:"text-white font-black text-2xl sm:text-3xl tracking-tighter",children:["$",t.grandTotal.toFixed(2)]})]})]}),e.jsxs("fieldset",{className:"border border-gray-700 p-4 sm:p-6 rounded-2xl sm:rounded-3xl bg-gray-900/20",children:[e.jsx("legend",{className:"px-3 text-[10px] sm:text-xs font-black text-blue-400 uppercase tracking-[0.2em]",children:"ស្ថានភាពទូទាត់"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("select",{value:t.payment.status,onChange:s=>g({...t,payment:{...t.payment,status:s.target.value,info:""}}),className:"form-select bg-gray-800 text-sm",children:[e.jsx("option",{value:"Unpaid",children:"មិនទាន់ទូទាត់ (COD)"}),e.jsx("option",{value:"Paid",children:"ទូទាត់រួច (Paid)"})]}),t.payment.status==="Paid"&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 animate-fade-in",children:[e.jsxs("select",{value:t.payment.info,onChange:s=>Ne(s.target.value),className:"form-select bg-gray-800 flex-grow text-sm",children:[e.jsx("option",{value:"",children:"ជ្រើសរើសធនាគារ"}),(c=i.bankAccounts)==null?void 0:c.map(s=>e.jsx("option",{value:s.BankName,children:s.BankName},s.BankName))]}),j&&e.jsx("img",{src:j,className:"h-8 w-12 sm:h-10 sm:w-16 object-contain bg-white/10 p-1 rounded-lg sm:rounded-xl",alt:"bank"})]})]})]}),e.jsxs("fieldset",{className:"border border-gray-700 p-4 sm:p-6 rounded-2xl sm:rounded-3xl bg-gray-900/20",children:[e.jsx("legend",{className:"px-3 text-[10px] sm:text-xs font-black text-orange-400 uppercase tracking-[0.2em]",children:"កំណត់ពេល Telegram"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 sm:gap-6",children:[e.jsxs("label",{className:"flex items-center cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:t.telegram.schedule,onChange:s=>g({...t,telegram:{...t.telegram,schedule:s.target.checked}}),className:"w-5 h-5 rounded-lg border-gray-600 bg-gray-800 text-blue-500"}),e.jsx("span",{className:"ml-3 text-sm font-bold text-gray-300 group-hover:text-white transition-colors",children:"កំណត់ពេលផ្ញើសារ"})]}),t.telegram.schedule&&e.jsx("input",{type:"datetime-local",value:t.telegram.time||"",onChange:s=>g({...t,telegram:{...t.telegram,time:s.target.value}}),className:"form-input !py-2 animate-fade-in-down text-sm",min:new Date().toISOString().slice(0,16)})]})]}),e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ចំណាំ & Link Google Map"}),e.jsx("textarea",{placeholder:"ចំណាំបន្ថែម...",value:t.note,rows:4,onChange:s=>g({...t,note:s.target.value}),className:"form-textarea bg-gray-900/60 !rounded-[1.5rem] sm:!rounded-[2rem] border-white/5 focus:border-blue-500/50 text-sm"})]})]});default:return null}};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto mt-2 sm:mt-10 lg:mt-14 px-1 sm:px-0",children:[A&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[100] animate-fade-in p-4",children:e.jsxs("div",{className:"page-card text-center flex flex-col items-center animate-fade-in-scale",children:[A.type==="success"?e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-green-500/20 text-green-400 rounded-full flex items-center justify-center mb-4 border border-green-500/30 shadow-[0_0_30px_rgba(34,197,94,0.2)]",children:e.jsx("svg",{className:"h-8 w-8 sm:h-10 sm:w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}):e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-500/20 text-red-400 rounded-full flex items-center justify-center mb-4 border border-red-500/30",children:e.jsx("svg",{className:"h-8 w-8 sm:h-10 sm:w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("p",{className:"text-base sm:text-lg font-black text-white",children:A.message})]})}),e.jsx(Ie,{isOpen:se,onClose:()=>K(!1),url:Z}),T&&e.jsx(De,{onClose:()=>D(!1),onCodeScanned:fe,scanMode:X,setScanMode:w,productsInOrder:t.products,masterProducts:i.products||[]}),e.jsx(ue,{isOpen:F,onClose:()=>_(!1),maxWidth:"max-w-sm",children:e.jsxs("div",{className:"p-6 text-center space-y-6",children:[e.jsx("div",{className:"mx-auto w-14 h-14 sm:w-16 sm:h-16 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center border border-red-500/20 shadow-xl shadow-red-900/10 animate-bounce-slow",children:e.jsx("svg",{className:"h-7 w-7 sm:h-8 sm:w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg sm:text-xl font-black text-white uppercase tracking-tighter",children:"បោះបង់ការបញ្ចូល?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>_(!1),className:"btn btn-secondary flex-1 rounded-xl sm:rounded-2xl font-bold text-xs sm:text-sm",children:"ទេ (ត្រឡប់)"}),e.jsx("button",{onClick:H,className:"btn !bg-red-600 hover:!bg-red-700 text-white flex-1 rounded-xl sm:rounded-2xl font-bold text-xs sm:text-sm",children:"បាទ (បោះបង់)"})]})]})}),e.jsxs("div",{className:"hidden sm:flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-10 gap-4",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-black text-white uppercase tracking-tighter flex items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-blue-500",children:"កុម្ម៉ង់ថ្មី"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] bg-blue-600/20 text-blue-400 px-3 sm:px-4 py-1.5 rounded-full border border-blue-500/20 uppercase tracking-[0.15em] sm:tracking-[0.2em]",children:b})]}),e.jsx("button",{onClick:U,className:"btn btn-secondary !py-2 bg-gray-800 border-gray-700 hover:bg-red-600 hover:border-red-500 transition-all font-bold rounded-2xl uppercase text-[10px] sm:text-[11px] tracking-widest",children:"បោះបង់"})]}),e.jsxs("div",{className:"bg-gray-800/30 backdrop-blur-3xl border border-white/5 rounded-[1.5rem] sm:rounded-[3rem] p-3 sm:p-10 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 sm:mb-12 relative px-2 sm:px-4",children:[e.jsx("div",{className:"absolute left-6 right-6 sm:left-10 sm:right-10 top-1/2 w-[calc(100%-48px)] sm:w-[calc(100%-80px)] h-0.5 bg-gray-700 -z-10"}),e.jsx("div",{className:"absolute left-6 sm:left-10 top-1/2 h-0.5 bg-blue-500 -z-10 transition-all duration-500",style:{width:`${(u-1)/(re.length-1)*(100-48/400*100)}%`}}),re.map(r=>e.jsxs("div",{className:`relative flex flex-col items-center z-10 transition-all duration-500 ${u>=r.number?"scale-110":"opacity-40 scale-90"}`,children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex items-center justify-center font-black text-[10px] sm:text-xs border-2 transition-all duration-500 ${u>=r.number?"border-blue-500 bg-blue-600 text-white shadow-[0_0_20px_rgba(37,99,235,0.4)]":"border-gray-600 bg-gray-800 text-gray-500"}`,children:u>r.number?"✓":r.number}),e.jsx("span",{className:`absolute -bottom-6 sm:-bottom-7 text-[8px] sm:text-[9px] font-black uppercase tracking-widest whitespace-nowrap ${u>=r.number?"text-blue-400":"text-gray-600"}`,children:r.title})]},r.number))]}),e.jsx("div",{className:"mt-8 sm:mt-16",children:Pe()}),E&&e.jsx("div",{className:"mt-4 sm:mt-6 p-3 sm:p-4 bg-red-500/10 border border-red-500/20 rounded-xl sm:rounded-2xl text-red-400 text-center text-[10px] sm:text-xs font-bold animate-shake",children:E}),e.jsxs("div",{className:"mt-8 sm:mt-10 pt-6 sm:pt-8 border-t border-white/5 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-3 h-12 sm:h-14",children:[u>1&&e.jsxs("button",{type:"button",onClick:Se,className:"flex-1 btn btn-secondary !rounded-xl sm:!rounded-2xl font-black uppercase text-[10px] sm:text-[11px] tracking-[0.1em] sm:tracking-[0.15em] transition-all hover:bg-gray-700 flex items-center justify-center gap-1.5 sm:gap-2",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M15 19l-7-7 7-7"})}),"ត្រឡប់"]}),u<re.length?e.jsxs("button",{type:"button",onClick:ke,className:"flex-[2] btn btn-primary !rounded-xl sm:!rounded-2xl font-black uppercase text-[11px] sm:text-[12px] tracking-[0.15em] sm:tracking-[0.2em] shadow-xl shadow-blue-600/20 active:scale-95 transition-all flex items-center justify-center gap-1.5 sm:gap-2",children:["បន្ត",e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M9 5l7 7-7 7"})})]}):e.jsx("button",{type:"button",onClick:Ce,className:"flex-[2] btn !bg-emerald-600 hover:!bg-emerald-700 !rounded-xl sm:!rounded-2xl font-black uppercase text-[11px] sm:text-[12px] tracking-[0.15em] sm:tracking-[0.2em] shadow-xl shadow-emerald-600/20 active:scale-95 transition-all flex items-center justify-center gap-1.5 sm:gap-2 text-white",disabled:te,children:te?e.jsx(ne,{size:"sm"}):e.jsxs(e.Fragment,{children:["បញ្ជូនកម្ម៉ង់",e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})]})})]}),e.jsxs("button",{onClick:U,className:"sm:hidden w-full py-2.5 text-[9px] font-black uppercase tracking-[0.2em] text-red-500/70 hover:text-red-400 transition-colors flex items-center justify-center gap-2 border border-red-500/20 rounded-lg bg-red-500/5",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})}),"បោះបង់ការបញ្ចូល"]})]})]})]})},Fe=({dateRange:b,onRangeChange:h,customStart:N,onCustomStartChange:i,customEnd:y,onCustomEndChange:v})=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("div",{className:"flex items-center gap-1 bg-gray-800/80 p-1 rounded-xl border border-gray-700 shadow-inner",children:["today","this_week","this_month","custom"].map(m=>e.jsx("button",{onClick:()=>h(m),className:`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${b===m?"bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:m==="today"?"ថ្ងៃនេះ":m==="this_week"?"សប្តាហ៍នេះ":m==="this_month"?"ខែនេះ":"កំណត់"},m))})}),b==="custom"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4 p-4 bg-gray-900/40 rounded-2xl border border-gray-800 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:"ចាប់ពី"}),e.jsx("input",{type:"date",value:N,onChange:m=>i(m.target.value),className:"form-input !py-1.5 !px-3 bg-gray-800 border-gray-700 text-xs rounded-xl focus:ring-blue-500/20"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:"ដល់"}),e.jsx("input",{type:"date",value:y,onChange:m=>v(m.target.value),className:"form-input !py-1.5 !px-3 bg-gray-800 border-gray-700 text-xs rounded-xl focus:ring-blue-500/20"})]})]})]}),qe=({globalOrders:b,startDate:h,endDate:N,periodLabel:i})=>{const y=l.useMemo(()=>{const v=b.filter(u=>{const f=new Date(u.Timestamp);return!(h&&f<h||N&&f>N)}),m={};return v.forEach(u=>{const f=u.Team||"Unassigned";m[f]=(m[f]||0)+(Number(u["Grand Total"])||0)}),Object.entries(m).map(([u,f])=>({name:u,revenue:f})).sort((u,f)=>f.revenue-u.revenue).slice(0,3)},[b,h,N]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"h-6 w-1.5 bg-yellow-500 rounded-full shadow-[0_0_10px_rgba(234,179,8,0.5)]"}),e.jsxs("h3",{className:"text-sm font-black text-white uppercase tracking-wider",children:["ចំណាត់ថ្នាក់ក្រុមលក់ដាច់បំផុត (",i,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:y.length>0?y.map((v,m)=>e.jsxs("div",{className:"relative group overflow-hidden bg-gray-800/40 backdrop-blur-md border border-white/5 p-5 rounded-[2rem] flex items-center gap-5 transition-all duration-500 hover:bg-gray-800/60 hover:shadow-2xl hover:border-white/10",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center text-2xl shadow-lg transform transition-transform group-hover:scale-110 group-hover:rotate-6 ${m===0?"bg-yellow-500/20 text-yellow-500 border border-yellow-500/50 shadow-yellow-500/10":m===1?"bg-gray-400/20 text-gray-300 border border-gray-400/50 shadow-gray-400/10":"bg-orange-600/20 text-orange-500 border border-orange-600/50 shadow-orange-600/10"}`,children:m===0?"🥇":m===1?"🥈":"🥉"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-0.5",children:["TOP ",m+1," TEAM"]}),e.jsx("h4",{className:"text-base font-black text-white truncate group-hover:text-blue-400 transition-colors",children:v.name})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-blue-400 font-black text-lg",children:["$",v.revenue.toLocaleString(void 0,{maximumFractionDigits:0})]})}),e.jsx("div",{className:`absolute -right-4 -bottom-4 w-20 h-20 rounded-full opacity-0 group-hover:opacity-5 blur-2xl transition-opacity duration-700 ${m===0?"bg-yellow-500":m===1?"bg-gray-400":"bg-orange-600"}`})]},v.name)):e.jsx("div",{className:"col-span-full py-10 text-center bg-gray-800/20 rounded-[2rem] border-2 border-dashed border-gray-700",children:e.jsxs("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest",children:["មិនទាន់មានទិន្នន័យលក់សម្រាប់ ",i]})})})]})},Oe=({team:b})=>{const[h,N]=l.useState([]),[i,y]=l.useState([]),[v,m]=l.useState(!0),[u,f]=l.useState(""),[F,_]=l.useState(""),[q,t]=l.useState("today"),[g,te]=l.useState(new Date().toISOString().split("T")[0]),[O,E]=l.useState(new Date().toISOString().split("T")[0]),I=l.useMemo(()=>new Set(["index","orderId","customerName","productInfo","location","pageInfo","total","shippingService","status","date","print"]),[]);l.useEffect(()=>{(async()=>{m(!0),f("");try{const j=await(await fetch(`${pe}/api/admin/all-orders`)).json();if(j.status==="success"){const T=(Array.isArray(j.data)?j.data.filter(p=>p!==null):[]).map(p=>{let W=[];try{p["Products (JSON)"]&&(W=JSON.parse(p["Products (JSON)"]))}catch{}return{...p,Products:W}});y(T);const D=T.filter(p=>p.Team===b);N(D.sort((p,W)=>new Date(W.Timestamp).getTime()-new Date(p.Timestamp).getTime()))}}catch(S){f(S.message)}finally{m(!1)}})()},[b]);const A=P=>{const S=new Date,j=new Date(S.getFullYear(),S.getMonth(),S.getDate());let C=null,T=new Date;switch(P){case"today":C=j;break;case"this_week":const D=S.getDay();C=new Date(j),C.setDate(j.getDate()-(D===0?6:D-1));break;case"this_month":C=new Date(S.getFullYear(),S.getMonth(),1);break;case"custom":C=new Date(g+"T00:00:00"),T=new Date(O+"T23:59:59");break}return{start:C,end:T}},{start:B,end:M}=l.useMemo(()=>A(q),[q,g,O]),R=l.useMemo(()=>h.filter(P=>{const S=new Date(P.Timestamp);if(B&&S<B||M&&S>M)return!1;if(F.trim()){const j=F.toLowerCase();if(!(P["Order ID"].toLowerCase().includes(j)||(P["Customer Name"]||"").toLowerCase().includes(j)||(P["Customer Phone"]||"").includes(j)))return!1}return!0}),[h,F,B,M]),Q=l.useMemo(()=>R.reduce((P,S)=>P+(Number(S["Grand Total"])||0),0),[R]),Y=l.useMemo(()=>{switch(q){case"today":return"ថ្ងៃនេះ";case"this_week":return"សប្តាហ៍នេះ";case"this_month":return"ខែនេះ";case"custom":return`${g} ដល់ ${O}`;default:return""}},[q,g,O]);return v?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ne,{size:"lg"})}):e.jsxs("div",{className:"space-y-10",children:[e.jsx(qe,{globalOrders:i,startDate:B,endDate:M,periodLabel:q==="custom"?"តាមការកំណត់":Y}),e.jsx("div",{className:"bg-gray-800/20 backdrop-blur-md border border-white/5 p-6 rounded-[2.5rem] shadow-xl space-y-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 justify-between items-start lg:items-center",children:[e.jsxs("div",{className:"relative w-full lg:max-w-md",children:[e.jsx("input",{type:"text",placeholder:"ស្វែងរក ID, ឈ្មោះ, ទូរស័ព្ទ...",value:F,onChange:P=>_(P.target.value),className:"form-input !pl-12 w-full !py-3 bg-gray-900/60 rounded-2xl border-gray-700"}),e.jsx("svg",{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 w-full lg:w-auto",children:[e.jsxs("div",{className:"bg-blue-600/10 px-6 py-2.5 rounded-2xl border border-blue-500/20 flex flex-col items-end",children:[e.jsxs("p",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest leading-none mb-1.5",children:["សរុបលក់បាន (",Y,")"]}),e.jsxs("p",{className:"text-2xl font-black text-white leading-none",children:["$",Q.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsx(Fe,{dateRange:q,onRangeChange:t,customStart:g,onCustomStartChange:te,customEnd:O,onCustomEndChange:E})]})]})}),R.length===0?e.jsxs("div",{className:"text-center py-20 bg-gray-800/10 rounded-[3rem] border-2 border-dashed border-gray-700/50",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-800/50 rounded-full flex items-center justify-center mx-auto mb-4 border border-gray-700",children:e.jsx("svg",{className:"w-10 h-10 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),e.jsxs("p",{className:"text-gray-500 font-black uppercase tracking-[0.2em] text-sm",children:["មិនមានទិន្នន័យត្រូវបានរកឃើញសម្រាប់ ",Y," ទេ"]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"h-5 w-1 bg-blue-500 rounded-full"}),e.jsxs("h4",{className:"text-xs font-black text-gray-400 uppercase tracking-[0.2em]",children:["បញ្ជីប្រតិបត្តិការណ៍ (",R.length,")"]})]}),e.jsx(Te,{orders:R,showActions:!1,visibleColumns:I})]})]})},Re=({onBackToRoleSelect:b})=>{const{currentUser:h,setChatVisibility:N}=l.useContext(xe),[i,y]=l.useState("list"),[v,m]=Le("team",""),u=l.useMemo(()=>((h==null?void 0:h.Team)||"").split(",").map(f=>f.trim()).filter(Boolean),[h]);return l.useEffect(()=>{N(i!=="create")},[i]),l.useEffect(()=>{u.length===1&&!v&&m(u[0])},[u,v]),u.length===0?e.jsxs("div",{className:"page-card text-center p-12 mt-20 max-w-2xl mx-auto animate-fade-in",children:[e.jsxs("h2",{className:"text-2xl font-black text-white mb-2",children:["សួស្តី, ",h==null?void 0:h.FullName]}),e.jsx("p",{className:"text-gray-400 font-bold",children:"មិនមានទិន្នន័យក្រុមនៅក្នុងគណនីរបស់អ្នកទេ"}),e.jsx("button",{onClick:b,className:"btn btn-secondary mt-8 px-10 rounded-2xl",children:"ត្រឡប់ក្រោយ"})]}):v?i==="create"?e.jsx($e,{team:v,onSaveSuccess:()=>y("list"),onCancel:()=>y("list")}):e.jsxs("div",{className:"w-full max-w-[95rem] mx-auto p-2 sm:p-4 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-black text-white flex items-center gap-4 uppercase tracking-tighter",children:["ការកម្មង់របស់ខ្ញុំ",e.jsx("span",{className:"text-[10px] bg-blue-600/20 text-blue-400 px-4 py-1.5 rounded-full border border-blue-500/20 uppercase tracking-[0.2em]",children:v})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[u.length>1&&e.jsxs("button",{onClick:()=>m(""),className:"flex items-center gap-2 px-5 py-2.5 bg-gray-800 hover:bg-blue-600 text-gray-300 hover:text-white rounded-2xl text-[11px] font-black uppercase transition-all border border-gray-700 hover:border-blue-500 shadow-xl active:scale-95",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"ប្តូរក្រុម"]}),(h==null?void 0:h.IsSystemAdmin)&&e.jsxs("button",{onClick:b,className:"flex items-center gap-2 px-5 py-2.5 bg-gray-800 hover:bg-yellow-600 text-gray-300 hover:text-white rounded-2xl text-[11px] font-black uppercase transition-all border border-gray-700 hover:border-yellow-500 shadow-xl active:scale-95",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z"})}),"ត្រឡប់ទៅជ្រើសរើសតួនាទី"]})]})]}),e.jsxs("button",{onClick:()=>y("create"),className:"relative group flex items-center justify-center gap-3 px-8 py-4 bg-gradient-to-br from-blue-600 to-indigo-700 text-white rounded-2xl shadow-[0_10px_40px_-10px_rgba(37,99,235,0.5)] hover:shadow-[0_20px_50px_-10px_rgba(37,99,235,0.6)] transition-all duration-300 active:scale-95 overflow-hidden w-full md:w-auto",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-1000 ease-in-out"}),e.jsx("svg",{className:"w-6 h-6 transform group-hover:rotate-90 transition-transform duration-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{className:"text-sm font-black uppercase tracking-[0.15em] relative z-10",children:"បង្កើតការកម្មង់ថ្មី"})]})]}),e.jsx(Oe,{team:v})]}):e.jsxs("div",{className:"w-full max-w-5xl mx-auto p-4 mt-10 md:mt-20 animate-fade-in text-center",children:[e.jsx("h2",{className:"text-3xl font-black text-white mb-2 uppercase tracking-tighter",children:"សូមជ្រើសរើសក្រុម"}),e.jsx("p",{className:"text-gray-500 font-bold uppercase tracking-widest text-[10px] mb-12",children:"ជ្រើសរើសក្រុមដែលអ្នកកំពុងបំពេញការងារ"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:u.map(f=>e.jsx("button",{onClick:()=>m(f),className:"bg-gray-800/30 backdrop-blur-xl border border-white/5 rounded-[2.5rem] p-10 hover:border-blue-500 hover:bg-gray-800/50 transition-all group shadow-2xl active:scale-95",children:e.jsx("span",{className:"text-xl font-black text-white group-hover:text-blue-400 transition-colors uppercase tracking-tight",children:f})},f))})]})};export{Re as default};
