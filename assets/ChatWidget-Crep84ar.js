import{r,j as t,S as xe,A as Re,d as ae,W as U,c as ke,R as Ee,f as Se}from"./index-BBR7heN7.js";import{c as Te}from"./imageCompressor-D5vYYzIg.js";import{U as pe}from"./UserAvatar-W9u7A4o-.js";import{r as me,s as he}from"./notificationUtils-Daxn_erD.js";const Ce=["audio/mp4","audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg"],Me=()=>{const[d,v]=r.useState(!1),c=r.useRef(null),f=r.useRef([]),j=r.useRef("audio/webm");return{isRecording:d,startRecording:async()=>{if(!d)try{const m=await navigator.mediaDevices.getUserMedia({audio:!0}),N=Ce.find(w=>MediaRecorder.isTypeSupported(w));if(!N){alert("Your browser does not support any of the required audio recording formats."),console.error("No supported audio MIME types found.");return}j.current=N,console.log(`Using MIME type for recording: ${N}`),c.current=new MediaRecorder(m,{mimeType:N}),f.current=[],c.current.ondataavailable=w=>{f.current.push(w.data)},c.current.onstop=()=>{m.getTracks().forEach(w=>w.stop())},c.current.start(),v(!0)}catch(m){console.error("Error starting audio recording:",m),m instanceof DOMException&&(m.name==="NotAllowedError"||m.name==="PermissionDeniedError")?alert("áž€áž¶ážšáž¢áž“áž»áž‰áŸ’áž‰áž¶ážáž±áŸ’áž™áž”áŸ’ážšáž¾áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“ážáŸ’ážšáž¼ážœáž”áž¶áž“áž”ážŠáž·ážŸáŸáž’áŸ” ážŸáž¼áž˜áž¢áž“áž»áž‰áŸ’áž‰áž¶ážáž±áŸ’áž™áž…áž¼áž›áž”áŸ’ážšáž¾áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“áž“áŸ…áž€áŸ’áž“áž»áž„áž€áž¶ážšáž€áŸ†ážŽážáŸ‹áž€áž˜áŸ’áž˜ážœáž·áž’áž¸ážšáž»áž€ážšáž€ážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€ ážŠáž¾áž˜áŸ’áž”áž¸áž”áŸ’ážšáž¾áž˜áž»ážáž„áž¶ážšáž“áŸáŸ‡áŸ”"):alert("áž˜áž·áž“áž¢áž¶áž…áž…áž¶áž”áŸ‹áž•áŸ’ážáž¾áž˜áž€áž¶ážšážážážŸáŸ†áž¡áŸáž„áž”áž¶áž“áž‘áŸáŸ” ážŸáž¼áž˜áž”áŸ’ážšáž¶áž€ážŠážáž¶áž¢áŸ’áž“áž€áž”áž¶áž“áž—áŸ’áž‡áž¶áž”áŸ‹áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“ áž áž¾áž™áž”áž¶áž“áž•áŸ’ážáž›áŸ‹áž€áž¶ážšáž¢áž“áž»áž‰áŸ’áž‰áž¶ážáŸ”")}},stopRecording:()=>new Promise(m=>{if(!c.current||!d){m(null);return}c.current.onstop=()=>{const N=new Blob(f.current,{type:j.current});c.current&&c.current.stream.getTracks().forEach(w=>w.stop()),m(N)},c.current.stop(),v(!1)})}},Le=({src:d,isMe:v=!1})=>{const c=r.useRef(null),[f,j]=r.useState(!1),[R,C]=r.useState(0),[m,N]=r.useState(0),[w,M]=r.useState(!1),[_,k]=r.useState(null),[E]=r.useState(()=>Array.from({length:20},()=>Math.random()*.5+.3));r.useEffect(()=>{const n=c.current;if(!n)return;const b=()=>{n.duration&&isFinite(n.duration)&&(C(n.duration),M(!0),k(null))},g=()=>N(n.currentTime),D=()=>{j(!1),N(0)},B=()=>{console.error("Audio Error",n.error),k("Error playing audio"),M(!1)};return n.addEventListener("loadedmetadata",b),n.addEventListener("canplay",b),n.addEventListener("timeupdate",g),n.addEventListener("ended",D),n.addEventListener("error",B),j(!1),M(!1),N(0),n.load(),()=>{n.removeEventListener("loadedmetadata",b),n.removeEventListener("canplay",b),n.removeEventListener("timeupdate",g),n.removeEventListener("ended",D),n.removeEventListener("error",B)}},[d]);const W=()=>{!w||!c.current||(f?(c.current.pause(),j(!1)):(document.querySelectorAll("audio").forEach(n=>{n!==c.current&&n.pause()}),c.current.play().catch(n=>console.error("Play failed",n)),j(!0)))},$=n=>{if(!isFinite(n)||n<0)return"0:00";const b=Math.floor(n/60),g=Math.floor(n%60);return`${b}:${g<10?"0":""}${g}`};return _?t.jsx("div",{className:"text-[10px] text-red-300 bg-red-900/20 px-2 py-1 rounded",children:"Audio Unavailable"}):t.jsxs("div",{className:`flex items-center gap-3 p-1 rounded-full min-w-[200px] transition-all ${v?"text-white":"text-gray-800 dark:text-white"}`,children:[t.jsx("audio",{ref:c,src:d,preload:"metadata"}),t.jsx("button",{onClick:W,disabled:!w,className:`w-8 h-8 flex items-center justify-center rounded-full shadow-md transition-all active:scale-90 flex-shrink-0 ${v?"bg-white text-blue-600 hover:bg-gray-100":"bg-blue-600 text-white hover:bg-blue-500"}`,children:w?f?t.jsx("svg",{className:"w-3 h-3 fill-current",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):t.jsx("svg",{className:"w-3 h-3 fill-current ml-0.5",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M8 5v14l11-7z"})}):t.jsx(xe,{size:"sm"})}),t.jsxs("div",{className:"flex flex-col flex-grow min-w-0 gap-1",children:[t.jsx("div",{className:"flex items-center gap-[2px] h-4 w-full",children:E.map((n,b)=>{const g=b/E.length<m/(R||1);return t.jsx("div",{className:`w-1 rounded-full transition-all duration-100 ${g?v?"bg-blue-200":"bg-blue-500":v?"bg-blue-800":"bg-gray-600"}`,style:{height:f?`${Math.max(20,n*100*(Math.random()*.5+.8))}%`:`${n*100}%`,opacity:g?1:.5}},b)})}),t.jsx("div",{className:`text-[9px] font-mono font-bold text-right ${v?"text-blue-100":"text-gray-400"}`,children:$(f?m:R)})]})]})},Ie=({users:d,loading:v,onRefresh:c})=>v?t.jsxs("div",{className:"flex flex-col items-center justify-center py-10 space-y-3",children:[t.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Loading members..."})]}):!d||d.length===0?t.jsxs("div",{className:"text-center text-gray-500 py-10 flex flex-col items-center",children:[t.jsx("p",{className:"text-xs uppercase tracking-widest mb-2",children:"(No members found)"}),t.jsx("button",{onClick:c,className:"text-[10px] text-blue-400 hover:text-white underline",children:"Retry Loading"})]}):t.jsx("div",{className:"p-4 space-y-3 animate-fade-in",children:d.map(f=>t.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-gray-800/40 border border-white/5 hover:bg-gray-800 transition-colors cursor-default group",children:[t.jsx(pe,{avatarUrl:f.ProfilePictureURL,name:f.FullName,size:"md",className:"ring-2 ring-blue-500/20 group-hover:ring-blue-500/50 transition-all"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-black text-white",children:f.FullName}),t.jsxs("p",{className:"text-[10px] text-gray-500 font-mono uppercase tracking-wider",children:["@",f.UserName]})]}),t.jsx("div",{className:"ml-auto flex flex-col items-end gap-1",children:t.jsx("div",{className:`w-2 h-2 rounded-full ${f.IsSystemAdmin?"bg-yellow-500 shadow-[0_0_5px_#eab308]":"bg-blue-500 shadow-[0_0_5px_#3b82f6]"}`})})]},f.UserName))}),Ae=Ee.memo(Le),Fe=({isOpen:d,onClose:v})=>{const{currentUser:c,appData:f,previewImage:j,setUnreadCount:R,showNotification:C}=r.useContext(Re),m=r.useMemo(()=>c?`chatHistoryCache_${c.UserName}`:null,[c]),{isRecording:N,startRecording:w,stopRecording:M}=Me(),[_,k]=r.useState(0),E=r.useRef(null),W=r.useRef(new Audio(ae.NOTIFICATION)),$=r.useRef(new Audio(ae.SENT)),[n,b]=r.useState(()=>{if(!m)return[];try{const e=localStorage.getItem(m);return e&&e!=="undefined"?JSON.parse(e):[]}catch{return[]}}),[g,D]=r.useState([]),[B,J]=r.useState(!1),[z,q]=r.useState(""),[ge,ne]=r.useState(!1),[oe,K]=r.useState(!1),[L,we]=r.useState(()=>localStorage.getItem("chatMuted")==="true"),[G,ie]=r.useState(!1),[be,Q]=r.useState("disconnected"),[I,ce]=r.useState("chat"),le=r.useRef(null),X=r.useRef(null),de=r.useRef(null),Z=r.useRef(null),P=r.useRef(d),ue=r.useRef(g),ee=r.useRef(c),te=r.useRef(L),T=r.useRef(null);r.useEffect(()=>{ue.current=g},[g]),r.useEffect(()=>{ee.current=c},[c]),r.useEffect(()=>{te.current=L},[L]),r.useEffect(()=>{P.current=d},[d]),r.useEffect(()=>{if(n.length>0&&!T.current){const e=[...n].sort((s,o)=>new Date(s.timestamp).getTime()-new Date(o.timestamp).getTime());T.current=e[e.length-1].id}},[]);const re=r.useCallback(async()=>{if(f.users&&f.users.length>0){D(f.users),J(!1);return}J(!0);try{const s=await(await fetch(`${U}/api/users`)).json();s.status==="success"&&Array.isArray(s.data)&&D(s.data)}catch(e){console.warn("Fallback user fetch failed",e)}finally{J(!1)}},[f.users]);r.useEffect(()=>{re()},[re]),r.useEffect(()=>{d&&R(0)},[d,R]),r.useEffect(()=>{me()},[]);const ye=async()=>{await w(),k(0),E.current=setInterval(()=>{k(e=>e+1)},1e3)},ve=async()=>{await M(),E.current&&clearInterval(E.current),k(0)},Ne=async()=>{E.current&&clearInterval(E.current),K(!0);try{const e=await M();if(!e)throw new Error("No audio captured");const s=new FileReader;s.readAsDataURL(e),s.onloadend=async()=>{const i=s.result.split(",")[1];try{const a=await fetch(`${U}/api/upload-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileData:i,fileName:`voice_${Date.now()}.webm`,mimeType:"audio/webm",userName:(c==null?void 0:c.UserName)||"unknown"})}),l=await a.json();if(!a.ok||l.status!=="success")throw new Error(l.message||"Audio upload failed");let h=l.fileId||l.id;if(!h&&l.url){const x=l.url.match(/(?:d\/|id=)([^/?&]+)/);x&&x[1]&&(h=x[1])}if(!h)throw console.error("Could not determine FileID from upload result:",l),new Error("Failed to get File ID");const y=fe(_);await Y(y,"audio",h)}catch(a){console.error("Audio Upload Workflow Failed",a),alert("áž€áž¶ážšáž”áž‰áŸ’áž‡áž¼áž“ážŸáž˜áŸ’áž›áŸáž„áž”ážšáž¶áž‡áŸáž™ (Failed to upload audio).")}finally{K(!1),k(0)}}}catch(e){console.error("Recording Error",e),K(!1),k(0)}},fe=e=>{const s=Math.floor(e/60),o=e%60;return`${s}:${o<10?"0":""}${o}`},O=r.useCallback(e=>{b(s=>{const o=typeof e=="function"?e(s):e;return m&&localStorage.setItem(m,JSON.stringify(o)),o})},[m]),H=r.useCallback(e=>{const s=ue.current.find(a=>a.UserName===e.UserName),o=(e.MessageType||"text").toLowerCase();let i=e.Content;return o==="audio"&&e.FileID?i=`${U}/api/chat/audio/${e.FileID}`:o==="image"&&(i=ke(e.Content)),{id:e.Timestamp,user:e.UserName,fullName:(s==null?void 0:s.FullName)||e.UserName,avatar:(s==null?void 0:s.ProfilePictureURL)||"",content:i,timestamp:e.Timestamp,type:o,fileID:e.FileID,isOptimistic:!1}},[]),V=r.useCallback(e=>{if(e.length===0)return;const s=T.current;let o=[];if(!s){T.current=e[e.length-1].id;return}const i=e.findIndex(a=>a.id===s);i!==-1?o=e.slice(i+1):o=e.filter(a=>a.id>s),o.forEach(a=>{var x;if(a.user===((x=ee.current)==null?void 0:x.UserName))return;const h=a.content&&a.content.includes("ðŸ“¢ NEW ORDER:"),y=a.content&&a.content.includes("ðŸ“¢ SYSTEM_ALERT:");if(h||y){let u=a.content;h?u=a.content.replace("ðŸ“¢ NEW ORDER:","").trim():y&&(u=a.content.replace("ðŸ“¢ SYSTEM_ALERT:","").trim()),C(u,"success"),te.current||new Audio(ae.NOTIFICATION).play().catch(A=>console.warn("Audio play failed",A)),he("áž€áž¶ážšáž€áž˜áŸ’áž˜áž„áŸ‹ážáŸ’áž˜áž¸ ðŸ“¦",u)}else{const u=a.fullName||a.user;let p=a.content;a.type==="image"?p="ðŸ“· Sent an image":a.type==="audio"&&(p="ðŸŽ¤ Sent a voice message"),C(`${u}: ${p}`,"info"),(document.hidden||!P.current)&&(he(u,p),P.current||R(A=>A+1)),te.current||(W.current.currentTime=0,W.current.play().catch(()=>{}))}}),o.length>0&&(T.current=o[o.length-1].id)},[C,R]),F=r.useCallback(async()=>{n.length===0&&P.current&&ie(!0);try{const e=await fetch(`${U}/api/chat/messages`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();if(s.status==="success"){const i=s.data.map(H).sort((a,l)=>new Date(a.timestamp).getTime()-new Date(l.timestamp).getTime());V(i),O(a=>{if(a.length===i.length&&a.length>0){const l=a[a.length-1],h=i[i.length-1];if(l.id===h.id)return a}return i})}}catch{console.warn("Chat history service unavailable")}finally{ie(!1)}},[H,O,n.length,V]),se=(e="smooth")=>{X.current&&X.current.scrollIntoView({behavior:e})};r.useEffect(()=>{const e=window.location.protocol==="https:"?"wss":"ws",s=U.replace(/^https?:\/\//,""),o=`${e}://${s}/api/chat/ws`,i=()=>{var l;if(((l=Z.current)==null?void 0:l.readyState)===WebSocket.OPEN)return;Q("connecting");const a=new WebSocket(o);Z.current=a,a.onopen=()=>{Q("connected"),F()},a.onclose=()=>{Q("disconnected"),setTimeout(i,3e3)},a.onmessage=h=>{try{const y=JSON.parse(h.data);if(y.action==="new_message"){const x=y.payload,u=H(x);T.current&&u.id<=T.current||V([u]),O(p=>{if(p.some(S=>S.id===u.id))return p;const A=p.findIndex(S=>S.isOptimistic&&S.user===u.user&&S.type===u.type);if(A!==-1){const S=[...p];return S[A]=u,S}return[...p,u]}),P.current&&setTimeout(()=>se("smooth"),100)}}catch(y){console.error("WS Message Error",y)}}};return i(),()=>{var a;(a=Z.current)==null||a.close()}},[V,H,O]),r.useEffect(()=>{d&&F()},[d,F]),r.useEffect(()=>{const e=setInterval(()=>{F()},3e3);return()=>clearInterval(e)},[F]),r.useEffect(()=>{if(!d||I!=="chat"||G)return;const e=de.current;if(e){const{scrollTop:s,scrollHeight:o,clientHeight:i}=e,a=o-s-i<250,l=n[n.length-1],h=(l==null?void 0:l.user)===(c==null?void 0:c.UserName);(h||l!=null&&l.isOptimistic||a||s===0)&&se(s===0&&!h?"auto":"smooth")}else se("auto")},[n,d,I,G]);const Y=async(e,s,o)=>{if(!e&&s==="text")return;const i=ee.current;if(!i){alert("Please login to send messages.");return}const a=Date.now().toString();let l=e;s==="image"&&!e.startsWith("http")&&!e.startsWith("data:")&&(l=`data:image/jpeg;base64,${e}`);const h={id:a,user:i.UserName||"Unknown",fullName:i.FullName||"Me",avatar:i.ProfilePictureURL||"",content:l,timestamp:new Date().toISOString(),type:s,fileID:o,isOptimistic:!0};b(x=>[...x,h]),s==="text"&&q("");const y=s.charAt(0).toUpperCase()+s.slice(1);try{const x={userName:i.UserName,UserName:i.UserName,type:y,MessageType:y,content:e.trim(),Content:e.trim()};o&&(x.FileID=o,x.fileId=o);const u=await fetch(`${U}/api/chat/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!u.ok){const p=await u.text();throw new Error(`Server returned ${u.status}: ${p}`)}L||($.current.currentTime=0,$.current.play().catch(()=>{}))}catch(x){console.error("Send Error:",x),b(u=>u.filter(p=>p.id!==a)),s==="text"&&q(e),alert("áž€áž¶ážšáž”áž‰áŸ’áž‡áž¼áž“ážŸáž¶ážšáž”ážšáž¶áž‡áŸáž™ (Send Failed). Please try again.")}},je=async e=>{ne(!0);try{const s=await Te(e),o=await Se(s);await Y(o,"image")}finally{ne(!1)}};return t.jsxs("div",{className:`chat-widget-container ${d?"":"closed"}`,children:[t.jsxs("div",{className:"chat-header",children:[t.jsxs("div",{className:"title-group flex items-center gap-2",children:[t.jsx("div",{className:`connection-status w-3 h-3 rounded-full ${be==="connected"?"bg-green-500 shadow-[0_0_10px_#22c55e]":"bg-yellow-500 animate-pulse"}`}),t.jsx("h3",{className:"font-black text-white uppercase tracking-wider text-sm",children:"Team Chat"})]}),t.jsxs("div",{className:"controls flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{const e=!L;we(e),localStorage.setItem("chatMuted",String(e)),e||me().then(s=>{s&&console.log("Notification permission granted via toggle")})},className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:L?"ðŸ”‡":"ðŸ””"}),t.jsx("button",{onClick:v,className:"p-2 hover:bg-red-500/20 hover:text-red-400 rounded-full transition-colors text-gray-400",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),t.jsxs("div",{className:"chat-tabs bg-gray-900/50 p-1",children:[t.jsx("button",{onClick:()=>ce("chat"),className:`text-xs font-bold uppercase tracking-wider transition-all ${I==="chat"?"active bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:"Chat Stream"}),t.jsx("button",{onClick:()=>ce("users"),className:`text-xs font-bold uppercase tracking-wider transition-all ${I==="users"?"active bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:"Members"})]}),t.jsx("div",{className:"chat-body custom-scrollbar bg-[#0f172a] relative",ref:de,children:I==="chat"?t.jsxs("div",{className:"chat-messages p-4 space-y-6 min-h-full",children:[G?t.jsxs("div",{className:"flex flex-col items-center justify-center py-10 space-y-3",children:[t.jsx(xe,{size:"md"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Loading history..."})]}):n.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center opacity-50",children:[t.jsx("svg",{className:"w-16 h-16 text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),t.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-gray-500",children:"No messages yet"}),t.jsx("p",{className:"text-[10px] text-gray-600 mt-1",children:"Start the conversation!"})]}):n.map((e,s)=>{const o=e.user===(c==null?void 0:c.UserName),i=g.find(h=>h.UserName===e.user),a=s===0||n[s-1].user!==e.user,l=e.content.includes("SYSTEM_ALERT")||e.content.includes("NEW ORDER");return t.jsx("div",{className:`flex flex-col ${o?"items-end":"items-start"} animate-fade-in-up`,children:l?t.jsx("div",{className:"w-full flex justify-center my-2",children:t.jsx("div",{className:"bg-blue-900/40 border border-blue-500/30 rounded-xl px-4 py-2 text-[10px] font-bold text-blue-300 text-center shadow-lg",children:e.content.replace("ðŸ“¢ SYSTEM_ALERT:","").replace("ðŸ“¢ NEW ORDER:","").trim()})}):t.jsxs("div",{className:`flex max-w-[85%] gap-3 ${o?"flex-row-reverse":""}`,children:[t.jsx("div",{className:"flex-shrink-0 w-8 flex flex-col justify-end",children:a?t.jsx(pe,{avatarUrl:(i==null?void 0:i.ProfilePictureURL)||e.avatar,name:(i==null?void 0:i.FullName)||e.fullName,size:"sm",className:"ring-2 ring-white/10"}):t.jsx("div",{className:"w-8"})}),t.jsxs("div",{className:`relative px-4 py-3 shadow-lg ${o?"bg-blue-600 text-white rounded-2xl rounded-tr-sm":"bg-gray-800 text-gray-200 rounded-2xl rounded-tl-sm border border-white/5"} ${e.isOptimistic?"opacity-70":""}`,children:[!o&&a&&t.jsx("p",{className:"text-[10px] font-black text-blue-400 mb-1 uppercase tracking-wider",children:(i==null?void 0:i.FullName)||e.fullName}),e.type==="text"&&t.jsx("p",{className:"leading-relaxed text-sm whitespace-pre-wrap",children:e.content}),e.type==="image"&&t.jsx("img",{src:e.content,className:"rounded-xl max-w-full cursor-pointer hover:opacity-90 transition-opacity border border-black/20",onClick:()=>j(e.content),alt:"attachment"}),e.type==="audio"&&t.jsx(Ae,{src:e.content,isMe:o}),t.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1.5",children:[t.jsx("p",{className:`text-[9px] font-medium ${o?"text-blue-200":"text-gray-500"}`,children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.isOptimistic&&t.jsxs("svg",{className:"w-3 h-3 text-white/50 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]})]})},e.id+s)}),t.jsx("div",{ref:X})]}):t.jsx(Ie,{users:g,loading:B,onRefresh:re})}),I==="chat"&&t.jsxs("div",{className:"p-3 bg-gray-900 border-t border-gray-800",children:[N?t.jsxs("div",{className:"flex items-center gap-3 bg-red-900/20 p-2 rounded-2xl border border-red-500/30 animate-pulse relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-20 pointer-events-none gap-1",children:[...Array(10)].map((e,s)=>t.jsx("div",{className:"w-1 bg-red-500 rounded-full animate-bounce",style:{height:`${Math.random()*80+20}%`,animationDuration:`${Math.random()*.5+.5}s`}},s))}),t.jsx("div",{className:"w-10 h-10 flex items-center justify-center bg-red-600 rounded-full shadow-lg shadow-red-600/40 relative z-10",children:t.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-ping"})}),t.jsxs("div",{className:"flex-grow text-center relative z-10",children:[t.jsx("p",{className:"text-red-400 font-black text-lg font-mono tracking-widest",children:fe(_)}),t.jsx("p",{className:"text-[8px] text-red-500 font-bold uppercase tracking-wider",children:"Recording..."})]}),t.jsxs("div",{className:"flex gap-2 relative z-10",children:[t.jsx("button",{onClick:ve,className:"p-2.5 bg-gray-800 text-gray-400 hover:text-white rounded-xl hover:bg-gray-700 transition-all active:scale-95 border border-white/5",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t.jsx("button",{onClick:Ne,className:"p-2.5 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-500 transition-all active:scale-95 border border-blue-500/50",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})]}):t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("button",{onClick:()=>{var e;return(e=le.current)==null?void 0:e.click()},className:"p-3 text-gray-400 hover:text-blue-400 hover:bg-gray-800 rounded-xl transition-all",title:"Attach Image",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h14a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),t.jsx("input",{type:"file",ref:le,className:"hidden",accept:"image/*",onChange:e=>e.target.files&&je(e.target.files[0])}),t.jsx("div",{className:"flex-grow relative",children:t.jsx("textarea",{value:z,onChange:e=>q(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),Y(z,"text"))},placeholder:"Type a message...",className:"w-full bg-gray-800 text-white rounded-2xl py-3 pl-4 pr-10 border-transparent focus:border-blue-500 focus:ring-0 resize-none text-sm max-h-24 custom-scrollbar",rows:1,style:{minHeight:"44px"}})}),z.trim()?t.jsx("button",{onClick:()=>Y(z,"text"),className:"p-3 bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-600/20 active:scale-95 transition-all hover:bg-blue-500",children:t.jsx("svg",{className:"w-5 h-5 transform rotate-90",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})}):t.jsx("button",{onClick:ye,disabled:oe,className:"p-3 bg-gray-800 text-white rounded-xl border border-gray-700 hover:bg-red-500/20 hover:border-red-500/50 hover:text-red-500 transition-all active:scale-95 group",children:t.jsx("svg",{className:"w-5 h-5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})})]}),(ge||oe)&&t.jsx("div",{className:"absolute inset-x-0 bottom-full bg-blue-600/90 text-white text-[10px] font-black uppercase tracking-widest text-center py-1",children:"Processing Transfer..."})]})]})};export{Fe as default};
