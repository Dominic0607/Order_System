import{r,j as e,c as R,M as de,S as re,A as me,W as ue,u as Ce}from"./index-DUu1hOV5.js";import{a as Pe,S as Le,O as Me}from"./OrdersList-YkEPX2a7.js";const Te=({pages:m,selectedPageName:x,onSelect:M,placeholder:i="ជ្រើសរើស Page..."})=>{const[f,N]=r.useState(!1),[w,p]=r.useState(""),P=r.useRef(null);r.useEffect(()=>{const u=m.find(s=>s.PageName===x);u&&p(u.PageName)},[x,m]),r.useEffect(()=>{const u=s=>{if(P.current&&!P.current.contains(s.target)){N(!1);const h=m.find(I=>I.PageName===x);p(h?h.PageName:"")}};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[x,m]);const y=r.useMemo(()=>{if(!w.trim())return m;const u=w.toLowerCase();return m.filter(s=>s.PageName.toLowerCase().includes(u))},[m,w]),D=m.find(u=>u.PageName===x);return e.jsxs("div",{className:"relative w-full",ref:P,children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",className:"form-input !pl-14 !pr-10 !py-3.5 bg-gray-900/50 border-gray-700 group-hover:border-blue-500/50 transition-all rounded-[1.25rem] font-bold text-gray-200",placeholder:i,value:w,onChange:u=>{p(u.target.value),N(!0)},onFocus:()=>N(!0)}),e.jsx("div",{className:"absolute left-3.5 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-800 overflow-hidden border border-white/5 flex items-center justify-center",children:D?e.jsx("img",{src:R(D.PageLogoURL),className:"w-full h-full object-cover",alt:""}):e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7.07 18.28c.43-.9 1.91-1.61 3.46-1.61s3.03.72 3.46 1.61C12.79 19.11 11.41 19.5 10 19.5s-2.79-.39-3.93-1.22zM15.6 17.03c-.78-1.13-2.56-1.86-4.6-1.86s-3.82.73-4.6 1.86c-.52-.51-.95-1.09-1.27-1.74.88-1.19 2.72-2.12 4.87-2.12s3.99.93 4.87 2.12c-.32.65-.75 1.23-1.27 1.74zM10 12.3c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"})})})}),e.jsx("div",{className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-gray-600 group-focus-within:text-blue-500 transition-colors",children:e.jsx("svg",{className:`w-5 h-5 transition-transform duration-300 ${f?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 9l-7 7-7-7",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),f&&e.jsx("div",{className:"absolute z-[100] w-full mt-2 bg-gray-800/95 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-[0_20px_60px_rgba(0,0,0,0.6)] overflow-hidden animate-fade-in-down",children:e.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar p-2.5 space-y-1.5",children:y.length>0?y.map(u=>e.jsxs("button",{type:"button",onClick:()=>{M(u),p(u.PageName),N(!1)},className:`w-full flex items-center gap-3.5 p-3 rounded-2xl transition-all ${x===u.PageName?"bg-blue-600 text-white shadow-lg shadow-blue-600/20":"text-gray-300 hover:bg-white/5"}`,children:[e.jsx("img",{src:R(u.PageLogoURL),className:"w-11 h-11 rounded-full object-cover border-2 border-white/10 shadow-sm flex-shrink-0",alt:""}),e.jsxs("div",{className:"text-left min-w-0",children:[e.jsx("p",{className:"font-black text-[15px] truncate leading-tight",children:u.PageName}),e.jsx("p",{className:`text-[10px] uppercase tracking-widest font-black mt-1 ${x===u.PageName?"text-blue-100":"text-gray-500"}`,children:u.Team})]})]},u.PageName)):e.jsx("div",{className:"p-6 text-center text-xs text-gray-500 font-black uppercase tracking-widest",children:"រកមិនឃើញ Page ទេ"})})})]})},Ie=({isOpen:m,onClose:x,url:M})=>{const[i,f]=r.useState(!0);return r.useEffect(()=>{m&&f(!0)},[m,M]),m?e.jsxs(de,{isOpen:m,onClose:x,maxWidth:"max-w-4xl",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"ស្វែងរកទីតាំង"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:'បន្ទាប់ពីរកឃើញទីតាំងត្រឹមត្រូវ សូមចម្លង (Copy) អាសយដ្ឋាន ឬ Link រួចបិទផ្ទាំងនេះ ហើយបិទភ្ជាប់ (Paste) ចូលទៅក្នុងប្រអប់ "ទីតាំងលម្អិត" វិញ។'}),e.jsxs("div",{className:"relative w-full h-[70vh] bg-gray-900 rounded-lg overflow-hidden border border-gray-700",children:[i&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx(re,{size:"lg"}),e.jsx("span",{className:"ml-3 text-gray-300",children:"កំពុងដំណើរការផែនទី..."})]}),e.jsx("iframe",{src:M,width:"100%",height:"100%",style:{border:0},allowFullScreen:!1,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",onLoad:()=>f(!1),className:i?"opacity-0":"opacity-100 transition-opacity duration-500"})]})]}):null},De=({onClose:m,onCodeScanned:x,scanMode:M,setScanMode:i,productsInOrder:f,masterProducts:N})=>{const w=r.useRef(null),p=r.useRef(null),[P,y]=r.useState(null),[D,u]=r.useState(!0),[s,h]=r.useState(null),[I,F]=r.useState(1),[A,W]=r.useState(null),[_,E]=r.useState(!1),[z,X]=r.useState(!1),[V,g]=r.useState(0),j=r.useCallback(v=>{var S;const b=parseFloat(v.target.value);F(b),(S=w.current)!=null&&S.isScanning&&w.current.applyVideoConstraints({advanced:[{zoom:b}]}).catch($=>console.error("Failed to apply zoom",$))},[]),L=r.useCallback(async()=>{var v;if((v=w.current)!=null&&v.isScanning&&z){const b=!_;try{await w.current.applyVideoConstraints({advanced:[{torch:b}]}),E(b)}catch(S){console.error("Failed to toggle torch",S)}}},[_,z]);return r.useEffect(()=>{const v=new window.Html5Qrcode("barcode-reader-container");w.current=v;let b=0;const S=(k,te)=>{var Z;const se=Date.now();if(se-b<1e3)return;b=se;const Y=N.find(T=>T.Barcode&&T.Barcode.trim()===k.trim());if(Y){const T=f.find(H=>H.name===Y.ProductName),B=T?T.quantity:0;if(M==="single"&&T)y(`⚠️ ${Y.ProductName} (មានរួចហើយ)`);else{const H=M==="increment"?B+1:1;y(`✅ ${Y.ProductName} (ចំនួន: ${H})`),g(G=>G+1)}}else y(`❌ រកមិនឃើញ Barcode: ${k}`);x(k);const Q=p.current,U=document.querySelector("#barcode-reader-container video");if(Q&&U&&((Z=te.result)!=null&&Z.points)){const T=Q.getContext("2d");if(!T)return;Q.width=U.clientWidth,Q.height=U.clientHeight;const B=U.clientWidth/U.videoWidth,H=U.clientHeight/U.videoHeight;T.clearRect(0,0,Q.width,Q.height),T.beginPath();const G=te.result.points;T.moveTo(G[0].x*B,G[0].y*H);for(let O=1;O<G.length;O++)T.lineTo(G[O].x*B,G[O].y*H);T.closePath(),T.lineWidth=4,T.strokeStyle="#4ade80",T.fillStyle="rgba(74, 222, 128, 0.3)",T.stroke(),T.fill(),setTimeout(()=>{if(y(null),p.current){const O=p.current.getContext("2d");O==null||O.clearRect(0,0,p.current.width,p.current.height)}},1500)}},$={fps:10,qrbox:{width:250,height:250},supportedScanTypes:[]};return v.start({facingMode:"environment"},$,S,()=>{}).then(()=>{const k=v.getRunningTrackCapabilities();k&&(k.zoom&&(W({min:k.zoom.min,max:k.zoom.max,step:k.zoom.step}),F(k.zoom.min||1)),k.torch&&X(!0)),u(!1)}).catch(k=>{h("មិនអាចបើក Camera បានទេ។"),u(!1)}),()=>{var k;(k=w.current)!=null&&k.isScanning&&w.current.stop().catch(()=>{})}},[x,f,N,M]),e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col p-2 sm:p-4 animate-fade-in",children:[e.jsx("style",{children:`
              #barcode-reader-container { width: 100%; height: 100%; overflow: hidden; }
              #barcode-reader-container video { width: 100% !important; height: 100% !important; object-fit: cover; }
            `}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center text-white mb-2 sm:mb-4",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold",children:["Scan Barcode",e.jsxs("span",{className:"text-gray-400 text-base font-normal ml-2",children:["(",V," scanned)"]})]}),e.jsx("button",{onClick:m,className:"p-2 bg-gray-700/50 rounded-full hover:bg-gray-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-grow relative flex items-center justify-center min-h-0 w-full max-w-2xl mx-auto",children:[e.jsx("div",{id:"barcode-reader-container",className:"w-full h-full aspect-square bg-gray-900 rounded-lg overflow-hidden"}),e.jsx("canvas",{ref:p,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-0 border-[20px] sm:border-[30px] border-black/50 box-border rounded-lg"}),D&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white",children:[e.jsx(re,{size:"lg"}),e.jsx("p",{className:"mt-4 font-semibold",children:"កំពុងបើក Camera..."})]}),s&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white p-4 text-center",children:[e.jsx("p",{className:"font-semibold text-red-400",children:"កំហុស Camera"}),e.jsx("p",{className:"mt-2 text-sm",children:s})]}),P&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-gray-800/80 border border-gray-600 text-white px-4 py-2 rounded-lg font-semibold z-20",children:P})]}),!D&&!s&&e.jsxs("div",{className:"flex-shrink-0 mt-4 space-y-4 w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4 items-center",children:[e.jsxs("div",{className:"flex justify-center items-center space-x-2 bg-gray-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>i("increment"),className:`flex-1 text-sm py-2 px-3 rounded-md transition-colors ${M==="increment"?"bg-blue-600 text-white":"hover:bg-gray-700"}`,children:"បូកចំនួន"}),e.jsx("button",{onClick:()=>i("single"),className:`flex-1 text-sm py-2 px-3 rounded-md transition-colors ${M==="single"?"bg-blue-600 text-white":"hover:bg-gray-700"}`,children:"រាប់មួយ"})]}),e.jsx("div",{className:"flex justify-center",children:z&&e.jsx("button",{onClick:L,className:`p-3 rounded-full transition-colors ${_?"bg-yellow-400 text-gray-900":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2zM5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1z",clipRule:"evenodd"})})})})]}),A&&e.jsx("div",{className:"flex items-center gap-2 sm:gap-4 bg-gray-800 p-2 rounded-lg",children:e.jsx("input",{type:"range",min:A.min,max:A.max,step:A.step,value:I,onChange:j,className:"w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer"})})]})]})},$e=({provinces:m,selectedProvince:x,onSelect:M})=>{const[i,f]=r.useState(!1),[N,w]=r.useState(""),p=r.useRef(null);r.useEffect(()=>{w(x)},[x]),r.useEffect(()=>{const y=D=>{p.current&&!p.current.contains(D.target)&&(f(!1),w(x))};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[x]);const P=r.useMemo(()=>{const y=m.filter(I=>I.toLowerCase().includes(N.toLowerCase())),D=y.filter(I=>!I.includes("ភ្នំពេញ")&&!I.includes("កណ្ដាល")).sort((I,F)=>I.localeCompare(F,"km")),u=[],s=y.find(I=>I.includes("ភ្នំពេញ")),h=y.find(I=>I.includes("កណ្ដាល"));return s&&u.push(s),h&&u.push(h),[...u,...D]},[m,N]);return e.jsxs("div",{className:"relative w-full",ref:p,children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",className:"form-input !pl-10 !py-3 rounded-xl border-gray-700 bg-gray-900 focus:border-blue-500/50 transition-all font-bold text-gray-200",placeholder:"ស្វែងរក ខេត្ត/រាជធានី...",value:N,onChange:y=>{w(y.target.value),f(!0)},onFocus:()=>f(!0)}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),i&&e.jsx("div",{className:"absolute z-[100] w-full mt-2 bg-gray-800 border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-fade-in-down max-h-60 overflow-y-auto custom-scrollbar",children:P.length>0?P.map((y,D)=>e.jsx("button",{type:"button",onClick:()=>{M(y),w(y),f(!1)},className:`w-full text-left px-4 py-3 text-sm font-bold transition-colors border-b border-white/5 last:border-0 ${x===y?"bg-blue-600 text-white":"text-gray-300 hover:bg-white/5"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:y}),D<2&&N===""&&e.jsx("span",{className:"text-[8px] bg-white/10 px-1.5 py-0.5 rounded uppercase tracking-widest opacity-50",children:"Priority"})]})},y)):e.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:"រកមិនឃើញខេត្តនេះទេ"})})]})},Fe=({schedule:m,time:x,onChange:M})=>{const i=()=>{M({schedule:!m,time:m?"":x})};return e.jsxs("div",{className:`relative overflow-hidden p-6 rounded-[2rem] border transition-all duration-500 ${m?"bg-cyan-500/10 border-cyan-500 shadow-[0_0_25px_rgba(6,182,212,0.15)]":"bg-gray-900/40 border-gray-700"}`,children:[e.jsx("style",{children:`
                /* ប្ដូរពណ៌ និងពង្រីកទំហំ Default Calendar Icon របស់ Browser */
                .cyan-calendar-picker::-webkit-calendar-picker-indicator {
                    cursor: pointer;
                    /* ប្ដូរពណ៌ទៅជា Cyan */
                    filter: invert(56%) sepia(86%) saturate(2256%) hue-rotate(150deg) brightness(98%) contrast(101%);
                    padding: 8px;
                    width: 24px;
                    height: 24px;
                    transform: scale(1.3); /* ពង្រីកឱ្យធំជាងមុន */
                    border-radius: 12px;
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                }
                .cyan-calendar-picker::-webkit-calendar-picker-indicator:hover {
                    background: rgba(6, 182, 212, 0.15);
                    transform: scale(1.45);
                    filter: invert(60%) sepia(90%) saturate(2500%) hue-rotate(160deg) brightness(110%) contrast(110%);
                }
                .cyan-calendar-picker::-webkit-calendar-picker-indicator:active {
                    transform: scale(1.2);
                }
            `}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-500 ${m?"bg-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-800 text-gray-500"}`,children:e.jsx("svg",{className:"w-7 h-7",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-sm font-black uppercase tracking-widest transition-colors ${m?"text-cyan-400":"text-gray-400"}`,children:"កំណត់ពេល Telegram"}),e.jsx("p",{className:"text-[10px] text-gray-500 font-bold uppercase opacity-60",children:"Auto-Send Schedule"})]})]}),e.jsx("button",{type:"button",onClick:i,className:`relative inline-flex h-7 w-12 items-center rounded-full transition-colors focus:outline-none ${m?"bg-cyan-500":"bg-gray-700"}`,children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white shadow-md transition-transform duration-300 ease-in-out ${m?"translate-x-6":"translate-x-1"}`})})]}),m&&e.jsxs("div",{className:"animate-fade-in-down pt-6 mt-4 border-t border-cyan-500/10",children:[e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"datetime-local",value:x||"",onChange:f=>M({schedule:m,time:f.target.value}),onClick:f=>{try{"showPicker"in HTMLInputElement.prototype&&f.currentTarget.showPicker()}catch{}},className:"cyan-calendar-picker form-input !py-4 !pl-5 !pr-14 bg-black/40 border-cyan-500/20 text-white font-mono font-bold rounded-2xl focus:border-cyan-500 focus:ring-4 focus:ring-cyan-500/10 transition-all text-sm w-full cursor-pointer",min:new Date().toISOString().slice(0,16)})}),e.jsx("p",{className:"text-[9px] text-cyan-400/60 font-black uppercase tracking-widest text-center mt-3",children:"សារនឹងត្រូវផ្ញើដោយស្វ័យប្រវត្តិតាមម៉ោងកំណត់"})]}),e.jsx("div",{className:`absolute -right-6 -bottom-6 w-24 h-24 bg-cyan-500 transition-opacity duration-700 rounded-full blur-[40px] pointer-events-none ${m?"opacity-10":"opacity-0"}`})]})},oe={id:Date.now(),name:"",quantity:1,originalPrice:0,finalPrice:0,total:0,discountPercent:0,colorInfo:"",image:"",cost:0,discountType:"percent",discountAmountInput:"",discountPercentInput:"",finalPriceInput:"",applyDiscountToTotal:!1},ae=[{number:1,title:"អតិថិជន"},{number:2,title:"ផលិតផល"},{number:3,title:"ដឹកជញ្ជូន"},{number:4,title:"ផ្ទៀងផ្ទាត់"}],ze=({team:m,onSaveSuccess:x,onCancel:M})=>{const{appData:i,currentUser:f,apiKey:N,previewImage:w}=r.useContext(me),[p,P]=r.useState(1),[y,D]=r.useState(!1),u=r.useMemo(()=>({page:"",telegramValue:"",fulfillmentStore:"",customer:{name:"",phone:"",province:"",district:"",sangkat:"",additionalLocation:"",shippingFee:""},products:[{...oe,id:Date.now()}],shipping:{method:"",details:"",cost:""},payment:{status:"Unpaid",info:""},telegram:{schedule:!1,time:""},subtotal:0,grandTotal:0,note:""}),[]),[s,h]=r.useState(u),[I,F]=r.useState(!1),[A,W]=r.useState(""),[_,E]=r.useState(null),[z,X]=r.useState(null),[V,g]=r.useState(""),[j,L]=r.useState(""),[v,b]=r.useState(""),[S,$]=r.useState(!1),[k,te]=r.useState("charge"),[se,Y]=r.useState(!1),[Q,U]=r.useState(""),[Z,T]=r.useState("increment"),B=r.useMemo(()=>`createOrderDraft_${f==null?void 0:f.UserName}_${m}`,[f,m]);r.useEffect(()=>{window.innerWidth<768&&window.scrollTo({top:0,behavior:"smooth"})},[p]),r.useEffect(()=>{var n,o;try{const a=localStorage.getItem(B);if(a){const l=JSON.parse(a);if(h(d=>({...d,...l})),l.customer&&typeof l.customer.shippingFee=="number"&&te(l.customer.shippingFee===0?"free":"charge"),l.customer.phone){const d=l.customer.phone,t=(n=i.phoneCarriers)==null?void 0:n.find(c=>(c.Prefixes||"").split(",").some(q=>d.startsWith(q.trim())));g(t?R(t.CarrierLogoURL):"")}if(l.shipping.method){const d=(o=i.shippingMethods)==null?void 0:o.find(t=>t.MethodName===l.shipping.method);X(d||null),L(d?R(d.LogosURL):"")}}}catch{localStorage.removeItem(B)}},[B,i.phoneCarriers,i.shippingMethods]),r.useEffect(()=>{const n=setTimeout(()=>{localStorage.setItem(B,JSON.stringify(s))},500);return()=>clearTimeout(n)},[s,B]);const H=()=>D(!0),G=()=>{localStorage.removeItem(B),D(!1),M()},O=r.useMemo(()=>i.pages?i.pages.filter(n=>n.Team===m):[],[i.pages,m]);r.useEffect(()=>{if(O.length===1&&!s.page){const n=O[0];h(o=>({...o,page:n.PageName,telegramValue:n.TelegramValue,fulfillmentStore:n.DefaultStore||o.fulfillmentStore}))}},[O,s.page]);const xe=r.useMemo(()=>i.locations?[...new Set(i.locations.map(n=>n.Province))]:[],[i.locations]),pe=r.useMemo(()=>!i.locations||!s.customer.province?[]:[...new Set(i.locations.filter(n=>n.Province===s.customer.province).map(n=>n.District))].sort((n,o)=>String(n).localeCompare(String(o),"km")),[i.locations,s.customer.province]),he=r.useMemo(()=>!i.locations||!s.customer.province||!s.customer.district?[]:[...new Set(i.locations.filter(n=>n.Province===s.customer.province&&n.District===s.customer.district).map(n=>n.Sangkat).filter(Boolean))].sort((n,o)=>String(n).localeCompare(String(o),"km")),[i.locations,s.customer.province,s.customer.district]);r.useEffect(()=>{const n=s.products.reduce((a,l)=>a+(l.total||0),0),o=n+(Number(s.customer.shippingFee)||0);(n!==s.subtotal||o!==s.grandTotal)&&h(a=>({...a,subtotal:n,grandTotal:o}))},[s.products,s.customer.shippingFee]);const ne=(n,o)=>{const a={...n},l=o.find(q=>q.ProductName===a.name);a.quantity=Math.max(1,Number(a.quantity)||1),a.originalPrice=Math.max(0,l&&Number(l.Price)||0),a.cost=Math.max(0,l&&Number(l.Cost)||0);const d=a.quantity*a.originalPrice;let t=d,c=0;switch(a.discountType){case"percent":const q=Math.max(0,Number(a.discountPercentInput)||0);c=d*(q/100),t=d-c;break;case"amount":const ee=Math.max(0,Number(a.discountAmountInput)||0);c=a.quantity>1&&a.applyDiscountToTotal?ee:ee*a.quantity,t=d-c;break;case"custom":const C=Math.max(0,Number(a.finalPriceInput)||0);t=a.quantity*C,c=d-t,a.finalPrice=C;break}return a.total=Math.max(0,t),a.finalPrice=a.quantity>0?a.total/a.quantity:0,a.discountPercent=d>0?c/d*100:0,a.discountType!=="custom"&&(a.finalPriceInput=a.finalPrice.toFixed(2)),a},ge=r.useCallback(n=>{const o=i.products.find(a=>a.Barcode&&a.Barcode.trim()===n.trim());o&&(h(a=>{const l=a.products.findIndex(t=>t.name===o.ProductName);let d;if(l>-1){const t={...a.products[l]};Z==="increment"&&(t.quantity+=1);const c=ne(t,i.products);d=[...a.products],d[l]=c}else{const t=a.products.findIndex(ee=>!ee.name),c={...oe,id:Date.now(),name:o.ProductName,quantity:1,originalPrice:o.Price,cost:o.Cost,image:o.ImageURL},q=ne(c,i.products);t>-1?(d=[...a.products],d[t]=q):d=[...a.products,q]}return{...a,products:d}}),Z==="single"&&$(!1))},[i.products,Z]),K=n=>{const{name:o,value:a}=n.target;if(o==="phone"){let l=a.replace(/[^0-9]/g,"");l.length>1&&l.startsWith("00")?l="0"+l.substring(2):l.length>0&&!l.startsWith("0")&&(l="0"+l);let d=null;l.length>=2&&i.phoneCarriers&&(d=i.phoneCarriers.find(t=>(t.Prefixes||"").split(",").some(c=>l.startsWith(c.trim())))),g(d?R(d.CarrierLogoURL):""),h(t=>({...t,customer:{...t.customer,phone:l}}));return}if(o==="shippingFee"){const l=a===""?"":Math.max(0,parseFloat(a));h(d=>({...d,customer:{...d.customer,shippingFee:l}}));return}h(l=>{let d={...l.customer,[o]:a};return o==="province"?(d.district="",d.sangkat=""):o==="district"&&(d.sangkat=""),{...l,customer:d}})},J=(n,o,a)=>{h(l=>{const d=[...l.products];let t={...d[n]};if(["discountPercentInput","discountAmountInput","finalPriceInput"].includes(o)){let c=String(a).replace(/[^0-9.]/g,"").replace(/(\..*?)\./g,"$1");c.startsWith("0")&&c.length>1&&!c.startsWith("0.")&&(c=String(parseFloat(c))),t[o]=c}else t[o]=a;if(o==="name"){const c=i.products.find(q=>q.ProductName===a);t.name=a,c?(t.originalPrice=c.Price,t.image=c.ImageURL,t.cost=c.Cost,t.discountType="percent",t.finalPrice=c.Price,t.finalPriceInput=String(c.Price)):(t.originalPrice=0,t.image="",t.cost=0,t.discountType="custom",t.finalPrice=0)}return o==="discountType"&&(t.discountPercentInput="",t.discountAmountInput="",t.finalPrice=t.originalPrice,t.finalPriceInput=String(t.originalPrice)),d[n]=ne(t,i.products),{...l,products:d}})},be=n=>{X(n),L(R(n.LogosURL)),h(o=>({...o,shipping:{...o.shipping,method:n.MethodName,details:n.RequireDriverSelection?"":n.MethodName}}))},fe=n=>{const{name:o,value:a}=n.target;let l=a;o==="cost"&&(l.startsWith("0")&&l.length>1&&!l.startsWith("0.")&&(l=String(parseFloat(l))),l=String(Math.max(0,parseFloat(l)||0))),h(d=>({...d,shipping:{...d.shipping,[o]:l}}))},ye=n=>{h(o=>({...o,shipping:{...o.shipping,details:n}}))},je=n=>{var a;const o=((a=i.bankAccounts)==null?void 0:a.find(l=>l.BankName===n))||null;b(o?R(o.LogoURL):""),h(l=>({...l,payment:{...l.payment,info:n}}))},ie=n=>{te(n),h(o=>({...o,customer:{...o.customer,shippingFee:n==="free"?0:""}}))},ve=()=>{if(!N){alert("API Key Required for Maps.");return}const{province:n,district:o,sangkat:a,additionalLocation:l}=s.customer,d=[l,a,o,n,"Cambodia"].filter(Boolean).join(", ");U(`https://www.google.com/maps/embed/v1/search?key=${N}&q=${encodeURIComponent(d)}`),Y(!0)},ce=n=>{switch(W(""),n){case 1:return!s.customer.name||!s.customer.phone||!s.customer.province||!s.page||!s.fulfillmentStore?(W("សូមបំពេញឈ្មោះ, លេខទូរស័ព្ទ, ខេត្ត/ក្រុង, Page និងឃ្លាំងបញ្ចេញទំនិញ។"),!1):k==="charge"&&(s.customer.shippingFee===""||s.customer.shippingFee<0)?(W("សូមបញ្ចូលតម្លៃដឹកជញ្ជូនឱ្យបានត្រឹមត្រូវ។"),!1):!0;case 2:return s.products.length===0||s.products.some(o=>!o.name||o.quantity<=0)?(W("សូមពិនិត្យទិន្នន័យផលិតផល។"),!1):!0;case 3:return!s.shipping.method||z!=null&&z.RequireDriverSelection&&!s.shipping.details||s.shipping.cost===""||parseFloat(s.shipping.cost)<0?(W("សូមពិនិត្យព័ត៌មានដឹកជញ្ជូន។"),!1):!0;case 4:return s.payment.status==="Paid"&&!s.payment.info?(W("សូមជ្រើសរើសគណនីធនាគារ Tune។"),!1):s.telegram.schedule&&!s.telegram.time?(W("សូមជ្រើសរើសពេលវេលាផ្ញើសារ។"),!1):!0;default:return!0}},we=()=>{ce(p)&&P(p+1)},Ne=()=>{p>1&&P(p-1)},ke=async()=>{for(const a of ae)if(!ce(a.number)){P(a.number);return}F(!0);let n="0"+s.customer.phone.replace(/[^0-9]/g,"").replace(/^0+/,"");const o={currentUser:f,selectedTeam:m,page:s.page,telegramValue:s.telegramValue,customer:{...s.customer,phone:n,shippingFee:Number(s.customer.shippingFee)||0},products:s.products.map(a=>({name:a.name,quantity:Number(a.quantity)||1,originalPrice:Number(a.originalPrice)||0,finalPrice:Number(a.finalPrice)||0,total:Number(a.total)||0,colorInfo:a.colorInfo,cost:Number(a.cost)||0})),shipping:{...s.shipping,cost:Number(s.shipping.cost)||0},payment:s.payment,subtotal:Number(s.subtotal)||0,grandTotal:Number(s.grandTotal)||0,note:s.note,fulfillmentStore:s.fulfillmentStore,scheduledTime:s.telegram.schedule?s.telegram.time:""};try{const a=await fetch(`${ue}/api/submit-order`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),l=await a.json();if(!a.ok||l.status!=="success")throw new Error(l.message||"Error");localStorage.removeItem(B),E({type:"success",message:`ជោគជ័យ! Order ID: ${l.orderId}`}),setTimeout(x,3e3)}catch(a){E({type:"error",message:`បរាជ័យ: ${a.message}`}),setTimeout(()=>E(null),3e3)}finally{F(!1)}},Se=()=>{var n,o,a,l;switch(p){case 1:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ព័ត៌មានអតិថិជន & Page"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"input-label font-black text-xs uppercase tracking-widest text-gray-500 mb-2 block",children:"Facebook Page*"}),e.jsx(Te,{pages:O,selectedPageName:s.page,onSelect:t=>h({...s,page:t.PageName,telegramValue:t.TelegramValue,fulfillmentStore:t.DefaultStore||s.fulfillmentStore})})]})}),e.jsxs("div",{className:"md:col-span-2 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-1.5 h-4 bg-orange-500 rounded-full"}),e.jsx("label",{className:"input-label !mb-0 font-black text-xs uppercase tracking-widest text-orange-400",children:"ឃ្លាំងបញ្ចេញទំនិញ (Store)*"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3",children:(n=i.stores)==null?void 0:n.map(t=>{const c=s.fulfillmentStore===t.StoreName;return e.jsxs("button",{type:"button",onClick:()=>h({...s,fulfillmentStore:t.StoreName}),className:`relative overflow-hidden group p-4 rounded-2xl border-2 transition-all duration-300 flex flex-col items-center text-center gap-2 ${c?"bg-orange-500/10 border-orange-500 shadow-[0_0_20px_rgba(249,115,22,0.2)]":"bg-gray-900 border-gray-800 hover:border-gray-600"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center transition-colors ${c?"bg-orange-500 text-white":"bg-gray-800 text-gray-500 group-hover:text-gray-300"}`,children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("span",{className:`text-[11px] font-black uppercase tracking-tight ${c?"text-white":"text-gray-400"}`,children:t.StoreName}),c&&e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx("svg",{className:"w-4 h-4 text-orange-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]},t.StoreName)})})]}),e.jsx("input",{type:"text",name:"name",value:s.customer.name,placeholder:"ឈ្មោះអតិថិជន*",className:"form-input !py-3 rounded-xl border-gray-700 bg-gray-900",onChange:K,required:!0}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",name:"phone",value:s.customer.phone,placeholder:"លេខទូរស័ព្ទ*",className:"form-input !py-3 rounded-xl border-gray-700 bg-gray-900 pr-12",onChange:K,required:!0}),V&&e.jsx("img",{src:V,alt:"Carrier",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-auto object-contain"})]}),e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[e.jsx($e,{provinces:xe,selectedProvince:s.customer.province,onSelect:t=>K({target:{name:"province",value:t}})}),e.jsxs("select",{name:"district",value:s.customer.district,className:"form-select",onChange:K,disabled:!s.customer.province,children:[e.jsx("option",{value:"",children:"-- ស្រុក/ខណ្ឌ --"}),pe.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{name:"sangkat",value:s.customer.sangkat,className:"form-select",onChange:K,disabled:!s.customer.district,children:[e.jsx("option",{value:"",children:"-- ឃុំ/សង្កាត់ --"}),he.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"ទីតាំងលម្អិត (ផ្ទះលេខ, ផ្លូវ)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",name:"additionalLocation",value:s.customer.additionalLocation,placeholder:"បញ្ចូលទីតាំងលម្អិត...",className:"form-input !py-3 rounded-xl bg-gray-900 border-gray-700",onChange:K}),e.jsx("button",{type:"button",onClick:ve,className:"p-3 bg-blue-600/10 text-blue-400 rounded-xl border border-blue-500/20 hover:bg-blue-600 hover:text-white transition-all active:scale-90",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"ថ្លៃសេវាដឹកជញ្ជូន"}),e.jsxs("div",{className:"flex gap-3 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>ie("charge"),className:`flex-1 py-3 px-4 rounded-xl text-xs font-black uppercase transition-all border ${k==="charge"?"bg-blue-600 border-blue-500 text-white shadow-lg shadow-blue-600/20 active:scale-95":"bg-gray-800 border-gray-700 text-gray-500 hover:text-gray-300"}`,children:"គិតថ្លៃសេវា"}),e.jsx("button",{type:"button",onClick:()=>ie("free"),className:`flex-1 py-3 px-4 rounded-xl text-xs font-black uppercase transition-all border ${k==="free"?"bg-emerald-600 border-emerald-500 text-white shadow-lg shadow-emerald-600/20 active:scale-95":"bg-gray-800 border-gray-700 text-gray-500 hover:text-gray-300"}`,children:"មិនគិតថ្លៃសេវា"})]}),k==="charge"&&e.jsx("input",{type:"number",min:"0",name:"shippingFee",value:s.customer.shippingFee,placeholder:"តម្លៃដឹកជញ្ជូន (ឧ. 1.5)*",className:"form-input !py-3 rounded-xl border-gray-700 bg-gray-900",onChange:K,required:!0})]})]})]});case 2:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-4 sm:space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ផលិតផល & ការបញ្ចុះតម្លៃ"}),e.jsx("div",{className:"space-y-4 sm:space-y-6",children:s.products.map((t,c)=>{const q=(Number(t.quantity)||0)*(Number(t.originalPrice)||0),ee=q-(Number(t.total)||0);return e.jsxs("div",{className:"p-3 sm:p-5 bg-gray-800/40 rounded-2xl sm:rounded-3xl border border-gray-700 relative shadow-xl overflow-hidden group",children:[e.jsx("button",{type:"button",onClick:()=>{s.products.length>1&&h({...s,products:s.products.filter((C,le)=>le!==c)})},className:"absolute top-2 right-2 sm:top-4 sm:right-4 text-red-400 bg-red-400/10 rounded-full h-6 w-6 sm:h-8 sm:w-8 flex items-center justify-center border border-red-400/20 hover:bg-red-600 hover:text-white transition-all z-10 active:scale-90",disabled:s.products.length<=1,children:"×"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-3 sm:gap-6 mb-4 sm:mb-6",children:[e.jsx("div",{className:"md:col-span-2 flex justify-center",children:e.jsx("div",{className:"w-20 h-20 sm:w-28 sm:h-28 bg-gray-900 rounded-xl sm:rounded-2xl overflow-hidden border-2 border-gray-700 shadow-inner group-hover:border-blue-500/50 transition-colors",children:e.jsx("img",{src:R(t.image),className:"w-full h-full object-cover",alt:""})})}),e.jsxs("div",{className:"md:col-span-10 grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ឈ្មោះផលិតផល*"}),e.jsx(Le,{products:i.products||[],selectedProductName:t.name,onSelect:C=>J(c,"name",C)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ចំនួន*"}),e.jsxs("div",{className:"quantity-stepper !max-w-full",children:[e.jsx("button",{type:"button",className:"active:scale-95 transition-transform",onClick:()=>J(c,"quantity",Math.max(1,t.quantity-1)),disabled:t.quantity<=1,children:"-"}),e.jsx("span",{className:"quantity-display text-sm",children:t.quantity}),e.jsx("button",{type:"button",className:"active:scale-95 transition-transform",onClick:()=>J(c,"quantity",t.quantity+1),children:"+"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ពណ៌/សម្គាល់"}),e.jsx("input",{type:"text",list:`colors-datalist-${t.id}`,value:t.colorInfo,onChange:C=>J(c,"colorInfo",C.target.value),className:"form-input text-sm !py-2.5 rounded-xl bg-gray-900 border-gray-700",placeholder:"ឧ. ខៀវ, XL"}),e.jsx("datalist",{id:`colors-datalist-${t.id}`,children:(i.colors||[]).map((C,le)=>e.jsx("option",{value:C.ColorName},le))})]})]})]})]}),e.jsxs("div",{className:"bg-black/20 rounded-xl sm:rounded-[2rem] p-3 sm:p-6 border border-white/5 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"h-px flex-grow bg-gray-700/50"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-gray-500 uppercase tracking-[0.2em] sm:tracking-[0.3em] whitespace-nowrap",children:"Pricing & Discount"}),e.jsx("div",{className:"h-px flex-grow bg-gray-700/50"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-8",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"flex bg-gray-900/50 p-1 rounded-xl sm:rounded-2xl border border-gray-700 shadow-inner",children:["percent","amount","custom"].map(C=>e.jsx("button",{type:"button",onClick:()=>J(c,"discountType",C),className:`flex-1 flex flex-col items-center justify-center py-2 sm:py-2.5 rounded-lg sm:rounded-xl transition-all duration-300 active:scale-95 ${t.discountType===C?"bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:e.jsx("span",{className:"text-[9px] sm:text-[11px] font-black uppercase tracking-widest",children:C==="percent"?"បញ្ចុះ %":C==="amount"?"បញ្ចុះ $":"កែតម្លៃលក់"})},C))}),e.jsxs("div",{className:"relative animate-fade-in",children:[t.discountType==="percent"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"បញ្ចូលភាគរយបញ្ចុះតម្លៃ (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",max:"100",placeholder:"0",value:t.discountPercentInput,onChange:C=>J(c,"discountPercentInput",C.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-blue-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"%"})]})]}),t.discountType==="amount"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"បញ្ចូលទឹកប្រាក់បញ្ចុះតម្លៃ ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",placeholder:"0.00",value:t.discountAmountInput,onChange:C=>J(c,"discountAmountInput",C.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-red-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"$"})]}),t.quantity>1&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 bg-black/20 rounded-lg mt-1 sm:mt-2 border border-white/5 active:scale-95 transition-transform",children:[e.jsx("input",{type:"checkbox",checked:t.applyDiscountToTotal,onChange:C=>J(c,"applyDiscountToTotal",C.target.checked),className:"w-4 h-4 rounded border-gray-600 bg-gray-800 text-blue-500"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] text-gray-400 uppercase font-black",children:"បញ្ចុះលើតម្លៃសរុប"})]})]}),t.discountType==="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 ml-1",children:"កំណត់តម្លៃលក់ថ្មីក្នុង ១ ឯកតា ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"0.00",value:t.finalPriceInput,onChange:C=>J(c,"finalPriceInput",C.target.value),className:"form-input !text-base sm:!text-lg !font-black !py-2 sm:!py-3 pr-10 text-right text-emerald-400 bg-gray-900 border-gray-700"}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-black",children:"$"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-900/60 rounded-xl sm:rounded-[1.5rem] p-3 sm:p-5 border border-white/5 flex flex-col justify-between",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-[10px] sm:text-xs",children:[e.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Original Subtotal"}),e.jsxs("span",{className:"text-blue-400 font-black",children:["$",q.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] sm:text-xs",children:[e.jsx("span",{className:"text-gray-500 font-bold uppercase",children:"Discount Applied"}),e.jsxs("span",{className:"text-red-400 font-black",children:["-",ee>0?`$${ee.toFixed(2)}`:"$0.00"]})]}),e.jsx("div",{className:"h-px bg-gray-700/50 my-1"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-[9px] sm:text-[10px] font-black text-gray-400 uppercase tracking-widest",children:"Net Total"}),e.jsxs("span",{className:"text-xl sm:text-2xl font-black text-white tracking-tighter",children:["$",(t.total||0).toFixed(2)]})]})]}),e.jsx("div",{className:"mt-3 sm:mt-4 pt-2 sm:pt-3 border-t border-white/5 flex justify-center",children:e.jsxs("span",{className:"text-[8px] sm:text-[9px] bg-emerald-500/10 text-emerald-400 px-2 sm:px-3 py-1 rounded-full border border-emerald-500/20 font-black uppercase tracking-widest",children:["Avg. $",(t.finalPrice||0).toFixed(2)," / unit"]})})]})]})]})]},t.id)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mt-6",children:[e.jsxs("button",{type:"button",onClick:()=>h({...s,products:[...s.products,{...oe,id:Date.now()}]}),className:"flex-1 py-4 px-6 bg-gray-800 border border-gray-700 rounded-2xl text-gray-300 font-black uppercase text-[11px] tracking-widest hover:bg-gray-700 hover:border-blue-500 transition-all flex items-center justify-center gap-2 active:scale-95",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M12 4v16m8-8H4"})}),"បន្ថែមផលិតផល"]}),e.jsxs("button",{type:"button",onClick:()=>$(!0),className:"flex-1 py-4 px-6 bg-blue-600/10 border border-blue-500/30 rounded-2xl text-blue-400 font-black uppercase text-[11px] tracking-widest hover:bg-blue-600 hover:text-white transition-all flex items-center justify-center gap-2 shadow-lg shadow-blue-900/10 active:scale-95",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M3 7V5a2 2 0 0 1 2-2h2M17 3h2a2 2 0 0 1 2 2v2M21 17v2a2 2 0 0 1-2 2h-2M7 21H5a2 2 0 0 1-2-2v-2M7 12h10",strokeWidth:"3"})}),"Scan Barcode"]})]})]});case 3:return e.jsxs("fieldset",{className:"border border-gray-600 p-3 sm:p-4 rounded-lg animate-fade-in space-y-4 sm:space-y-6",children:[e.jsx("legend",{className:"px-2 text-base sm:text-lg font-semibold text-blue-300",children:"ដឹកជញ្ជូន"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"វិធីសាស្រ្តដឹកជញ្ជូន*"}),e.jsx(Pe,{methods:i.shippingMethods||[],selectedMethodName:s.shipping.method,onSelect:be})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"input-label font-black text-[10px] uppercase text-gray-500 tracking-widest mb-2 block",children:"ថ្លៃសេវាឲ្យអ្នកដឹក (Cost)*"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",name:"cost",placeholder:"0.00",value:s.shipping.cost,className:"form-input !py-3 rounded-xl bg-gray-900 border-gray-700 text-blue-400 font-black pr-12",onChange:fe,required:!0}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 font-bold",children:"$"})]})]}),(z==null?void 0:z.RequireDriverSelection)&&e.jsxs("div",{className:"md:col-span-2 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"h-4 w-1 bg-blue-500 rounded-full"}),e.jsx("label",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]",children:"ជ្រើសរើសអ្នកដឹក (DriverSelection)*"})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-4",children:(o=i.drivers)==null?void 0:o.map(t=>{const c=s.shipping.details===t.DriverName;return e.jsxs("button",{type:"button",onClick:()=>ye(t.DriverName),className:`group relative flex flex-col items-center p-2 sm:p-3 rounded-2xl sm:rounded-[2rem] border-2 transition-all duration-300 active:scale-95 ${c?"bg-blue-600/20 border-blue-500 shadow-lg shadow-blue-900/20 scale-105":"bg-gray-800/40 border-transparent hover:bg-gray-800 hover:border-gray-700"}`,children:[e.jsx("div",{className:`w-12 h-12 sm:w-20 sm:h-20 rounded-full overflow-hidden mb-2 sm:mb-3 border-2 sm:border-4 transition-all duration-500 ${c?"border-blue-500 shadow-xl":"border-gray-700 group-hover:border-gray-600"}`,children:e.jsx("img",{src:R(t.ImageURL),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:t.DriverName})}),e.jsx("span",{className:`text-[9px] sm:text-[11px] font-black uppercase tracking-widest text-center truncate w-full ${c?"text-white":"text-gray-400 group-hover:text-gray-200"}`,children:t.DriverName}),c&&e.jsx("div",{className:"absolute top-0.5 right-0.5 bg-blue-500 text-white rounded-full p-0.5 sm:p-1 shadow-lg animate-fade-in-scale",children:e.jsx("svg",{className:"w-2.5 h-2.5 sm:w-3 sm:h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:4,children:e.jsx("path",{d:"M5 13l4 4L19 7"})})})]},t.DriverName)})}),!s.shipping.details&&e.jsx("p",{className:"text-center text-[9px] text-gray-500 italic mt-1",children:"សូមជ្រើសរើសអ្នកដឹកម្នាក់"})]})]})]});case 4:const d=(a=i.drivers)==null?void 0:a.find(t=>t.DriverName===s.shipping.details);return e.jsxs("div",{className:"animate-fade-in space-y-4 sm:space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," ព័ត៌មានអតិថិជន"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 bg-gray-900/60 p-3 sm:p-5 rounded-2xl sm:rounded-3xl border border-white/5 shadow-inner",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Customer Info"}),e.jsx("p",{className:"text-white font-black text-base sm:text-lg",children:s.customer.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-blue-400 font-bold font-mono text-sm",children:s.customer.phone}),V&&e.jsx("img",{src:V,className:"h-4 sm:h-5 w-auto object-contain",alt:"Carrier"})]})]}),e.jsxs("div",{className:"space-y-1 md:text-right",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Location / Store"}),e.jsx("p",{className:"text-gray-200 font-bold text-xs sm:text-sm leading-tight",children:`${s.customer.additionalLocation}, ${s.customer.sangkat}, ${s.customer.district}, ${s.customer.province}`.replace(/^,|,$/g,"").trim()}),e.jsxs("p",{className:"text-purple-400 font-black text-[9px] uppercase tracking-wider",children:["Fulfillment: ",s.fulfillmentStore]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-500"})," ព័ត៌មានដឹកជញ្ជូន"]}),e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-5 rounded-2xl sm:rounded-3xl border border-white/5 shadow-inner grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Shipping Method"}),e.jsxs("div",{className:"flex items-center gap-2",children:[j&&e.jsx("img",{src:j,className:"h-4 sm:h-5 w-auto object-contain",alt:"Logo"}),e.jsx("p",{className:"text-white font-black text-xs sm:text-sm",children:s.shipping.method})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Driver / Details"}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&e.jsx("img",{src:R(d.ImageURL),className:"h-6 w-6 sm:h-8 sm:w-8 rounded-full object-cover border border-gray-700 cursor-pointer active:scale-95 transition-transform",alt:"Driver",onClick:()=>w(R(d.ImageURL))}),e.jsx("p",{className:"text-white font-bold text-xs sm:text-sm",children:s.shipping.details||"N/A"})]})]}),e.jsxs("div",{className:"space-y-1 sm:text-right",children:[e.jsx("p",{className:"text-[9px] text-gray-500 font-bold uppercase",children:"Internal Cost ($)"}),e.jsxs("p",{className:"text-orange-400 font-black text-base sm:text-lg font-mono",children:["$",(Number(s.shipping.cost)||0).toFixed(2)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 sm:mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500"})," បញ្ជីទំនិញកុម្ម៉ង់"]}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:s.products.map(t=>e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 bg-gray-900/40 p-2 sm:p-3 rounded-xl sm:rounded-2xl border border-white/5 group hover:border-blue-500/30 transition-all",children:[e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gray-800 rounded-lg sm:rounded-xl overflow-hidden border border-gray-700 flex-shrink-0 relative",children:e.jsx("img",{src:R(t.image),className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",alt:t.name})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start mb-0.5 sm:mb-1",children:[e.jsx("h4",{className:"text-white font-black text-xs sm:text-sm truncate leading-tight",children:t.name}),e.jsx("div",{className:"flex gap-1.5",children:e.jsxs("span",{className:"bg-blue-600/10 text-blue-400 text-[9px] sm:text-[10px] font-black px-1.5 sm:px-2.5 py-0.5 sm:py-1 rounded-lg border border-blue-500/20",children:["x",t.quantity]})})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[t.colorInfo&&e.jsx("span",{className:"text-[9px] bg-purple-500/10 text-purple-400 px-1.5 py-0.5 rounded-md font-bold",children:t.colorInfo}),e.jsxs("p",{className:"text-[9px] text-gray-500 font-bold uppercase tracking-tight",children:[e.jsxs("span",{children:["$",(t.finalPrice||0).toFixed(2)]})," / unit"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-black text-sm sm:text-base tracking-tight",children:["$",(t.total||0).toFixed(2)]}),e.jsx("p",{className:"text-[8px] text-gray-600 font-bold uppercase",children:"Subtotal"})]})]},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-white/5 text-center",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] text-gray-500 font-black uppercase mb-1",children:"សរុបទំនិញ"}),e.jsxs("p",{className:"text-white font-black text-base sm:text-lg",children:["$",(s.subtotal||0).toFixed(2)]})]}),e.jsxs("div",{className:"bg-gray-900/40 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-white/5 text-center",children:[e.jsx("p",{className:"text-[8px] sm:text-[9px] text-gray-500 font-black uppercase mb-1",children:"សេវាដឹក"}),e.jsxs("p",{className:"text-white font-black text-base sm:text-lg",children:["$",(Number(s.customer.shippingFee)||0).toFixed(2)]})]}),e.jsxs("div",{className:"col-span-2 bg-blue-600/10 p-3 sm:p-4 rounded-xl sm:rounded-2xl border border-blue-500/20 text-center shadow-lg shadow-blue-900/20",children:[e.jsx("p",{className:"text-[9px] sm:text-[10px] text-blue-400 font-black uppercase mb-1 tracking-widest",children:"សរុបរួម (Grand Total)"}),e.jsxs("p",{className:"text-white font-black text-2xl sm:text-3xl tracking-tighter",children:["$",(s.grandTotal||0).toFixed(2)]})]})]}),e.jsxs("fieldset",{className:"border border-gray-700 p-4 sm:p-6 rounded-2xl sm:rounded-3xl bg-gray-900/20",children:[e.jsx("legend",{className:"px-3 text-[10px] sm:text-xs font-black text-blue-400 uppercase tracking-[0.2em]",children:"ស្ថានភាពទូទាត់"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("select",{value:s.payment.status,onChange:t=>h({...s,payment:{...s.payment,status:t.target.value,info:""}}),className:"form-select bg-gray-800 text-sm",children:[e.jsx("option",{value:"Unpaid",children:"មិនទាន់ទូទាត់ (COD)"}),e.jsx("option",{value:"Paid",children:"ទូទាត់រួច (Paid)"})]}),s.payment.status==="Paid"&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 animate-fade-in",children:[e.jsxs("select",{value:s.payment.info,onChange:t=>je(t.target.value),className:"form-select bg-gray-800 flex-grow text-sm",children:[e.jsx("option",{value:"",children:"ជ្រើសរើសធនាគារ"}),(l=i.bankAccounts)==null?void 0:l.map(t=>e.jsx("option",{value:t.BankName,children:t.BankName},t.BankName))]}),v&&e.jsx("img",{src:v,className:"h-8 w-12 sm:h-10 sm:w-16 object-contain bg-white/10 p-1 rounded-lg sm:rounded-xl active:scale-95 transition-transform",alt:"bank"})]})]})]}),e.jsx(Fe,{schedule:s.telegram.schedule,time:s.telegram.time,onChange:t=>h({...s,telegram:t})}),e.jsxs("div",{className:"space-y-2 sm:space-y-3 pt-4",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1",children:"ចំណាំ & Link Google Map"}),e.jsx("textarea",{placeholder:"ចំណាំបន្ថែម...",value:s.note,rows:4,onChange:t=>h({...s,note:t.target.value}),className:"form-textarea bg-gray-900/60 !rounded-[1.5rem] sm:!rounded-[2rem] border-white/5 focus:border-blue-500/50 text-sm"})]})]});default:return null}};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto mt-2 sm:mt-10 lg:mt-14 px-1 sm:px-0",children:[e.jsx("style",{children:`
                @keyframes shimmer {
                    0% { background-position: -200% 0; }
                    100% { background-position: 200% 0; }
                }
                .btn-shimmer {
                    background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
                    background-size: 200% 100%;
                    animation: shimmer 3s infinite linear;
                }
                @keyframes pulse-glow {
                    0%, 100% { box-shadow: 0 0 15px rgba(37,99,235,0.3); }
                    50% { box-shadow: 0 0 30px rgba(37,99,235,0.6); }
                }
                .btn-pulse { animation: pulse-glow 2s infinite ease-in-out; }
             `}),_&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-[100] animate-fade-in p-4",children:e.jsxs("div",{className:"page-card text-center flex flex-col items-center animate-fade-in-scale",children:[_.type==="success"?e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-green-500/20 text-green-400 rounded-full flex items-center justify-center mb-4 border border-green-500/30 shadow-[0_0_30px_rgba(34,197,94,0.2)]",children:e.jsx("svg",{className:"h-8 w-8 sm:h-10 sm:w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}):e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-red-500/20 text-red-400 rounded-full flex items-center justify-center mb-4 border border-red-500/30",children:e.jsx("svg",{className:"h-8 w-8 sm:h-10 sm:w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("p",{className:"text-base sm:text-lg font-black text-white",children:_.message})]})}),e.jsx(Ie,{isOpen:se,onClose:()=>Y(!1),url:Q}),S&&e.jsx(De,{onClose:()=>$(!1),onCodeScanned:ge,scanMode:Z,setScanMode:T,productsInOrder:s.products,masterProducts:i.products||[]}),e.jsx(de,{isOpen:y,onClose:()=>D(!1),maxWidth:"max-w-sm",children:e.jsxs("div",{className:"p-6 text-center space-y-6",children:[e.jsx("div",{className:"mx-auto w-14 h-14 sm:w-16 sm:h-16 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center border border-red-500/20 shadow-xl shadow-red-900/10 animate-bounce-slow",children:e.jsx("svg",{className:"h-7 w-7 sm:h-8 sm:w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h3",{className:"text-lg sm:text-xl font-black text-white uppercase tracking-tighter",children:"បោះបង់ការបញ្ចូល?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>D(!1),className:"px-6 py-3 bg-gray-800 border border-gray-700 text-gray-300 rounded-2xl flex-1 font-black text-xs sm:text-sm transition-all hover:bg-gray-700 active:scale-95",children:"ទេ (ត្រឡប់)"}),e.jsx("button",{onClick:G,className:"px-6 py-3 bg-red-600 border border-red-500 text-white rounded-2xl flex-1 font-black text-xs sm:text-sm transition-all hover:bg-red-700 active:scale-95 shadow-lg shadow-red-900/20",children:"បាទ (បោះបង់)"})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-10 gap-4",children:[e.jsxs("h1",{className:"hidden md:flex text-2xl sm:text-3xl font-black text-white uppercase tracking-tighter items-center gap-3 sm:gap-4",children:[e.jsx("span",{className:"text-blue-500",children:"កុម្ម៉ង់ថ្មី"}),e.jsx("span",{className:"text-[9px] sm:text-[10px] bg-blue-600/20 text-blue-400 px-3 sm:px-4 py-1.5 rounded-full border border-blue-500/20 uppercase tracking-[0.15em] sm:tracking-[0.2em]",children:m})]}),e.jsx("button",{onClick:H,className:"hidden md:block px-6 py-2.5 bg-gray-800 border border-gray-700 hover:border-red-500 hover:bg-red-500/10 text-gray-400 hover:text-red-400 font-black rounded-2xl uppercase text-[10px] sm:text-[11px] tracking-widest transition-all active:scale-90",children:"បោះបង់"})]}),e.jsxs("div",{className:"bg-gray-800/30 backdrop-blur-3xl border border-white/5 rounded-[1.5rem] sm:rounded-[3rem] p-3 sm:p-10 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8 sm:mb-12 relative px-2 sm:px-4",children:[e.jsx("div",{className:"absolute left-6 right-6 sm:left-10 sm:right-10 top-1/2 w-[calc(100%-48px)] sm:w-[calc(100%-80px)] h-0.5 bg-gray-700 -z-10"}),e.jsx("div",{className:"absolute left-6 sm:left-10 top-1/2 h-0.5 bg-blue-500 -z-10 transition-all duration-500",style:{width:`${(p-1)/(ae.length-1)*(100-48/400*100)}%`}}),ae.map(n=>e.jsxs("div",{className:`relative flex flex-col items-center z-10 transition-all duration-500 ${p>=n.number?"scale-110":"opacity-40 scale-90"}`,children:[e.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex items-center justify-center font-black text-[10px] sm:text-xs border-2 transition-all duration-500 ${p>=n.number?"border-blue-500 bg-blue-600 text-white shadow-[0_0_20px_rgba(37,99,235,0.4)]":"border-gray-600 bg-gray-800 text-gray-500"}`,children:p>n.number?"✓":n.number}),e.jsx("span",{className:`absolute -bottom-6 sm:-bottom-7 text-[8px] sm:text-[9px] font-black uppercase tracking-widest whitespace-nowrap ${p>=n.number?"text-blue-400":"text-gray-600"}`,children:n.title})]},n.number))]}),e.jsx("div",{className:"mt-8 sm:mt-16",children:Se()}),A&&e.jsx("div",{className:"mt-4 sm:mt-6 p-3 sm:p-4 bg-red-500/10 border border-red-500/20 rounded-xl sm:rounded-2xl text-red-400 text-center text-[10px] sm:text-xs font-bold animate-shake",children:A}),e.jsxs("div",{className:"mt-8 sm:mt-10 pt-6 sm:pt-8 border-t border-white/5 space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex gap-3 sm:gap-4 h-12 sm:h-16",children:[p>1&&e.jsxs("button",{type:"button",onClick:Ne,className:"flex-1 px-4 sm:px-8 bg-gray-800 border border-gray-700 text-gray-300 rounded-2xl font-black uppercase text-[10px] sm:text-[12px] tracking-[0.15em] transition-all hover:bg-gray-700 flex items-center justify-center gap-2 active:scale-95",children:[e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:3,children:e.jsx("path",{d:"M15 19l-7-7 7-7"})}),"ត្រឡប់"]}),p<ae.length?e.jsxs("button",{type:"button",onClick:we,className:"relative flex-[2] bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-black uppercase text-[12px] sm:text-[14px] tracking-[0.2em] shadow-2xl active:scale-95 transition-all flex items-center justify-center gap-3 group overflow-hidden btn-pulse",children:[e.jsx("div",{className:"absolute inset-0 btn-shimmer pointer-events-none"}),e.jsx("span",{className:"relative z-10",children:"ជំហានបន្ទាប់"}),e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10 transform group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:3,children:e.jsx("path",{d:"M9 5l7 7-7 7"})})]}):e.jsxs("button",{type:"button",onClick:ke,className:"relative flex-[2] bg-emerald-600 hover:bg-emerald-700 text-white rounded-2xl font-black uppercase text-[12px] sm:text-[14px] tracking-[0.2em] shadow-2xl active:scale-95 transition-all flex items-center justify-center gap-3 overflow-hidden",disabled:I,children:[e.jsx("div",{className:"absolute inset-0 btn-shimmer pointer-events-none"}),I?e.jsx(re,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"relative z-10",children:"បញ្ជូនកម្ម៉ង់ឥឡូវនេះ"}),e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5 relative z-10 animate-bounce-x",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:3,children:e.jsx("path",{d:"M5 13l4 4L19 7"})})]})]})]}),e.jsx("button",{onClick:H,className:"md:hidden w-full py-4 bg-gray-800/40 text-gray-500 hover:text-red-400 font-black rounded-2xl uppercase text-[10px] tracking-widest transition-all active:scale-95 border border-white/5",children:"បោះបង់ការបញ្ចូល"})]})]}),e.jsx("style",{children:".animate-bounce-x { animation: bounce-x 1s infinite ease-in-out; } @keyframes bounce-x { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }"})]})},Oe=({team:m})=>{const[x,M]=r.useState([]),[i,f]=r.useState([]),[N,w]=r.useState(!0),[p,P]=r.useState(""),[y,D]=r.useState(""),[u,s]=r.useState("this_month"),[h,I]=r.useState(new Date().toISOString().split("T")[0]),[F,A]=r.useState(new Date().toISOString().split("T")[0]),W=r.useMemo(()=>new Set(["index","orderId","customerName","productInfo","location","pageInfo","total","shippingService","status","date","print"]),[]);r.useEffect(()=>{(async()=>{w(!0),P("");try{const L=await(await fetch(`${ue}/api/admin/all-orders`)).json();if(L.status==="success"){const b=(Array.isArray(L.data)?L.data.filter($=>$!==null):[]).map($=>{let k=[];try{$["Products (JSON)"]&&(k=JSON.parse($["Products (JSON)"]))}catch{}return{...$,Products:k}});f(b);const S=b.filter($=>($.Team||"").trim()===(m||"").trim());M(S.sort(($,k)=>new Date(k.Timestamp).getTime()-new Date($.Timestamp).getTime()))}}catch(j){P(j.message)}finally{w(!1)}})()},[m]);const _=g=>{const j=new Date,L=new Date(j.getFullYear(),j.getMonth(),j.getDate());let v=null,b=new Date;switch(g){case"today":v=L;break;case"yesterday":v=new Date(L),v.setDate(L.getDate()-1),b=new Date(L),b.setMilliseconds(-1);break;case"this_week":const S=j.getDay();v=new Date(L),v.setDate(L.getDate()-(S===0?6:S-1));break;case"this_month":v=new Date(j.getFullYear(),j.getMonth(),1);break;case"custom":v=new Date(h+"T00:00:00"),b=new Date(F+"T23:59:59");break}return{start:v,end:b}},E=r.useMemo(()=>{const{start:g,end:j}=_(u);return x.filter(L=>{const v=new Date(L.Timestamp);if(g&&v<g||j&&v>j)return!1;if(y.trim()){const b=y.toLowerCase();if(!(L["Order ID"].toLowerCase().includes(b)||(L["Customer Name"]||"").toLowerCase().includes(b)||(L["Customer Phone"]||"").includes(b)))return!1}return!0})},[x,y,u,h,F]),z=r.useMemo(()=>E.reduce((g,j)=>g+(Number(j["Grand Total"])||0),0),[E]),X=r.useMemo(()=>{const{start:g,end:j}=_(u),L=i.filter(b=>{const S=new Date(b.Timestamp);return!(g&&S<g||j&&S>j)}),v={};return L.forEach(b=>{const S=(b.Team||"Unassigned").trim();v[S]=(v[S]||0)+(Number(b["Grand Total"])||0)}),Object.entries(v).map(([b,S])=>({name:b,revenue:S})).sort((b,S)=>S.revenue-b.revenue).slice(0,3)},[i,u,h,F]),V=r.useMemo(()=>{switch(u){case"today":return"ថ្ងៃនេះ";case"yesterday":return"ម្សិលមិញ";case"this_week":return"សប្តាហ៍នេះ";case"this_month":return"ខែនេះ";case"custom":return`${h} ដល់ ${F}`;default:return""}},[u,h,F]);return N?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(re,{size:"lg"})}):e.jsxs("div",{className:"space-y-6 flex flex-col min-h-[2000px]",children:[e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx("div",{className:"h-6 w-1.5 bg-yellow-500 rounded-full shadow-[0_0_10px_rgba(234,179,8,0.3)]"}),e.jsxs("h3",{className:"text-sm font-black text-white uppercase tracking-wider",children:["ចំណាត់ថ្នាក់លក់បានច្រើនជាងគេ (",u==="custom"?"តាមកាលបរិច្ឆេទកំណត់":V,")"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:X.length>0?X.map((g,j)=>e.jsxs("div",{className:"relative overflow-hidden bg-gray-800/40 border border-white/5 p-4 rounded-2xl flex items-center gap-4 transition-all duration-500 hover:bg-gray-800/60 shadow-xl",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-lg ${j===0?"bg-yellow-500/20 text-yellow-500 border border-yellow-500/50":j===1?"bg-gray-400/20 text-gray-300 border border-gray-400/50":"bg-orange-600/20 text-orange-500 border border-orange-600/50"}`,children:j===0?"🥇":j===1?"🥈":"🥉"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:["TOP ",j+1," TEAM"]}),e.jsx("h4",{className:"text-sm font-black text-white truncate",children:g.name})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-blue-400 font-black",children:["$",g.revenue.toLocaleString(void 0,{maximumFractionDigits:0})]})})]},g.name)):e.jsx("div",{className:"col-span-full py-4 text-center bg-gray-800/20 rounded-2xl border border-dashed border-gray-700",children:e.jsx("p",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest",children:"មិនទាន់មានទិន្នន័យលក់"})})}),e.jsxs("div",{className:"bg-gray-900/40 p-4 rounded-2xl border border-gray-700 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:max-w-xs",children:[e.jsx("input",{type:"text",placeholder:"ស្វែងរក ID, ឈ្មោះ...",value:y,onChange:g=>D(g.target.value),className:"form-input !pl-10 w-full !py-2 bg-gray-900/60"}),e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"bg-blue-600/10 px-4 py-2 rounded-xl border border-blue-500/20 hidden sm:block",children:[e.jsxs("p",{className:"text-[9px] font-black text-blue-400 uppercase tracking-widest leading-none mb-1",children:["សរុបលក់បាន (",u==="custom"?"កំណត់":V,")"]}),e.jsxs("p",{className:"text-lg font-black text-white leading-none",children:["$",z.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsx("div",{className:"flex items-center gap-1 bg-gray-800/80 p-1 rounded-lg border border-gray-700",children:["today","this_week","this_month","custom"].map(g=>e.jsx("button",{onClick:()=>s(g),className:`px-3 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all ${u===g?"bg-blue-600 text-white shadow-md":"text-gray-500 hover:text-gray-300"}`,children:g==="today"?"ថ្ងៃនេះ":g==="this_week"?"សប្តាហ៍នេះ":g==="this_month"?"ខែនេះ":"កំណត់"},g))})]})]}),u==="custom"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4 pt-3 border-t border-gray-800 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:"ចាប់ពី"}),e.jsx("input",{type:"date",value:h,onChange:g=>I(g.target.value),className:"form-input !py-1.5 !px-3 bg-gray-800 border-gray-700 text-xs rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:"ដល់"}),e.jsx("input",{type:"date",value:F,onChange:g=>A(g.target.value),className:"form-input !py-1.5 !px-3 bg-gray-800 border-gray-700 text-xs rounded-xl"})]})]})]}),E.length===0?e.jsx("div",{className:"text-center py-20 bg-gray-800/20 rounded-3xl border-2 border-dashed border-gray-700/50",children:e.jsx("p",{className:"text-gray-500 font-bold uppercase tracking-widest text-xs",children:"មិនមានទិន្នន័យត្រូវបានរកឃើញ"})}):e.jsxs("div",{className:"space-y-4 flex-grow",children:[e.jsx(Me,{orders:E,showActions:!1,visibleColumns:W}),e.jsxs("div",{className:"md:hidden bg-blue-600 p-5 rounded-[2rem] shadow-2xl flex justify-between items-center border border-white/10",children:[e.jsxs("span",{className:"text-white font-black uppercase text-xs tracking-widest",children:["សរុបលក់បាន (",E.length,")"]}),e.jsxs("span",{className:"text-white font-black text-xl",children:["$",z.toLocaleString(void 0,{minimumFractionDigits:2})]})]})]}),e.jsx("div",{className:"h-64 md:h-[600px] pointer-events-none opacity-0 shrink-0"})]})},Re=({onBackToRoleSelect:m})=>{const{currentUser:x,setChatVisibility:M}=r.useContext(me),[i,f]=r.useState("list"),[N,w]=Ce("team",""),p=r.useMemo(()=>((x==null?void 0:x.Team)||"").split(",").map(P=>P.trim()).filter(Boolean),[x]);return r.useEffect(()=>{M(i!=="create")},[i]),r.useEffect(()=>{p.length===1&&!N&&w(p[0])},[p,N]),p.length===0?e.jsxs("div",{className:"page-card text-center p-12 mt-20 max-w-2xl mx-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-2",children:["សួស្តី, ",x==null?void 0:x.FullName]}),e.jsx("p",{className:"text-gray-400",children:"មិនមានទិន្នន័យក្រុម"}),e.jsx("button",{onClick:m,className:"btn btn-secondary mt-6",children:"ត្រឡប់"})]}):N?i==="create"?e.jsx(ze,{team:N,onSaveSuccess:()=>f("list"),onCancel:()=>f("list")}):e.jsxs("div",{className:"w-full max-w-[115rem] mx-auto p-2 sm:p-4 animate-fade-in overflow-x-hidden min-h-[2000px]",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-black text-white flex items-center gap-3",children:["ការកម្មង់របស់ខ្ញុំ",e.jsx("span",{className:"text-[10px] bg-blue-600/20 text-blue-400 px-3 py-1 rounded-full border border-blue-500/20 uppercase tracking-[0.2em]",children:N})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[p.length>1&&e.jsxs("button",{onClick:()=>w(""),className:"flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-blue-600 text-gray-300 hover:text-white rounded-xl text-[11px] font-black uppercase transition-all border border-gray-700 hover:border-blue-500 hover:shadow-lg hover:shadow-blue-600/20 active:scale-95",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"ប្តូរក្រុម"]}),(x==null?void 0:x.IsSystemAdmin)&&e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-yellow-600 text-gray-300 hover:text-white rounded-xl text-[11px] font-black uppercase transition-all border border-gray-700 hover:border-yellow-500 hover:shadow-lg hover:shadow-yellow-600/20 active:scale-95",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z"})}),"ជ្រើសរើសតួនាទី"]})]})]}),e.jsx("button",{onClick:()=>f("create"),className:"btn btn-primary w-full md:w-auto px-10 shadow-xl shadow-blue-600/20 h-14 text-base font-black active:scale-95 transition-all rounded-2xl uppercase tracking-widest",children:"បង្កើតការកម្មង់ថ្មី"})]}),e.jsx("div",{className:"bg-gray-800/20 border border-gray-700/50 rounded-[2.5rem] p-2 sm:p-6 shadow-2xl overflow-visible min-h-[2000px]",children:e.jsx(Oe,{team:N})})]}):e.jsxs("div",{className:"w-full max-w-5xl mx-auto p-4 mt-10 md:mt-20 animate-fade-in text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-8",children:"សូមជ្រើសរើសក្រុមដើម្បីបន្ត"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:p.map(P=>e.jsx("button",{onClick:()=>w(P),className:"bg-gray-800/50 border border-gray-700 rounded-2xl p-8 hover:border-blue-500 transition-all group shadow-xl",children:e.jsx("span",{className:"text-xl font-bold text-white group-hover:text-blue-400 transition-colors",children:P})},P))})]})};export{Re as default};
