import{r as s,j as e,c as S,M as q,S as U}from"./index-DNGH7LF7.js";const Z=(t,n)=>{if(!n||!t)return e.jsx("span",{children:t});const u=n.split(" ").filter(Boolean).map(a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));if(u.length===0)return e.jsx("span",{children:t});const c=new RegExp(`(${u.join("|")})`,"gi");return e.jsx(e.Fragment,{children:t.split(c).map((a,i)=>c.test(a)&&a.trim()!==""?e.jsx("strong",{className:"text-yellow-300 bg-yellow-900/50 rounded-sm px-0.5",children:a},i):a)})},Q=(t,n)=>{const u=(t.ProductName||"").toLowerCase(),c=(t.Barcode||"").toLowerCase(),a=`${u} ${c}`,i=n.toLowerCase().trim();if(!i)return 1;const d=i.split(" ").filter(Boolean);if(!d.every(o=>a.includes(o)))return 0;let m=10;return d.forEach(o=>{u.includes(o)&&(m+=20),c.includes(o)&&(m+=10)}),u.startsWith(i)&&(m+=500),m},K=({products:t,selectedProductName:n,onSelect:u})=>{const[c,a]=s.useState(!1),[i,d]=s.useState(""),[x,m]=s.useState(0),[o,p]=s.useState(null),[r,g]=s.useState(window.innerWidth<768),v=s.useRef(null),f=s.useRef(null),k=s.useRef(null);s.useEffect(()=>{const l=()=>g(window.innerWidth<768);return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),s.useEffect(()=>{d(n)},[n]),s.useEffect(()=>{if(o){const l=setTimeout(()=>{k.current&&k.current.scrollIntoView({behavior:"smooth",block:"center"})},100);return()=>clearTimeout(l)}},[o]),s.useEffect(()=>{const l=h=>{v.current&&!v.current.contains(h.target)&&(a(!1),d(n))};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[n]);const M=s.useMemo(()=>{const l=i||"";return l.trim()?t.map(h=>({product:h,score:Q(h,l)})).filter(h=>h.score>0).sort((h,j)=>j.score-h.score||h.product.ProductName.localeCompare(j.product.ProductName)).map(h=>h.product):[]},[t,i]),B=s.useMemo(()=>{const l=i.trim();return l?!t.some(h=>h.ProductName.trim().toLowerCase()===l.toLowerCase()):!1},[i,t]),N=s.useMemo(()=>{const l=[...M];return B&&l.unshift({isAddNew:!0,ProductName:i.trim()}),l},[M,B,i]),_=s.useCallback(l=>{var h;u(l),d(l),a(!1),p(null),m(0),(h=f.current)==null||h.blur()},[u]),z=l=>{l.isAddNew?_(l.ProductName):(p(l),a(!1))},D=s.useCallback(()=>{var l;u(""),d(""),a(!0),m(0),(l=f.current)==null||l.focus()},[u]),H=l=>{var j;const h=N.length;if(h!==0)switch(l.key){case"ArrowDown":l.preventDefault(),c||a(!0),m(y=>(y+1)%h);break;case"ArrowUp":l.preventDefault(),c||a(!0),m(y=>(y-1+h)%h);break;case"Enter":if(l.preventDefault(),!c)return;x>-1&&N[x]&&z(N[x]);break;case"Escape":a(!1),d(n),(j=f.current)==null||j.blur();break}};return e.jsxs("div",{className:"relative",ref:v,children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{ref:f,type:"text",className:"form-input !pr-16 !py-3.5 bg-gray-900/50 border-gray-700 group-hover:border-blue-500/50 transition-all rounded-[1.25rem] font-bold text-gray-200",placeholder:"ស្វែងរកផលិតផល...",value:i,onChange:l=>{d(l.target.value),a(!0),m(0)},onFocus:()=>a(!0),onKeyDown:H}),e.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[i&&e.jsx("button",{type:"button",onClick:D,className:"text-gray-500 hover:text-white text-2xl",children:"×"}),e.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),c&&e.jsx("div",{className:"absolute z-[100] w-full mt-2 bg-gray-800/95 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.5)] overflow-hidden animate-fade-in-down max-h-80",children:e.jsx("ul",{className:"overflow-y-auto p-2 space-y-1 custom-scrollbar",children:N.length===0?e.jsx("li",{className:"p-4 text-center text-xs text-gray-500 font-black uppercase tracking-widest",children:"រកមិនឃើញផលិតផលទេ"}):N.map((l,h)=>{if("isAddNew"in l&&l.isAddNew)return e.jsxs("li",{className:`p-3.5 rounded-2xl cursor-pointer flex items-center gap-4 transition-all ${x===h?"bg-blue-600 text-white":"hover:bg-white/5 text-gray-300"}`,onMouseDown:()=>z(l),children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center border border-blue-500/30",children:e.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"})})}),e.jsx("div",{className:"min-w-0",children:e.jsxs("p",{className:"font-black text-sm leading-tight",children:["បន្ថែមថ្មី៖ ",e.jsxs("span",{className:"text-yellow-400",children:['"',l.ProductName,'"']})]})})]},"add-new");const j=l;return e.jsxs("li",{className:`p-2.5 rounded-2xl cursor-pointer flex items-center gap-3 transition-all ${x===h?"bg-blue-600 text-white shadow-lg":"hover:bg-white/5 text-gray-300"}`,onMouseDown:()=>z(j),children:[e.jsx("img",{src:S(j.ImageURL),className:"w-12 h-12 rounded-xl object-cover border border-white/10",alt:""}),e.jsxs("div",{className:"min-w-0 flex-grow",children:[e.jsx("p",{className:"font-black text-[15px] truncate leading-tight",children:Z(j.ProductName,i)}),e.jsx("div",{className:"flex items-center gap-2 mt-0.5",children:e.jsxs("span",{className:"text-[10px] font-black text-blue-400 bg-blue-500/10 px-2 py-0.5 rounded-md border border-blue-500/10",children:["$",j.Price.toFixed(2)]})})]})]},j.ProductName)})})}),o&&e.jsx(q,{isOpen:!0,onClose:()=>p(null),maxWidth:r?"max-w-[95vw]":"max-w-2xl",children:e.jsxs("div",{ref:k,className:"bg-[#0f172a] rounded-[2rem] sm:rounded-[3rem] overflow-hidden shadow-[0_30px_100px_rgba(0,0,0,0.8)] border border-white/5 relative",children:[e.jsxs("div",{className:"relative h-48 sm:h-72 w-full",children:[e.jsx("div",{className:"absolute inset-0 z-0",children:e.jsx("img",{src:S(o.ImageURL),className:"w-full h-full object-cover blur-3xl opacity-30",alt:""})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 p-6",children:e.jsx("img",{src:S(o.ImageURL),className:"h-full w-auto object-contain rounded-2xl sm:rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.5)] border border-white/10 transform transition-transform hover:scale-105 duration-500",alt:o.ProductName})}),e.jsx("div",{className:"absolute top-4 right-4 z-20",children:e.jsxs("div",{className:"bg-emerald-500 text-white font-black px-4 py-2 rounded-2xl shadow-xl border-2 border-white/20 text-lg",children:["$",o.Price.toFixed(2)]})})]}),e.jsxs("div",{className:"p-6 sm:p-10 text-center space-y-6 sm:space-y-8 bg-gradient-to-b from-transparent to-black/40",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-500 text-[10px] sm:text-xs font-black uppercase tracking-[0.4em] mb-3",children:"បញ្ជាក់ការជ្រើសរើស"}),e.jsx("h3",{className:"text-2xl sm:text-4xl font-black text-white leading-tight break-words",children:o.ProductName}),o.Barcode&&e.jsxs("div",{className:"mt-4 inline-flex items-center gap-2 bg-white/5 px-4 py-1.5 rounded-full border border-white/5",children:[e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"text-gray-400 font-mono text-xs tracking-widest",children:o.Barcode})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 w-full",children:[e.jsx("button",{onClick:()=>p(null),className:"order-2 sm:order-1 flex-1 py-4 sm:py-5 bg-gray-800/50 hover:bg-gray-800 text-gray-400 font-black rounded-2xl uppercase text-[11px] tracking-widest transition-all active:scale-95 border border-white/5",children:"បោះបង់"}),e.jsxs("button",{onClick:()=>_(o.ProductName),className:"order-1 sm:order-2 flex-[2] py-4 sm:py-5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-black rounded-2xl uppercase text-xs tracking-[0.2em] shadow-[0_10px_30px_rgba(37,99,235,0.4)] hover:from-blue-500 hover:to-indigo-500 transition-all active:scale-95 flex items-center justify-center gap-3",children:["ជ្រើសរើសយក",e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})]}),e.jsx("div",{className:"absolute -bottom-20 -left-20 w-64 h-64 bg-blue-600/10 rounded-full blur-[80px] pointer-events-none"}),e.jsx("div",{className:"absolute -top-20 -right-20 w-64 h-64 bg-indigo-600/10 rounded-full blur-[80px] pointer-events-none"})]})})]})},G=({pages:t,selectedPageName:n,onSelect:u})=>e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"flex overflow-x-auto gap-3.5 pb-6 pt-2 px-1 snap-x no-scrollbar",children:[t.map(c=>{const a=n===c.PageName;return e.jsxs("button",{type:"button",onClick:()=>u(c),className:`
                                relative flex-shrink-0 w-[115px] h-[135px] snap-center rounded-[2rem] 
                                border-2 transition-all duration-700 outline-none group
                                ${a?"bg-blue-600/20 border-blue-500 shadow-[0_15px_30px_rgba(59,130,246,0.3)] scale-105":"bg-gray-800/30 backdrop-blur-xl border-white/5 hover:border-blue-500/30"}
                            `,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-3 gap-2",children:[e.jsxs("div",{className:"relative",children:[a&&e.jsx("div",{className:"absolute inset-0 bg-blue-500 rounded-full blur-lg opacity-50 animate-pulse"}),e.jsx("div",{className:`
                                        relative w-12 h-12 rounded-full overflow-hidden border-2 transition-all duration-700
                                        ${a?"border-white scale-110 shadow-2xl rotate-[360deg]":"border-gray-700 opacity-50 group-hover:opacity-100"}
                                    `,children:e.jsx("img",{src:S(c.PageLogoURL),className:"w-full h-full object-cover",alt:c.PageName})}),a&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center border-2 border-gray-900 shadow-lg animate-bounce-slow",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:4,children:e.jsx("path",{d:"M5 13l4 4L19 7"})})})]}),e.jsxs("div",{className:"text-center w-full px-1",children:[e.jsx("span",{className:`
                                        text-[10px] font-black uppercase tracking-tighter leading-tight block truncate transition-colors duration-500
                                        ${a?"text-white":"text-gray-500 group-hover:text-gray-300"}
                                    `,children:c.PageName}),c.TelegramValue&&a&&e.jsxs("span",{className:"text-[7px] font-bold text-blue-400/80 block mt-0.5 animate-fade-in truncate",children:["@",c.TelegramValue]})]})]}),e.jsx("div",{className:`
                                absolute bottom-3 left-1/2 -translate-x-1/2 h-1 rounded-full transition-all duration-700
                                ${a?"w-6 bg-blue-400 shadow-[0_0_8px_#60a5fa]":"w-0 bg-transparent"}
                            `})]},c.PageName)}),t.length===0&&e.jsxs("div",{className:"w-full py-10 flex flex-col items-center justify-center bg-gray-900/20 rounded-[2.5rem] border-2 border-dashed border-gray-800",children:[e.jsx("svg",{className:"w-6 h-6 text-gray-700 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("p",{className:"text-[9px] font-black text-gray-600 uppercase tracking-widest italic",children:"រកមិនឃើញ Page"})]})]}),e.jsx("style",{children:`
                .no-scrollbar::-webkit-scrollbar {
                    display: none;
                }
                .no-scrollbar {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }
                @keyframes bounce-slow {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-3px); }
                }
                .animate-bounce-slow {
                    animation: bounce-slow 2s infinite ease-in-out;
                }
            `})]}),X=({pages:t,selectedPageName:n,onSelect:u,placeholder:c="ជ្រើសរើស Page..."})=>{const[a,i]=s.useState(!1),[d,x]=s.useState(""),m=s.useRef(null);s.useEffect(()=>{const r=t.find(g=>g.PageName===n);r&&x(r.PageName)},[n,t]),s.useEffect(()=>{const r=g=>{if(m.current&&!m.current.contains(g.target)){i(!1);const v=t.find(f=>f.PageName===n);x(v?v.PageName:"")}};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[n,t]);const o=s.useMemo(()=>{if(!d.trim())return t;const r=d.toLowerCase();return t.filter(g=>g.PageName.toLowerCase().includes(r))},[t,d]),p=t.find(r=>r.PageName===n);return e.jsxs("div",{className:"relative w-full",ref:m,children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",className:"form-input !pl-14 !pr-10 !py-3.5 bg-gray-900/50 border-gray-700 group-hover:border-blue-500/50 transition-all rounded-[1.25rem] font-bold text-gray-200",placeholder:c,value:d,onChange:r=>{x(r.target.value),i(!0)},onFocus:()=>i(!0)}),e.jsx("div",{className:"absolute left-3.5 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-800 overflow-hidden border border-white/5 flex items-center justify-center",children:p?e.jsx("img",{src:S(p.PageLogoURL),className:"w-full h-full object-cover",alt:""}):e.jsx("svg",{className:"w-4 h-4 text-gray-600",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM7.07 18.28c.43-.9 1.91-1.61 3.46-1.61s3.03.72 3.46 1.61C12.79 19.11 11.41 19.5 10 19.5s-2.79-.39-3.93-1.22zM15.6 17.03c-.78-1.13-2.56-1.86-4.6-1.86s-3.82.73-4.6 1.86c-.52-.51-.95-1.09-1.27-1.74.88-1.19 2.72-2.12 4.87-2.12s3.99.93 4.87 2.12c-.32.65-.75 1.23-1.27 1.74zM10 12.3c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"})})})}),e.jsx("div",{className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-gray-600 group-focus-within:text-blue-500 transition-colors",children:e.jsx("svg",{className:`w-5 h-5 transition-transform duration-300 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 9l-7 7-7-7",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),a&&e.jsx("div",{className:"absolute z-[100] w-full mt-2 bg-gray-800/95 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-[0_20px_60px_rgba(0,0,0,0.6)] overflow-hidden animate-fade-in-down",children:e.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar p-2.5 space-y-1.5",children:o.length>0?o.map(r=>e.jsxs("button",{type:"button",onClick:()=>{u(r),x(r.PageName),i(!1)},className:`w-full flex items-center gap-3.5 p-3 rounded-2xl transition-all ${n===r.PageName?"bg-blue-600 text-white shadow-lg shadow-blue-600/20":"text-gray-300 hover:bg-white/5"}`,children:[e.jsx("img",{src:S(r.PageLogoURL),className:"w-11 h-11 rounded-full object-cover border-2 border-white/10 shadow-sm flex-shrink-0",alt:""}),e.jsxs("div",{className:"text-left min-w-0",children:[e.jsx("p",{className:"font-black text-[15px] truncate leading-tight",children:r.PageName}),e.jsx("p",{className:`text-[10px] uppercase tracking-widest font-black mt-1 ${n===r.PageName?"text-blue-100":"text-gray-500"}`,children:r.Team})]})]},r.PageName)):e.jsx("div",{className:"p-6 text-center text-xs text-gray-500 font-black uppercase tracking-widest",children:"រកមិនឃើញ Page ទេ"})})})]})},J=({methods:t,selectedMethodName:n,onSelect:u,placeholder:c="ជ្រើសរើសសេវាដឹកជញ្ជូន..."})=>{const[a,i]=s.useState(!1),[d,x]=s.useState(""),m=s.useRef(null);s.useEffect(()=>{const r=t.find(g=>g.MethodName===n);r&&x(r.MethodName)},[n,t]),s.useEffect(()=>{const r=g=>{if(m.current&&!m.current.contains(g.target)){i(!1);const v=t.find(f=>f.MethodName===n);x(v?v.MethodName:"")}};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[n,t]);const o=s.useMemo(()=>{if(!d.trim())return t;const r=d.toLowerCase();return t.filter(g=>g.MethodName.toLowerCase().includes(r))},[t,d]),p=t.find(r=>r.MethodName===n);return e.jsxs("div",{className:"relative w-full",ref:m,children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",className:"form-input !pl-14 !pr-10 !py-3.5 bg-gray-900/50 border-gray-700 group-hover:border-blue-500/50 transition-all rounded-[1.25rem] font-bold text-gray-200",placeholder:c,value:d,onChange:r=>{x(r.target.value),i(!0)},onFocus:()=>i(!0)}),e.jsx("div",{className:"absolute left-3.5 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"w-8 h-8 rounded-xl bg-gray-800 overflow-hidden border border-white/5 flex items-center justify-center p-1 shadow-inner",children:p?e.jsx("img",{src:S(p.LogosURL),className:"w-full h-full object-contain",alt:""}):e.jsxs("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h8a1 1 0 001-1z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M13 16l4-4 4 4"})]})})}),e.jsx("div",{className:"absolute right-3.5 top-1/2 -translate-y-1/2 text-gray-600 group-focus-within:text-blue-500 transition-colors",children:e.jsx("svg",{className:`w-5 h-5 transition-transform duration-300 ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 9l-7 7-7-7",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),a&&e.jsx("div",{className:"absolute z-[100] w-full mt-2 bg-gray-800/95 backdrop-blur-xl border border-white/10 rounded-[1.5rem] shadow-[0_20px_60px_rgba(0,0,0,0.6)] overflow-hidden animate-fade-in-down",children:e.jsx("div",{className:"max-h-64 overflow-y-auto custom-scrollbar p-2.5 space-y-1.5",children:o.length>0?o.map(r=>e.jsxs("button",{type:"button",onClick:()=>{u(r),x(r.MethodName),i(!1)},className:`w-full flex items-center gap-3.5 p-3 rounded-2xl transition-all ${n===r.MethodName?"bg-blue-600 text-white shadow-lg shadow-blue-600/20":"text-gray-300 hover:bg-white/5"}`,children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-gray-900 border-2 border-white/10 p-1.5 shadow-sm flex-shrink-0 flex items-center justify-center",children:e.jsx("img",{src:S(r.LogosURL),className:"w-full h-full object-contain",alt:""})}),e.jsxs("div",{className:"text-left min-w-0 flex-grow",children:[e.jsx("p",{className:"font-black text-[15px] truncate leading-tight",children:r.MethodName}),e.jsx("div",{className:"flex items-center gap-1.5 mt-1",children:e.jsx("span",{className:`text-[8px] px-1.5 py-0.5 rounded-md font-black uppercase tracking-tighter ${n===r.MethodName?"bg-white/20 text-white":"bg-blue-500/10 text-blue-400"}`,children:r.RequireDriverSelection?"Driver Selection Req":"Standard Service"})})]})]},r.MethodName)):e.jsx("div",{className:"p-6 text-center text-xs text-gray-500 font-black uppercase tracking-widest",children:"រកមិនឃើញសេវាដឹកជញ្ជូនទេ"})})})]})},ee=({isOpen:t,onClose:n,url:u})=>{const[c,a]=s.useState(!0);return s.useEffect(()=>{t&&a(!0)},[t,u]),t?e.jsxs(q,{isOpen:t,onClose:n,maxWidth:"max-w-4xl",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-white",children:"ស្វែងរកទីតាំង"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:'បន្ទាប់ពីរកឃើញទីតាំងត្រឹមត្រូវ សូមចម្លង (Copy) អាសយដ្ឋាន ឬ Link រួចបិទផ្ទាំងនេះ ហើយបិទភ្ជាប់ (Paste) ចូលទៅក្នុងប្រអប់ "ទីតាំងលម្អិត" វិញ។'}),e.jsxs("div",{className:"relative w-full h-[70vh] bg-gray-900 rounded-lg overflow-hidden border border-gray-700",children:[c&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx(U,{size:"lg"}),e.jsx("span",{className:"ml-3 text-gray-300",children:"កំពុងដំណើរការផែនទី..."})]}),e.jsx("iframe",{src:u,width:"100%",height:"100%",style:{border:0},allowFullScreen:!1,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",onLoad:()=>a(!1),className:c?"opacity-0":"opacity-100 transition-opacity duration-500"})]})]}):null},te=({onClose:t,onCodeScanned:n,scanMode:u,setScanMode:c,productsInOrder:a,masterProducts:i})=>{const d=s.useRef(null),x=s.useRef(null),[m,o]=s.useState(null),[p,r]=s.useState(!0),[g,v]=s.useState(null),[f,k]=s.useState(1),[M,B]=s.useState(null),[N,_]=s.useState(!1),[z,D]=s.useState(!1),[H,l]=s.useState(0),h=s.useCallback(y=>{var $;const C=parseFloat(y.target.value);k(C),($=d.current)!=null&&$.isScanning&&d.current.applyVideoConstraints({advanced:[{zoom:C}]}).catch(O=>console.error("Failed to apply zoom",O))},[]),j=s.useCallback(async()=>{var y;if((y=d.current)!=null&&y.isScanning&&z){const C=!N;try{await d.current.applyVideoConstraints({advanced:[{torch:C}]}),_(C)}catch($){console.error("Failed to toggle torch",$)}}},[N,z]);return s.useEffect(()=>{const y=new window.Html5Qrcode("barcode-reader-container");d.current=y;let C=0;const $=(w,V)=>{var A;const F=Date.now();if(F-C<1e3)return;C=F;const I=i.find(b=>b.Barcode&&b.Barcode.trim()===w.trim());if(I){const b=a.find(E=>E.name===I.ProductName),W=b?b.quantity:0;if(u==="single"&&b)o(`⚠️ ${I.ProductName} (មានរួចហើយ)`);else{const E=u==="increment"?W+1:1;o(`✅ ${I.ProductName} (ចំនួន: ${E})`),l(R=>R+1)}}else o(`❌ រកមិនឃើញ Barcode: ${w}`);n(w);const T=x.current,P=document.querySelector("#barcode-reader-container video");if(T&&P&&((A=V.result)!=null&&A.points)){const b=T.getContext("2d");if(!b)return;T.width=P.clientWidth,T.height=P.clientHeight;const W=P.clientWidth/P.videoWidth,E=P.clientHeight/P.videoHeight;b.clearRect(0,0,T.width,T.height),b.beginPath();const R=V.result.points;b.moveTo(R[0].x*W,R[0].y*E);for(let L=1;L<R.length;L++)b.lineTo(R[L].x*W,R[L].y*E);b.closePath(),b.lineWidth=4,b.strokeStyle="#4ade80",b.fillStyle="rgba(74, 222, 128, 0.3)",b.stroke(),b.fill(),setTimeout(()=>{if(o(null),x.current){const L=x.current.getContext("2d");L==null||L.clearRect(0,0,x.current.width,x.current.height)}},1500)}},O={fps:10,qrbox:{width:250,height:250},supportedScanTypes:[]};return y.start({facingMode:"environment"},O,$,()=>{}).then(()=>{const w=y.getRunningTrackCapabilities();w&&(w.zoom&&(B({min:w.zoom.min,max:w.zoom.max,step:w.zoom.step}),k(w.zoom.min||1)),w.torch&&D(!0)),r(!1)}).catch(w=>{v("មិនអាចបើក Camera បានទេ។"),r(!1)}),()=>{var w;(w=d.current)!=null&&w.isScanning&&d.current.stop().catch(()=>{})}},[n,a,i,u]),e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col p-2 sm:p-4 animate-fade-in",children:[e.jsx("style",{children:`
              #barcode-reader-container { width: 100%; height: 100%; overflow: hidden; }
              #barcode-reader-container video { width: 100% !important; height: 100% !important; object-fit: cover; }
            `}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center text-white mb-2 sm:mb-4",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-bold",children:["Scan Barcode",e.jsxs("span",{className:"text-gray-400 text-base font-normal ml-2",children:["(",H," scanned)"]})]}),e.jsx("button",{onClick:t,className:"p-2 bg-gray-700/50 rounded-full hover:bg-gray-600",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-grow relative flex items-center justify-center min-h-0 w-full max-w-2xl mx-auto",children:[e.jsx("div",{id:"barcode-reader-container",className:"w-full h-full aspect-square bg-gray-900 rounded-lg overflow-hidden"}),e.jsx("canvas",{ref:x,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-0 border-[20px] sm:border-[30px] border-black/50 box-border rounded-lg"}),p&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white",children:[e.jsx(U,{size:"lg"}),e.jsx("p",{className:"mt-4 font-semibold",children:"កំពុងបើក Camera..."})]}),g&&e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white p-4 text-center",children:[e.jsx("p",{className:"font-semibold text-red-400",children:"កំហុស Camera"}),e.jsx("p",{className:"mt-2 text-sm",children:g})]}),m&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-gray-800/80 border border-gray-600 text-white px-4 py-2 rounded-lg font-semibold z-20",children:m})]}),!p&&!g&&e.jsxs("div",{className:"flex-shrink-0 mt-4 space-y-4 w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-4 items-center",children:[e.jsxs("div",{className:"flex justify-center items-center space-x-2 bg-gray-800 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>c("increment"),className:`flex-1 text-sm py-2 px-3 rounded-md transition-colors ${u==="increment"?"bg-blue-600 text-white":"hover:bg-gray-700"}`,children:"បូកចំនួន"}),e.jsx("button",{onClick:()=>c("single"),className:`flex-1 text-sm py-2 px-3 rounded-md transition-colors ${u==="single"?"bg-blue-600 text-white":"hover:bg-gray-700"}`,children:"រាប់មួយ"})]}),e.jsx("div",{className:"flex justify-center",children:z&&e.jsx("button",{onClick:j,className:`p-3 rounded-full transition-colors ${N?"bg-yellow-400 text-gray-900":"bg-gray-700 text-white hover:bg-gray-600"}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2zM5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1z",clipRule:"evenodd"})})})})]}),M&&e.jsx("div",{className:"flex items-center gap-2 sm:gap-4 bg-gray-800 p-2 rounded-lg",children:e.jsx("input",{type:"range",min:M.min,max:M.max,step:M.step,value:f,onChange:h,className:"w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer"})})]})]})},re=({provinces:t,selectedProvince:n,onSelect:u})=>{const[c,a]=s.useState(!1),[i,d]=s.useState(""),x=s.useRef(null);s.useEffect(()=>{d(n)},[n]),s.useEffect(()=>{const o=p=>{x.current&&!x.current.contains(p.target)&&(a(!1),d(n))};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[n]);const m=s.useMemo(()=>{const o=t.filter(f=>f.toLowerCase().includes(i.toLowerCase())),p=o.filter(f=>!f.includes("ភ្នំពេញ")&&!f.includes("កណ្ដាល")).sort((f,k)=>f.localeCompare(k,"km")),r=[],g=o.find(f=>f.includes("ភ្នំពេញ")),v=o.find(f=>f.includes("កណ្ដាល"));return g&&r.push(g),v&&r.push(v),[...r,...p]},[t,i]);return e.jsxs("div",{className:"relative w-full",ref:x,children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"text",className:"form-input !pl-10 !py-3 rounded-xl border-gray-700 bg-gray-900 focus:border-blue-500/50 transition-all font-bold text-gray-200",placeholder:"ស្វែងរក ខេត្ត/រាជធានី...",value:i,onChange:o=>{d(o.target.value),a(!0)},onFocus:()=>a(!0)}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),c&&e.jsx("div",{className:"absolute z-[100] w-full mt-2 bg-gray-800 border border-white/10 rounded-2xl shadow-2xl overflow-hidden animate-fade-in-down max-h-60 overflow-y-auto custom-scrollbar",children:m.length>0?m.map((o,p)=>e.jsx("button",{type:"button",onClick:()=>{u(o),d(o),a(!1)},className:`w-full text-left px-4 py-3 text-sm font-bold transition-colors border-b border-white/5 last:border-0 ${n===o?"bg-blue-600 text-white":"text-gray-300 hover:bg-white/5"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:o}),p<2&&i===""&&e.jsx("span",{className:"text-[8px] bg-white/10 px-1.5 py-0.5 rounded uppercase tracking-widest opacity-50",children:"Priority"})]})},o)):e.jsx("div",{className:"p-4 text-center text-xs text-gray-500",children:"រកមិនឃើញខេត្តនេះទេ"})})]})},se=({schedule:t,time:n,onChange:u})=>{const c=()=>{u({schedule:!t,time:t?"":n})};return e.jsxs("div",{className:`relative overflow-hidden p-6 rounded-[2rem] border transition-all duration-500 ${t?"bg-cyan-500/10 border-cyan-500 shadow-[0_0_25px_rgba(6,182,212,0.15)]":"bg-gray-900/40 border-gray-700"}`,children:[e.jsx("style",{children:`
                /* ប្ដូរពណ៌ និងពង្រីកទំហំ Default Calendar Icon របស់ Browser */
                .cyan-calendar-picker::-webkit-calendar-picker-indicator {
                    cursor: pointer;
                    /* ប្ដូរពណ៌ទៅជា Cyan */
                    filter: invert(56%) sepia(86%) saturate(2256%) hue-rotate(150deg) brightness(98%) contrast(101%);
                    padding: 8px;
                    width: 24px;
                    height: 24px;
                    transform: scale(1.3); /* ពង្រីកឱ្យធំជាងមុន */
                    border-radius: 12px;
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                }
                .cyan-calendar-picker::-webkit-calendar-picker-indicator:hover {
                    background: rgba(6, 182, 212, 0.15);
                    transform: scale(1.45);
                    filter: invert(60%) sepia(90%) saturate(2500%) hue-rotate(160deg) brightness(110%) contrast(110%);
                }
                .cyan-calendar-picker::-webkit-calendar-picker-indicator:active {
                    transform: scale(1.2);
                }
            `}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center transition-all duration-500 ${t?"bg-cyan-500 text-white shadow-lg shadow-cyan-500/30":"bg-gray-800 text-gray-500"}`,children:e.jsx("svg",{className:"w-7 h-7",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-sm font-black uppercase tracking-widest transition-colors ${t?"text-cyan-400":"text-gray-400"}`,children:"កំណត់ពេល Telegram"}),e.jsx("p",{className:"text-[10px] text-gray-500 font-bold uppercase opacity-60",children:"Auto-Send Schedule"})]})]}),e.jsx("button",{type:"button",onClick:c,className:`relative inline-flex h-7 w-12 items-center rounded-full transition-colors focus:outline-none ${t?"bg-cyan-500":"bg-gray-700"}`,children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white shadow-md transition-transform duration-300 ease-in-out ${t?"translate-x-6":"translate-x-1"}`})})]}),t&&e.jsxs("div",{className:"animate-fade-in-down pt-6 mt-4 border-t border-cyan-500/10",children:[e.jsx("div",{className:"relative group",children:e.jsx("input",{type:"datetime-local",value:n||"",onChange:a=>u({schedule:t,time:a.target.value}),onClick:a=>{try{"showPicker"in HTMLInputElement.prototype&&a.currentTarget.showPicker()}catch{}},className:"cyan-calendar-picker form-input !py-4 !pl-5 !pr-14 bg-black/40 border-cyan-500/20 text-white font-mono font-bold rounded-2xl focus:border-cyan-500 focus:ring-4 focus:ring-cyan-500/10 transition-all text-sm w-full cursor-pointer",min:new Date().toISOString().slice(0,16)})}),e.jsx("p",{className:"text-[9px] text-cyan-400/60 font-black uppercase tracking-widest text-center mt-3",children:"សារនឹងត្រូវផ្ញើដោយស្វ័យប្រវត្តិតាមម៉ោងកំណត់"})]}),e.jsx("div",{className:`absolute -right-6 -bottom-6 w-24 h-24 bg-cyan-500 transition-opacity duration-700 rounded-full blur-[40px] pointer-events-none ${t?"opacity-10":"opacity-0"}`})]})};export{te as B,ee as M,G as P,K as S,se as T,J as a,X as b,re as c};
