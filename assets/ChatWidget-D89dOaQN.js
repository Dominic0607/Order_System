import{r as n,j as t,S as je,A as Fe,d as be,N as we,W as U,c as Pe,R as _e,f as We}from"./index-VW_UuUSv.js";import{c as ze}from"./imageCompressor-D5vYYzIg.js";import{U as ce}from"./UserAvatar-BYsNENP0.js";import{r as ye,s as Ne}from"./notificationUtils-Daxn_erD.js";import{a as G}from"./dateUtils-MJGiVJEs.js";const Be=["audio/mp4","audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg"],Oe=()=>{const[h,j]=n.useState(!1),l=n.useRef(null),x=n.useRef([]),k=n.useRef("audio/webm");return{isRecording:h,startRecording:async()=>{if(!h)try{const d=await navigator.mediaDevices.getUserMedia({audio:!0}),p=Be.find(w=>MediaRecorder.isTypeSupported(w));if(!p){alert("Your browser does not support any of the required audio recording formats."),console.error("No supported audio MIME types found.");return}k.current=p,console.log(`Using MIME type for recording: ${p}`),l.current=new MediaRecorder(d,{mimeType:p}),x.current=[],l.current.ondataavailable=w=>{x.current.push(w.data)},l.current.onstop=()=>{d.getTracks().forEach(w=>w.stop())},l.current.start(),j(!0)}catch(d){console.error("Error starting audio recording:",d),d instanceof DOMException&&(d.name==="NotAllowedError"||d.name==="PermissionDeniedError")?alert("áž€áž¶ážšáž¢áž“áž»áž‰áŸ’áž‰áž¶ážáž±áŸ’áž™áž”áŸ’ážšáž¾áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“ážáŸ’ážšáž¼ážœáž”áž¶áž“áž”ážŠáž·ážŸáŸáž’áŸ” ážŸáž¼áž˜áž¢áž“áž»áž‰áŸ’áž‰áž¶ážáž±áŸ’áž™áž…áž¼áž›áž”áŸ’ážšáž¾áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“áž“áŸ…áž€áŸ’áž“áž»áž„áž€áž¶ážšáž€áŸ†ážŽážáŸ‹áž€áž˜áŸ’áž˜ážœáž·áž’áž¸ážšáž»áž€ážšáž€ážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€ ážŠáž¾áž˜áŸ’áž”áž¸áž”áŸ’ážšáž¾áž˜áž»ážáž„áž¶ážšáž“áŸáŸ‡áŸ”"):alert("áž˜áž·áž“áž¢áž¶áž…áž…áž¶áž”áŸ‹áž•áŸ’ážáž¾áž˜áž€áž¶ážšážážážŸáŸ†áž¡áŸáž„áž”áž¶áž“áž‘áŸáŸ” ážŸáž¼áž˜áž”áŸ’ážšáž¶áž€ážŠážáž¶áž¢áŸ’áž“áž€áž”áž¶áž“áž—áŸ’áž‡áž¶áž”áŸ‹áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“ áž áž¾áž™áž”áž¶áž“áž•áŸ’ážáž›áŸ‹áž€áž¶ážšáž¢áž“áž»áž‰áŸ’áž‰áž¶ážáŸ”")}},stopRecording:()=>new Promise(d=>{if(!l.current||!h){d(null);return}l.current.onstop=()=>{const p=new Blob(x.current,{type:k.current});l.current&&l.current.stream.getTracks().forEach(w=>w.stop()),d(p)},l.current.stop(),j(!1)})}},He=({src:h,isMe:j=!1})=>{const l=n.useRef(null),[x,k]=n.useState(!1),[S,L]=n.useState(0),[d,p]=n.useState(0),[w,D]=n.useState(!1),[F,A]=n.useState(null);n.useEffect(()=>()=>{const i=l.current;i&&(i.pause(),i.removeAttribute("src"),i.load())},[]);const E=i=>{const f=()=>{i.duration&&isFinite(i.duration)&&(L(i.duration),D(!0),A(null))},y=()=>p(i.currentTime),z=()=>{k(!1),p(0)},X=()=>{console.error("Audio Error",i.error),A("Unavailable"),D(!1)};i.onloadedmetadata=f,i.oncanplay=f,i.ontimeupdate=y,i.onended=z,i.onerror=X},M=()=>{const i=l.current;if(i){if(!w&&!x&&!F){E(i),document.querySelectorAll("audio").forEach(f=>{f!==i&&f.pause()}),i.play().then(()=>{k(!0),D(!0)}).catch(f=>{console.error("Play failed",f),A("Unavailable")});return}x?(i.pause(),k(!1)):(document.querySelectorAll("audio").forEach(f=>{f!==i&&f.pause()}),i.play().catch(f=>console.error("Play failed",f)),k(!0))}},v=i=>{const f=parseFloat(i.target.value);l.current&&(l.current.currentTime=f,p(f))},R=i=>{if(!isFinite(i)||i<0)return"0:00";const f=Math.floor(i/60),y=Math.floor(i%60);return`${f}:${y<10?"0":""}${y}`};return F?t.jsx("div",{className:"text-[10px] text-red-300 bg-red-900/20 px-2 py-1 rounded",children:"Audio Unavailable"}):t.jsxs("div",{className:`flex items-center gap-3 pr-4 pl-1 py-1 rounded-full min-w-[220px] transition-all ${j?"text-blue-100":"text-gray-600 dark:text-gray-300"}`,children:[t.jsx("audio",{ref:l,src:h,preload:"metadata"}),t.jsx("button",{onClick:M,disabled:!w,className:`w-9 h-9 flex items-center justify-center rounded-full shadow-md transition-all active:scale-95 flex-shrink-0 ${j?"bg-white text-blue-600 hover:bg-gray-100":"bg-blue-600 text-white hover:bg-blue-500"}`,children:w?x?t.jsx("svg",{className:"w-3.5 h-3.5 fill-current",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):t.jsx("svg",{className:"w-3.5 h-3.5 fill-current ml-0.5",viewBox:"0 0 24 24",children:t.jsx("path",{d:"M8 5v14l11-7z"})}):t.jsx(je,{size:"sm"})}),t.jsxs("div",{className:"flex flex-col flex-grow justify-center gap-1 min-w-[120px]",children:[t.jsx("input",{type:"range",min:"0",max:S||100,value:d,onChange:v,className:`w-full h-1.5 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-0 ${j?"bg-blue-800/30 accent-white":"bg-gray-300 dark:bg-gray-600 accent-blue-600"}`}),t.jsxs("div",{className:"flex justify-between w-full text-[10px] font-mono font-medium opacity-90 px-0.5",children:[t.jsx("span",{children:R(d)}),t.jsx("span",{children:R(S)})]})]})]})},Ve=({users:h,loading:j,onRefresh:l})=>j?t.jsxs("div",{className:"flex flex-col items-center justify-center py-10 space-y-3",children:[t.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Loading members..."})]}):!h||h.length===0?t.jsxs("div",{className:"text-center text-gray-500 py-10 flex flex-col items-center",children:[t.jsx("p",{className:"text-xs uppercase tracking-widest mb-2",children:"(No members found)"}),t.jsx("button",{onClick:l,className:"text-[10px] text-blue-400 hover:text-white underline",children:"Retry Loading"})]}):t.jsx("div",{className:"p-4 space-y-3 animate-fade-in",children:h.map(x=>t.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-gray-800/40 border border-white/5 hover:bg-gray-800 transition-colors cursor-default group",children:[t.jsx(ce,{avatarUrl:x.ProfilePictureURL,name:x.FullName,size:"md",className:"ring-2 ring-blue-500/20 group-hover:ring-blue-500/50 transition-all"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-black text-white",children:x.FullName}),t.jsxs("p",{className:"text-[10px] text-gray-500 font-mono uppercase tracking-wider",children:["@",x.UserName]})]}),t.jsx("div",{className:"ml-auto flex flex-col items-end gap-1",children:t.jsx("div",{className:`w-2 h-2 rounded-full ${x.IsSystemAdmin?"bg-yellow-500 shadow-[0_0_5px_#eab308]":"bg-blue-500 shadow-[0_0_5px_#3b82f6]"}`})})]},x.UserName))}),Ye=_e.memo(He),Xe=({isOpen:h,onClose:j})=>{const{currentUser:l,appData:x,previewImage:k,setUnreadCount:S,showNotification:L,advancedSettings:d}=n.useContext(Fe),p=n.useMemo(()=>l?`chatHistoryCache_${l.UserName}`:null,[l]),{isRecording:w,startRecording:D,stopRecording:F}=Oe(),[A,E]=n.useState(0),M=n.useRef(null),v=n.useRef(null),R=n.useRef(null);n.useEffect(()=>{v.current=new Audio(be.NOTIFICATION),R.current=new Audio(be.SENT)},[]);const[i,f]=n.useState(()=>{if(!p)return[];try{const e=localStorage.getItem(p);return e&&e!=="undefined"?JSON.parse(e):[]}catch{return[]}}),[y,z]=n.useState([]),[X,Z]=n.useState(!1),[P,B]=n.useState(""),[ve,de]=n.useState(!1),[ue,ee]=n.useState(!1),[$,ke]=n.useState(()=>localStorage.getItem("chatMuted")==="true"),[te,fe]=n.useState(!1),[Se,se]=n.useState("disconnected"),[T,me]=n.useState("chat"),[Re,Ce]=n.useState(!1),[O,he]=n.useState(""),[Ee,re]=n.useState(!1),xe=n.useRef(null),ae=n.useRef(null),H=n.useRef(null),ne=n.useRef(null),_=n.useRef(h),pe=n.useRef(y),oe=n.useRef(l),ie=n.useRef($),I=n.useRef(null);n.useEffect(()=>{const e=(d==null?void 0:d.notificationSound)||"default",s=we.find(o=>o.id===e)||we[0],r=(d==null?void 0:d.notificationVolume)??1;v.current&&(v.current.src=s.url,v.current.volume=r),R.current&&(R.current.volume=r)},[d==null?void 0:d.notificationSound,d==null?void 0:d.notificationVolume]),n.useEffect(()=>{pe.current=y},[y]),n.useEffect(()=>{oe.current=l},[l]),n.useEffect(()=>{ie.current=$},[$]),n.useEffect(()=>{_.current=h},[h]),n.useEffect(()=>{if(i.length>0&&!I.current){const e=[...i].sort((s,r)=>G(s.timestamp)-G(r.timestamp));I.current=e[e.length-1].id}},[]);const le=n.useCallback(async()=>{if(x.users&&x.users.length>0){z(x.users),Z(!1);return}Z(!0);try{const s=await(await fetch(`${U}/api/users`)).json();s.status==="success"&&Array.isArray(s.data)&&z(s.data)}catch(e){console.warn("Fallback user fetch failed",e)}finally{Z(!1)}},[x.users]);n.useEffect(()=>{le()},[le]),n.useEffect(()=>{h&&S(0)},[h,S]),n.useEffect(()=>{ye()},[]);const Me=async()=>{await D(),E(0),M.current=setInterval(()=>{E(e=>e+1)},1e3)},Te=async()=>{await F(),M.current&&clearInterval(M.current),E(0)},Ie=async()=>{M.current&&clearInterval(M.current),ee(!0);try{const e=await F();if(!e)throw new Error("No audio captured");const s=new FileReader;s.readAsDataURL(e),s.onloadend=async()=>{const o=s.result.split(",")[1];try{const a=await fetch(`${U}/api/upload-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileData:o,fileName:`voice_${Date.now()}.webm`,mimeType:"audio/webm",userName:(l==null?void 0:l.UserName)||"unknown"})}),c=await a.json();if(!a.ok||c.status!=="success")throw new Error(c.message||"Audio upload failed");let u=c.fileId||c.id;if(!u&&c.url){const g=c.url.match(/(?:d\/|id=)([^/?&]+)/);g&&g[1]&&(u=g[1])}if(!u)throw console.error("Could not determine FileID from upload result:",c),new Error("Failed to get File ID");const N=ge(A);await K(N,"audio",u)}catch(a){console.error("Audio Upload Workflow Failed",a),alert("áž€áž¶ážšáž”áž‰áŸ’áž‡áž¼áž“ážŸáž˜áŸ’áž›áŸáž„áž”ážšáž¶áž‡áŸáž™ (Failed to upload audio).")}finally{ee(!1),E(0)}}}catch(e){console.error("Recording Error",e),ee(!1),E(0)}},ge=e=>{const s=Math.floor(e/60),r=e%60;return`${s}:${r<10?"0":""}${r}`},V=n.useCallback(e=>{f(s=>{const r=typeof e=="function"?e(s):e;return p&&localStorage.setItem(p,JSON.stringify(r)),r})},[p]),Y=n.useCallback(e=>{const s=pe.current.find(a=>a.UserName===e.UserName),r=(e.MessageType||"text").toLowerCase();let o=e.Content;return r==="audio"&&e.FileID?o=`${U}/api/chat/audio/${e.FileID}`:r==="image"&&(o=Pe(e.Content)),{id:e.Timestamp,user:e.UserName,fullName:(s==null?void 0:s.FullName)||e.UserName,avatar:(s==null?void 0:s.ProfilePictureURL)||"",content:o,timestamp:e.Timestamp,type:r,fileID:e.FileID,isOptimistic:!1}},[]),J=n.useCallback(e=>{if(e.length===0)return;const s=I.current;let r=[];if(!s){I.current=e[e.length-1].id;return}const o=e.findIndex(a=>a.id===s);o!==-1?r=e.slice(o+1):r=e.filter(a=>a.id>s),r.forEach(a=>{var g;if(a.user===((g=oe.current)==null?void 0:g.UserName))return;const u=a.content&&a.content.includes("ðŸ“¢ NEW ORDER:"),N=a.content&&a.content.includes("ðŸ“¢ SYSTEM_ALERT:");if(u||N){let m=a.content;u?m=a.content.replace("ðŸ“¢ NEW ORDER:","").trim():N&&(m=a.content.replace("ðŸ“¢ SYSTEM_ALERT:","").trim()),L(m,"success"),ie.current||(v.current.currentTime=0,v.current.play().catch(b=>console.warn("Audio play failed",b))),Ne("áž€áž¶ážšáž€áž˜áŸ’áž˜áž„áŸ‹ážáŸ’áž˜áž¸ ðŸ“¦",m)}else{const m=a.fullName||a.user;let b=a.content;a.type==="image"?b="ðŸ“· Sent an image":a.type==="audio"&&(b="ðŸŽ¤ Sent a voice message"),L(`${m}: ${b}`,"info"),(document.hidden||!_.current)&&(Ne(m,b),_.current||S(Q=>Q+1)),ie.current||(v.current.currentTime=0,v.current.play().catch(()=>{}))}}),r.length>0&&(I.current=r[r.length-1].id)},[L,S]),W=n.useCallback(async()=>{i.length===0&&_.current&&fe(!0);try{const e=await fetch(`${U}/api/chat/messages`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();if(s.status==="success"){const o=s.data.map(Y).sort((a,c)=>G(a.timestamp)-G(c.timestamp));J(o),V(a=>{if(a.length===o.length&&a.length>0){const c=a[a.length-1],u=o[o.length-1];if(c.id===u.id)return a}return o})}}catch{console.warn("Chat history service unavailable")}finally{fe(!1)}},[Y,V,i.length,J]),q=(e="smooth")=>{ae.current&&ae.current.scrollIntoView({behavior:e})};n.useEffect(()=>{const e=window.location.protocol==="https:"?"wss":"ws",s=U.replace(/^https?:\/\//,""),r=`${e}://${s}/api/chat/ws`,o=()=>{var c;if(((c=ne.current)==null?void 0:c.readyState)===WebSocket.OPEN)return;se("connecting");const a=new WebSocket(r);ne.current=a,a.onopen=()=>{se("connected"),W()},a.onclose=()=>{se("disconnected"),setTimeout(o,3e3)},a.onmessage=u=>{try{const N=JSON.parse(u.data);if(N.action==="new_message"){const g=N.payload,m=Y(g);I.current&&m.id<=I.current||J([m]),V(b=>{if(b.some(C=>C.id===m.id))return b;const Q=b.findIndex(C=>C.isOptimistic&&C.user===m.user&&C.type===m.type);if(Q!==-1){const C=[...b];return C[Q]=m,C}return[...b,m]}),_.current&&setTimeout(()=>q("smooth"),100)}}catch(N){console.error("WS Message Error",N)}}};return o(),()=>{var a;(a=ne.current)==null||a.close()}},[J,Y,V]),n.useEffect(()=>{h&&W()},[h,W]),n.useEffect(()=>{const e=setInterval(()=>{W()},3e3);return()=>clearInterval(e)},[W]),n.useEffect(()=>{if(!h||T!=="chat"||te)return;const e=H.current;if(e){const{scrollTop:s,scrollHeight:r,clientHeight:o}=e,a=r-s-o<250,c=i[i.length-1],u=(c==null?void 0:c.user)===(l==null?void 0:l.UserName);(u||c!=null&&c.isOptimistic||a||s===0)&&q(s===0&&!u?"auto":"smooth")}else q("auto")},[i,h,T,te]);const K=async(e,s,r)=>{if(!e&&s==="text")return;const o=oe.current;if(!o){alert("Please login to send messages.");return}const a=Date.now().toString();let c=e;s==="image"&&!e.startsWith("http")&&!e.startsWith("data:")&&(c=`data:image/jpeg;base64,${e}`);const u={id:a,user:o.UserName||"Unknown",fullName:o.FullName||"Me",avatar:o.ProfilePictureURL||"",content:c,timestamp:new Date().toISOString(),type:s,fileID:r,isOptimistic:!0};f(g=>[...g,u]),s==="text"&&B("");const N=s.charAt(0).toUpperCase()+s.slice(1);try{const g={userName:o.UserName,UserName:o.UserName,type:N,MessageType:N,content:e.trim(),Content:e.trim()};r&&(g.FileID=r,g.fileId=r);const m=await fetch(`${U}/api/chat/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!m.ok){const b=await m.text();throw new Error(`Server returned ${m.status}: ${b}`)}$||(R.current.currentTime=0,R.current.play().catch(()=>{}))}catch(g){console.error("Send Error:",g),f(m=>m.filter(b=>b.id!==a)),s==="text"&&B(e),alert("áž€áž¶ážšáž”áž‰áŸ’áž‡áž¼áž“ážŸáž¶ážšáž”ážšáž¶áž‡áŸáž™ (Send Failed). Please try again.")}},Ue=async e=>{de(!0);try{const s=await ze(e),r=await We(s),o=await fetch(`${U}/api/upload-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileData:r,fileName:`img_${Date.now()}.jpg`,mimeType:"image/jpeg",userName:(l==null?void 0:l.UserName)||"unknown"})}),a=await o.json();if(!o.ok||a.status!=="success")throw new Error(a.message||"Image upload failed");let c=a.fileId||a.id;if(!c&&a.url){const u=a.url.match(/(?:d\/|id=)([^/?&]+)/);u&&u[1]&&(c=u[1])}if(!c)throw new Error("Failed to get File ID");await K(a.url,"image",c)}catch(s){console.error("Image Upload Error:",s),alert("áž€áž¶ážšáž”áž‰áŸ’áž‡áž¼áž“ážšáž¼áž”áž—áž¶áž–áž”ážšáž¶áž‡áŸáž™ (Failed to upload image).")}finally{de(!1)}},Le=e=>{const s=e.target.value;B(s);const r=s.split(/[\s\n]+/).pop();r&&r.startsWith("@")?(he(r.slice(1)),re(!0)):re(!1)},Ae=e=>{const s=P.split(/([\s\n]+)/),r=s.length-1;s[r]=`@${e} `,B(s.join("")),re(!1),he("");const o=document.querySelector(".chat-input-area textarea");o&&o.focus()},$e=e=>e.split(/(@[\w\u1780-\u17FF]+)/g).map((r,o)=>{if(r.startsWith("@")){const a=r.slice(1);if(y.some(u=>u.UserName===a||u.FullName===a)||r.length>2)return t.jsx("span",{className:"text-blue-300 font-bold bg-blue-500/20 px-1 rounded-md mx-0.5",children:r},o)}return t.jsx("span",{children:r},o)}),De=()=>{if(H.current){const{scrollTop:e,scrollHeight:s,clientHeight:r}=H.current,o=s-e-r<200;Ce(!o)}};return t.jsxs("div",{className:`chat-widget-container ${h?"":"closed"}`,children:[t.jsxs("div",{className:"chat-header",children:[t.jsxs("div",{className:"title-group flex items-center gap-2",children:[t.jsx("div",{className:`connection-status w-3 h-3 rounded-full ${Se==="connected"?"bg-green-500 shadow-[0_0_10px_#22c55e]":"bg-yellow-500 animate-pulse"}`}),t.jsx("h3",{className:"font-black text-white uppercase tracking-wider text-sm",children:"Team Chat"})]}),t.jsxs("div",{className:"controls flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{const e=!$;ke(e),localStorage.setItem("chatMuted",String(e)),e||ye().then(s=>{s&&console.log("Notification permission granted via toggle")})},className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:$?"ðŸ”‡":"ðŸ””"}),t.jsx("button",{onClick:j,className:"p-2 hover:bg-red-500/20 hover:text-red-400 rounded-full transition-colors text-gray-400",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),t.jsxs("div",{className:"chat-tabs bg-gray-900/50 p-1",children:[t.jsx("button",{onClick:()=>me("chat"),className:`text-xs font-bold uppercase tracking-wider transition-all ${T==="chat"?"active bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:"Chat Stream"}),t.jsx("button",{onClick:()=>me("users"),className:`text-xs font-bold uppercase tracking-wider transition-all ${T==="users"?"active bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:"Members"})]}),t.jsx("div",{className:"chat-body custom-scrollbar bg-[#0f172a] relative",ref:H,onScroll:De,children:T==="chat"?t.jsxs("div",{className:"chat-messages p-4 space-y-6 min-h-full pb-20",children:[te?t.jsxs("div",{className:"flex flex-col items-center justify-center py-10 space-y-3",children:[t.jsx(je,{size:"md"}),t.jsx("span",{className:"text-xs text-gray-500",children:"Loading history..."})]}):i.length===0?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center opacity-50",children:[t.jsx("svg",{className:"w-16 h-16 text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),t.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-gray-500",children:"No messages yet"}),t.jsx("p",{className:"text-[10px] text-gray-600 mt-1",children:"Start the conversation!"})]}):i.map((e,s)=>{const r=e.user===(l==null?void 0:l.UserName),o=y.find(u=>u.UserName===e.user),a=s===0||i[s-1].user!==e.user,c=e.content.includes("SYSTEM_ALERT")||e.content.includes("NEW ORDER");return t.jsx("div",{className:`flex flex-col ${r?"items-end":"items-start"} animate-fade-in-up`,children:c?t.jsx("div",{className:"w-full flex justify-center my-2",children:t.jsx("div",{className:"bg-blue-900/40 border border-blue-500/30 rounded-xl px-4 py-2 text-[10px] font-bold text-blue-300 text-center shadow-lg",children:e.content.replace("ðŸ“¢ SYSTEM_ALERT:","").replace("ðŸ“¢ NEW ORDER:","").trim()})}):t.jsxs("div",{className:`flex max-w-[85%] gap-3 ${r?"flex-row-reverse":""}`,children:[t.jsx("div",{className:"flex-shrink-0 w-8 flex flex-col justify-end",children:a?t.jsx(ce,{avatarUrl:(o==null?void 0:o.ProfilePictureURL)||e.avatar,name:(o==null?void 0:o.FullName)||e.fullName,size:"sm",className:"ring-2 ring-white/10"}):t.jsx("div",{className:"w-8"})}),t.jsxs("div",{className:`relative px-4 py-3 shadow-lg ${r?"bg-blue-600 text-white rounded-2xl rounded-tr-sm":"bg-gray-800 text-gray-200 rounded-2xl rounded-tl-sm border border-white/5"} ${e.isOptimistic?"opacity-70":""}`,children:[!r&&a&&t.jsx("p",{className:"text-[10px] font-black text-blue-400 mb-1 uppercase tracking-wider",children:(o==null?void 0:o.FullName)||e.fullName}),e.type==="text"&&t.jsx("p",{className:"leading-relaxed text-sm whitespace-pre-wrap",children:$e(e.content)}),e.type==="image"&&t.jsx("img",{src:e.content,className:"rounded-xl max-w-full cursor-pointer hover:opacity-90 transition-opacity border border-black/20",onClick:()=>k(e.content),alt:"attachment"}),e.type==="audio"&&t.jsx(Ye,{src:e.content,isMe:r}),t.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1.5",children:[t.jsx("p",{className:`text-[9px] font-medium ${r?"text-blue-200":"text-gray-500"}`,children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.isOptimistic&&t.jsxs("svg",{className:"w-3 h-3 text-white/50 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]})]})},e.id+s)}),t.jsx("div",{ref:ae})]}):t.jsx(Ve,{users:y,loading:X,onRefresh:le})}),T==="chat"&&Re&&t.jsx("button",{onClick:()=>q("smooth"),className:"absolute bottom-24 right-6 p-3 bg-blue-600 text-white rounded-full shadow-lg shadow-blue-900/50 hover:bg-blue-500 transition-all animate-bounce z-50 flex items-center justify-center w-10 h-10 border border-blue-400/30",title:"Scroll to bottom",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})}),T==="chat"&&t.jsxs("div",{className:"p-3 bg-gray-900 border-t border-gray-800 relative z-20",children:[Ee&&t.jsxs("div",{className:"absolute bottom-full left-4 mb-2 bg-gray-800 border border-gray-700 rounded-xl shadow-xl w-64 max-h-60 overflow-y-auto custom-scrollbar z-50 animate-fade-in-up flex flex-col",children:[t.jsx("div",{className:"p-2 sticky top-0 bg-gray-800/95 backdrop-blur border-b border-gray-700 z-10",children:t.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500",children:"Suggested Members"})}),y.filter(e=>{var s,r;return(((s=e.FullName)==null?void 0:s.toLowerCase().includes(O.toLowerCase()))||((r=e.UserName)==null?void 0:r.toLowerCase().includes(O.toLowerCase())))&&e.UserName!==(l==null?void 0:l.UserName)}).slice(0,10).map(e=>t.jsxs("button",{onClick:()=>Ae(e.UserName),className:"w-full flex items-center gap-3 p-2 hover:bg-white/5 transition-colors text-left group border-b border-gray-700/50 last:border-0",children:[t.jsx(ce,{name:e.FullName,avatarUrl:e.ProfilePictureURL,size:"sm",className:"ring-1 ring-white/10"}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("p",{className:"text-sm font-bold text-gray-200 group-hover:text-blue-400 truncate",children:e.FullName}),t.jsxs("p",{className:"text-[10px] text-gray-500 truncate",children:["@",e.UserName]})]})]},e.UserID)),y.filter(e=>{var s,r;return((s=e.FullName)==null?void 0:s.toLowerCase().includes(O.toLowerCase()))||((r=e.UserName)==null?void 0:r.toLowerCase().includes(O.toLowerCase()))}).length===0&&t.jsx("div",{className:"p-4 text-center text-gray-500 text-[10px] uppercase tracking-wider",children:"No matching members"})]}),w?t.jsxs("div",{className:"flex items-center gap-3 bg-gray-800 p-2 rounded-2xl border border-red-500/50 shadow-[0_0_15px_rgba(239,68,68,0.2)] animate-fade-in relative overflow-hidden h-[60px]",children:[t.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none gap-1 px-10",children:[...Array(20)].map((e,s)=>t.jsx("div",{className:"w-1 bg-red-500 rounded-full animate-pulse",style:{height:`${30+Math.random()*50}%`,animationDuration:`${.6+Math.random()*.4}s`,animationDelay:`${Math.random()*.5}s`}},s))}),t.jsxs("div",{className:"flex-shrink-0 w-10 h-10 flex items-center justify-center bg-red-500/10 rounded-full relative z-10 ml-1",children:[t.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-[ping_1.5s_cubic-bezier(0,0,0.2,1)_infinite]"}),t.jsx("div",{className:"absolute w-2 h-2 bg-red-500 rounded-full"})]}),t.jsxs("div",{className:"flex-grow flex flex-col justify-center relative z-10",children:[t.jsx("p",{className:"text-white font-black text-lg font-mono tracking-widest leading-none",children:ge(A)}),t.jsx("p",{className:"text-[9px] text-red-400 font-bold uppercase tracking-widest mt-0.5",children:"Recording..."})]}),t.jsxs("div",{className:"flex gap-2 relative z-10 mr-1",children:[t.jsx("button",{onClick:Te,className:"p-2.5 text-gray-400 hover:text-red-400 hover:bg-red-500/10 rounded-full transition-all active:scale-90",title:"Cancel",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),t.jsx("button",{onClick:Ie,className:"p-2.5 bg-blue-600 text-white rounded-full shadow-lg shadow-blue-600/30 hover:bg-blue-500 transition-all active:scale-90 hover:scale-105",title:"Send",children:t.jsx("svg",{className:"w-5 h-5 ml-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})})})]})]}):t.jsxs("div",{className:"flex items-end gap-2 relative",children:[t.jsx("button",{onClick:()=>{var e;return(e=xe.current)==null?void 0:e.click()},className:"p-3 text-gray-400 hover:text-blue-400 hover:bg-gray-800 rounded-xl transition-all flex-shrink-0 h-[44px] w-[44px] flex items-center justify-center",title:"Attach Image",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h14a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),t.jsx("input",{type:"file",ref:xe,className:"hidden",accept:"image/*",onChange:e=>e.target.files&&Ue(e.target.files[0])}),t.jsx("div",{className:"flex-grow relative",children:t.jsx("textarea",{value:P,onChange:Le,onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),K(P,"text"))},placeholder:"Type a message...",className:"w-full bg-gray-800 text-white rounded-2xl py-3 pl-4 pr-10 border-transparent focus:border-blue-500 focus:ring-0 resize-none text-sm custom-scrollbar",rows:1,style:{minHeight:"44px",maxHeight:"100px"}})}),P.trim()?t.jsx("button",{onClick:()=>K(P,"text"),className:"p-3 bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-600/20 active:scale-95 transition-all hover:bg-blue-500 flex-shrink-0 h-[44px] w-[44px] flex items-center justify-center",children:t.jsx("svg",{className:"w-5 h-5 transform rotate-90",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})}):t.jsx("button",{onClick:Me,disabled:ue,className:"p-3 bg-gray-800 text-white rounded-xl border border-gray-700 hover:bg-red-500/10 hover:border-red-500/50 hover:text-red-500 transition-all active:scale-95 group flex-shrink-0 h-[44px] w-[44px] flex items-center justify-center",children:t.jsx("svg",{className:"w-5 h-5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})})]}),(ve||ue)&&t.jsx("div",{className:"absolute inset-x-0 bottom-full bg-blue-600/90 text-white text-[10px] font-black uppercase tracking-widest text-center py-1",children:"Processing Transfer..."})]})]})};export{Xe as default};
