import{r as l,j as e,S as k,W as v}from"./index-DUoQ3Hz2.js";import B from"./html2canvas.esm-QH1iLAAe.js";const M=({orderIds:p,storeName:u})=>{const[c,C]=l.useState([]),[S,h]=l.useState(!0),[d,b]=l.useState({}),[I,g]=l.useState(!1),[f,j]=l.useState(!1),[O,L]=l.useState(!1),[o,x]=l.useState("idle");l.useEffect(()=>{const t=new URLSearchParams(window.location.search),s=parseInt(t.get("expires")||"0");if(s&&Date.now()>s){L(!0),h(!1);return}(async()=>{try{const m=await(await fetch(`${v}/api/admin/all-orders?days=30`)).json();if(m.status==="success"){const n=new Set(p),N=m.data.filter(a=>a&&n.has(a["Order ID"])).map(a=>({...a,Products:a["Products (JSON)"]?JSON.parse(a["Products (JSON)"]):[],"Internal Cost":Number(a["Internal Cost"])||0}));C(N);const y={};N.forEach(a=>{y[a["Order ID"]]=a["Internal Cost"]}),b(y)}}catch(i){console.error(i)}finally{h(!1)}})()},[p]);const D=(t,s)=>{const r=parseFloat(s);b(i=>({...i,[t]:isNaN(r)?0:r}))},E=async()=>{j(!0);try{const t=c.map(s=>fetch(`${v}/api/admin/update-row`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sheetName:"Orders",primaryKey:{"Order ID":s["Order ID"]},newData:{"Internal Cost":d[s["Order ID"]]}})}));await Promise.all(t),g(!0)}catch{alert("Submission failed")}finally{j(!1)}},w=l.useMemo(()=>Object.values(d).reduce((t,s)=>t+s,0),[d]),P=async()=>{const t=document.getElementById("summary-card");if(t)try{const s=await B(t,{backgroundColor:"#0f172a",scale:2,logging:!1,useCORS:!0});s.toBlob(async r=>{if(r)try{const i=[new ClipboardItem({[r.type]:r})];await navigator.clipboard.write(i),x("success"),setTimeout(()=>x("idle"),3e3)}catch(i){console.error("Clipboard write failed",i);const m=s.toDataURL("image/jpeg"),n=document.createElement("a");n.download="delivery_confirmation.jpg",n.href=m,n.click(),x("error"),setTimeout(()=>x("idle"),3e3)}},"image/png")}catch(s){console.error("Canvas failed",s)}};return S?e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-950",children:e.jsx(k,{size:"lg"})}):O?e.jsxs("div",{className:"min-h-screen bg-[#020617] flex flex-col items-center justify-center p-6 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-red-500/10 rounded-full flex items-center justify-center mb-6 border border-red-500/20",children:e.jsx("svg",{className:"w-12 h-12 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h2",{className:"text-2xl font-black text-white uppercase italic tracking-tighter",children:"Link áž áž½ážŸážŸáž»áž–áž›áž—áž¶áž– (Link Expired)"}),e.jsx("p",{className:"text-gray-500 mt-2 max-w-xs leading-relaxed",children:"Link áž“áŸáŸ‡áž˜áž¶áž“ážŸáž»áž–áž›áž—áž¶áž–ážáŸ’ážšáž¹áž˜ážáŸ‚ áŸ¢ áž˜áŸ‰áŸ„áž„áž”áŸ‰áž»ážŽáŸ’ážŽáŸ„áŸ‡áŸ” ážŸáž¼áž˜áž‘áž¶áž€áŸ‹áž‘áž„áž€áŸ’ážšáž»áž˜áž áŸŠáž»áž“ážŠáž¾áž˜áŸ’áž”áž¸áž•áŸ’áž‰áž¾ Link ážáŸ’áž˜áž¸áŸ”"})]}):I?e.jsxs("div",{className:"min-h-screen bg-[#020617] p-6 flex flex-col items-center justify-center animate-fade-in",children:[e.jsxs("div",{id:"summary-card",className:"bg-gray-900 border-2 border-emerald-500/30 p-8 rounded-[3rem] w-full max-w-md shadow-2xl text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto border-2 border-emerald-500/20",children:e.jsx("svg",{className:"w-10 h-10 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-tight",children:"áž”áž‰áŸ’áž‡áž¶áž€áŸ‹ážáŸ’áž›áŸƒážŠáž¹áž€ážŸážšáž»áž” (Confirmation)"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1 uppercase tracking-widest font-bold",children:u})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-black/40 p-5 rounded-[2rem] border border-white/5 shadow-inner",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest mb-1",children:"áž…áŸ†áž“áž½áž“áž€áž‰áŸ’áž…áž”áŸ‹ (Count)"}),e.jsx("p",{className:"text-3xl font-black text-white",children:c.length})]}),e.jsxs("div",{className:"bg-blue-600/10 p-5 rounded-[2rem] border border-blue-500/20 shadow-inner",children:[e.jsx("p",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest mb-1",children:"ážáŸ’áž›áŸƒážŠáž¹áž€ážŸážšáž»áž” (Total Cost)"}),e.jsxs("p",{className:"text-3xl font-black text-white",children:["$",w.toFixed(2)]})]})]}),e.jsx("div",{className:"pt-4 border-t border-white/5",children:e.jsx("p",{className:"text-[10px] text-gray-600 font-bold italic",children:"ážŸáž¼áž˜áž”áŸ’ážšáž¾áž”áŸŠáž¼ážáž»áž„ážáž¶áž„áž€áŸ’ážšáŸ„áž˜ážŠáž¾áž˜áŸ’áž”áž¸ Copy ážšáž¼áž”áž—áž¶áž– ážšáž½áž…áž™áž€áž‘áŸ… Paste áž€áŸ’áž“áž»áž„ Telegram"})})]}),e.jsxs("div",{className:"mt-8 flex flex-col w-full max-w-md gap-3",children:[e.jsx("button",{onClick:P,className:`py-4 rounded-2xl font-black uppercase tracking-widest text-xs transition-all flex items-center justify-center gap-3 shadow-xl ${o==="success"?"bg-emerald-600 text-white":o==="error"?"bg-red-600 text-white":"bg-white text-black active:scale-95"}`,children:o==="success"?e.jsx(e.Fragment,{children:"âœ… áž”áž¶áž“áž…áž˜áŸ’áž›áž„ážšáž¼áž”áž—áž¶áž– (Copied Image!)"}):o==="error"?e.jsx(e.Fragment,{children:"âŒ áž€áŸ†áž áž»ážŸ (Failed - Downloading Instead)"}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3",strokeLinecap:"round",strokeLinejoin:"round"})}),"áž…áž˜áŸ’áž›áž„ážšáž¼áž”áž—áž¶áž– (Copy Image)"]})}),e.jsx("button",{onClick:()=>g(!1),className:"py-4 bg-gray-800 text-gray-400 font-black uppercase tracking-widest text-xs rounded-2xl border border-white/5 active:scale-95 transition-all",children:"áž€áŸ‚ážŸáž˜áŸ’ážšáž½áž›áž¡áž¾áž„ážœáž·áž‰ (Back & Edit)"})]})]}):e.jsx("div",{className:"min-h-screen bg-[#020617] text-white p-4 sm:p-8 flex flex-col pb-24",children:e.jsxs("div",{className:"max-w-3xl mx-auto w-full space-y-8",children:[e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("h1",{className:"text-4xl font-black italic tracking-tighter uppercase leading-none drop-shadow-2xl",children:"áž”áž‰áŸ’áž‡áž¶áž€áŸ‹ážáŸ’áž›áŸƒážŸáŸážœáž¶ážŠáž¹áž€"}),e.jsx("div",{className:"h-1.5 w-16 bg-blue-600 rounded-full mx-auto"}),e.jsxs("p",{className:"text-blue-400 font-black uppercase tracking-[0.2em] text-[10px]",children:["Delivery Agent Portal | ",u]})]}),e.jsxs("div",{className:"bg-gray-900 border border-white/10 rounded-[3rem] overflow-hidden shadow-2xl relative",children:[e.jsxs("div",{className:"p-5 bg-gray-800/50 border-b border-white/5 flex justify-between items-center px-8",children:[e.jsxs("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-widest",children:["áž”áž‰áŸ’áž‡áž¸áž€áž¶ážšáž€áž˜áŸ’áž˜áž„áŸ‹ (Order List: ",c.length,")"]}),e.jsx("span",{className:"text-[10px] font-black text-blue-400 uppercase",children:"áž€áŸ‚ážŸáž˜áŸ’ážšáž½áž›ážáž¶áž„áž€áŸ’ážšáŸ„áž˜ (Edit Below)"})]}),e.jsx("div",{className:"divide-y divide-white/5",children:c.map((t,s)=>e.jsxs("div",{className:"p-6 flex flex-col sm:flex-row sm:items-center gap-4 hover:bg-white/5 transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-grow min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gray-800 flex items-center justify-center text-[10px] font-black text-gray-500 border border-white/5 group-hover:border-blue-500/30 transition-all",children:s+1}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-black text-white truncate uppercase tracking-tight",children:t["Customer Name"]}),e.jsx("span",{className:"text-xs font-black text-blue-400 font-mono bg-blue-400/10 px-2 py-1 rounded-lg border border-blue-400/20",children:t["Customer Phone"]})]}),e.jsxs("p",{className:"text-xs text-gray-400 font-medium truncate flex items-center gap-1.5",children:[e.jsx("span",{className:"text-blue-500/50",children:"ðŸ“"})," ",t.Location,e.jsx("span",{className:"text-gray-700 mx-1",children:"|"}),e.jsxs("span",{className:"opacity-60",children:["ID: ",t["Order ID"]]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-6 sm:gap-10 border-t border-white/5 sm:border-0 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-600 uppercase tracking-widest mb-1",children:"ážáž˜áŸ’áž›áŸƒáž¢áž¸ážœáŸ‰áž¶áž“áŸ‹ (Total)"}),e.jsxs("p",{className:"text-base font-black text-emerald-400 italic",children:["$",Number(t["Grand Total"]).toFixed(2)]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx("p",{className:"text-[10px] font-black text-blue-500/80 uppercase tracking-widest mb-1.5 ml-1",children:"ážáŸ’áž›áŸƒážŠáž¹áž€ (Ship Cost)"}),e.jsxs("div",{className:"relative group/input",children:[e.jsx("div",{className:"absolute inset-0 bg-blue-500/5 rounded-2xl blur-sm group-focus-within/input:bg-blue-500/10 transition-all"}),e.jsx("span",{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-blue-500/50 text-xs font-black z-10",children:"$"}),e.jsx("input",{type:"number",step:"0.01",value:d[t["Order ID"]]??"",onChange:r=>D(t["Order ID"],r.target.value),className:"relative w-full bg-black/60 border-2 border-white/10 rounded-2xl py-3 pl-8 pr-4 text-right text-base font-black text-blue-400 focus:border-blue-500 focus:bg-black/80 focus:ring-0 transition-all shadow-2xl z-0",placeholder:"0.00"})]})]})]})]},t["Order ID"]))}),e.jsxs("div",{className:"p-8 bg-gray-800/30 border-t border-white/10 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex justify-between items-center px-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-500 uppercase tracking-widest",children:"ážŸážšáž»áž”áž€áž¶ážšáž”áž‰áŸ’áž‡áž¶áž€áŸ‹ (Total Confirmation)"}),e.jsx("span",{className:"text-[8px] font-bold text-gray-600 uppercase",children:"Khmer & English Bilingual View"})]}),e.jsxs("span",{className:"text-4xl font-black text-white tracking-tighter drop-shadow-[0_0_15px_rgba(255,255,255,0.1)] italic",children:["$",w.toFixed(2)]})]}),e.jsx("button",{onClick:E,disabled:f,className:"w-full py-5 bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-500 hover:to-indigo-600 text-white rounded-[2rem] font-black uppercase text-sm tracking-widest shadow-2xl shadow-blue-900/40 active:scale-[0.98] transition-all flex items-center justify-center gap-4 disabled:opacity-50 border border-blue-400/20",children:f?e.jsx(k,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"áž”áž‰áŸ’áž‡áž¼áž“áž€áž¶ážšáž”áž‰áŸ’áž‡áž¶áž€áŸ‹ (Confirm & Send)"}),e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{d:"M5 13l4 4L19 7",strokeLinecap:"round",strokeLinejoin:"round"})})]})})]})]})]})})};export{M as default};
