import{r as s,j as e,S as ge,A as Se,d as ae,W as U,c as ke,R as Ce,f as Te}from"./index-ClNnsHYD.js";import{c as Me}from"./imageCompressor-D5vYYzIg.js";import{U as we}from"./UserAvatar-DrUdbtak.js";import{r as xe,s as pe}from"./notificationUtils-BYVCw5im.js";const Le=["audio/mp4","audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg"],Ae=()=>{const[d,y]=s.useState(!1),n=s.useRef(null),m=s.useRef([]),j=s.useRef("audio/webm");return{isRecording:d,startRecording:async()=>{if(!d)try{const f=await navigator.mediaDevices.getUserMedia({audio:!0}),v=Le.find(g=>MediaRecorder.isTypeSupported(g));if(!v){alert("Your browser does not support any of the required audio recording formats."),console.error("No supported audio MIME types found.");return}j.current=v,console.log(`Using MIME type for recording: ${v}`),n.current=new MediaRecorder(f,{mimeType:v}),m.current=[],n.current.ondataavailable=g=>{m.current.push(g.data)},n.current.onstop=()=>{f.getTracks().forEach(g=>g.stop())},n.current.start(),y(!0)}catch(f){console.error("Error starting audio recording:",f),f instanceof DOMException&&(f.name==="NotAllowedError"||f.name==="PermissionDeniedError")?alert("áž€áž¶ážšáž¢áž“áž»áž‰áŸ’áž‰áž¶ážáž±áŸ’áž™áž”áŸ’ážšáž¾áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“ážáŸ’ážšáž¼ážœáž”áž¶áž“áž”ážŠáž·ážŸáŸáž’áŸ” ážŸáž¼áž˜áž¢áž“áž»áž‰áŸ’áž‰áž¶ážáž±áŸ’áž™áž…áž¼áž›áž”áŸ’ážšáž¾áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“áž“áŸ…áž€áŸ’áž“áž»áž„áž€áž¶ážšáž€áŸ†ážŽážáŸ‹áž€áž˜áŸ’áž˜ážœáž·áž’áž¸ážšáž»áž€ážšáž€ážšáž”ážŸáŸ‹áž¢áŸ’áž“áž€ ážŠáž¾áž˜áŸ’áž”áž¸áž”áŸ’ážšáž¾áž˜áž»ážáž„áž¶ážšáž“áŸáŸ‡áŸ”"):alert("áž˜áž·áž“áž¢áž¶áž…áž…áž¶áž”áŸ‹áž•áŸ’ážáž¾áž˜áž€áž¶ážšážážážŸáŸ†áž¡áŸáž„áž”áž¶áž“áž‘áŸáŸ” ážŸáž¼áž˜áž”áŸ’ážšáž¶áž€ážŠážáž¶áž¢áŸ’áž“áž€áž”áž¶áž“áž—áŸ’áž‡áž¶áž”áŸ‹áž˜áž¸áž€áŸ’ážšáž¼áž áŸ’ážœáž¼áž“ áž áž¾áž™áž”áž¶áž“áž•áŸ’ážáž›áŸ‹áž€áž¶ážšáž¢áž“áž»áž‰áŸ’áž‰áž¶ážáŸ”")}},stopRecording:()=>new Promise(f=>{if(!n.current||!d){f(null);return}n.current.onstop=()=>{const v=new Blob(m.current,{type:j.current});n.current&&n.current.stream.getTracks().forEach(g=>g.stop()),f(v)},n.current.stop(),y(!1)})}},Ue=({src:d,isMe:y=!1})=>{const n=s.useRef(null),[m,j]=s.useState(!1),[C,I]=s.useState(0),[f,v]=s.useState(0),[g,T]=s.useState(!1),[F,R]=s.useState(null),[E]=s.useState(()=>Array.from({length:20},()=>Math.random()*.5+.3));s.useEffect(()=>{const a=n.current;if(!a)return;const w=()=>{a.duration&&isFinite(a.duration)&&(I(a.duration),T(!0),R(null))},p=()=>v(a.currentTime),D=()=>{j(!1),v(0)},W=()=>{console.error("Audio Error",a.error),R("Error playing audio"),T(!1)};return a.addEventListener("loadedmetadata",w),a.addEventListener("canplay",w),a.addEventListener("timeupdate",p),a.addEventListener("ended",D),a.addEventListener("error",W),j(!1),T(!1),v(0),a.load(),()=>{a.removeEventListener("loadedmetadata",w),a.removeEventListener("canplay",w),a.removeEventListener("timeupdate",p),a.removeEventListener("ended",D),a.removeEventListener("error",W)}},[d]);const _=()=>{!g||!n.current||(m?(n.current.pause(),j(!1)):(document.querySelectorAll("audio").forEach(a=>{a!==n.current&&a.pause()}),n.current.play().catch(a=>console.error("Play failed",a)),j(!0)))},$=a=>{if(!isFinite(a)||a<0)return"0:00";const w=Math.floor(a/60),p=Math.floor(a%60);return`${w}:${p<10?"0":""}${p}`};return F?e.jsx("div",{className:"text-[10px] text-red-300 bg-red-900/20 px-2 py-1 rounded",children:"Audio Unavailable"}):e.jsxs("div",{className:`flex items-center gap-3 p-1 rounded-full min-w-[200px] transition-all ${y?"text-white":"text-gray-800 dark:text-white"}`,children:[e.jsx("audio",{ref:n,src:d,preload:"metadata"}),e.jsx("button",{onClick:_,disabled:!g,className:`w-8 h-8 flex items-center justify-center rounded-full shadow-md transition-all active:scale-90 flex-shrink-0 ${y?"bg-white text-blue-600 hover:bg-gray-100":"bg-blue-600 text-white hover:bg-blue-500"}`,children:g?m?e.jsx("svg",{className:"w-3 h-3 fill-current",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}):e.jsx("svg",{className:"w-3 h-3 fill-current ml-0.5",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}):e.jsx(ge,{size:"sm"})}),e.jsxs("div",{className:"flex flex-col flex-grow min-w-0 gap-1",children:[e.jsx("div",{className:"flex items-center gap-[2px] h-4 w-full",children:E.map((a,w)=>{const p=w/E.length<f/(C||1);return e.jsx("div",{className:`w-1 rounded-full transition-all duration-100 ${p?y?"bg-blue-200":"bg-blue-500":y?"bg-blue-800":"bg-gray-600"}`,style:{height:m?`${Math.max(20,a*100*(Math.random()*.5+.8))}%`:`${a*100}%`,opacity:p?1:.5}},w)})}),e.jsx("div",{className:`text-[9px] font-mono font-bold text-right ${y?"text-blue-100":"text-gray-400"}`,children:$(m?f:C)})]})]})},Ie=({users:d,loading:y,onRefresh:n})=>y?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 space-y-3",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Loading members..."})]}):!d||d.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-10 flex flex-col items-center",children:[e.jsx("p",{className:"text-xs uppercase tracking-widest mb-2",children:"(No members found)"}),e.jsx("button",{onClick:n,className:"text-[10px] text-blue-400 hover:text-white underline",children:"Retry Loading"})]}):e.jsx("div",{className:"p-4 space-y-3 animate-fade-in",children:d.map(m=>e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-2xl bg-gray-800/40 border border-white/5 hover:bg-gray-800 transition-colors cursor-default group",children:[e.jsx(we,{avatarUrl:m.ProfilePictureURL,name:m.FullName,size:"md",className:"ring-2 ring-blue-500/20 group-hover:ring-blue-500/50 transition-all"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-black text-white",children:m.FullName}),e.jsxs("p",{className:"text-[10px] text-gray-500 font-mono uppercase tracking-wider",children:["@",m.UserName]})]}),e.jsx("div",{className:"ml-auto flex flex-col items-end gap-1",children:e.jsx("div",{className:`w-2 h-2 rounded-full ${m.IsSystemAdmin?"bg-yellow-500 shadow-[0_0_5px_#eab308]":"bg-blue-500 shadow-[0_0_5px_#3b82f6]"}`})})]},m.UserName))}),$e=Ce.memo(Ue),We=({isOpen:d,onClose:y})=>{const{currentUser:n,appData:m,previewImage:j,setUnreadCount:C,showNotification:I}=s.useContext(Se),f=s.useMemo(()=>n?`chatHistoryCache_${n.UserName}`:null,[n]),{isRecording:v,startRecording:g,stopRecording:T}=Ae(),[F,R]=s.useState(0),E=s.useRef(null),_=s.useRef(new Audio(ae.NOTIFICATION)),$=s.useRef(new Audio(ae.SENT)),[a,w]=s.useState(()=>{if(!f)return[];try{const t=localStorage.getItem(f);return t&&t!=="undefined"?JSON.parse(t):[]}catch{return[]}}),[p,D]=s.useState([]),[W,H]=s.useState(!1),[B,Y]=s.useState(""),[be,ne]=s.useState(!1),[oe,V]=s.useState(!1),[M,ye]=s.useState(()=>localStorage.getItem("chatMuted")==="true"),[J,ie]=s.useState(!1),[ve,q]=s.useState("disconnected"),[L,ce]=s.useState("chat"),le=s.useRef(null),K=s.useRef(null),de=s.useRef(null),G=s.useRef(null),z=s.useRef(d),ue=s.useRef(p),Q=s.useRef(n),X=s.useRef(M);s.useEffect(()=>{ue.current=p},[p]),s.useEffect(()=>{Q.current=n},[n]),s.useEffect(()=>{X.current=M},[M]),s.useEffect(()=>{z.current=d},[d]);const Z=s.useCallback(async()=>{if(m.users&&m.users.length>0){D(m.users),H(!1);return}H(!0);try{const r=await(await fetch(`${U}/api/users`)).json();r.status==="success"&&Array.isArray(r.data)&&D(r.data)}catch(t){console.warn("Fallback user fetch failed",t)}finally{H(!1)}},[m.users]);s.useEffect(()=>{Z()},[Z]),s.useEffect(()=>{d&&C(0)},[d,C]),s.useEffect(()=>{xe()},[]);const Ne=async()=>{await g(),R(0),E.current=setInterval(()=>{R(t=>t+1)},1e3)},je=async()=>{await T(),E.current&&clearInterval(E.current),R(0)},Re=async()=>{E.current&&clearInterval(E.current),V(!0);try{const t=await T();if(!t)throw new Error("No audio captured");const r=new FileReader;r.readAsDataURL(t),r.onloadend=async()=>{const i=r.result.split(",")[1];try{const c=await fetch(`${U}/api/upload-image`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileData:i,fileName:`voice_${Date.now()}.webm`,mimeType:"audio/webm",userName:(n==null?void 0:n.UserName)||"unknown"})}),l=await c.json();if(!c.ok||l.status!=="success")throw new Error(l.message||"Audio upload failed");let b=l.fileId||l.id;if(!b&&l.url){const h=l.url.match(/(?:d\/|id=)([^/?&]+)/);h&&h[1]&&(b=h[1])}if(!b)throw console.error("Could not determine FileID from upload result:",l),new Error("Failed to get File ID");const S=me(F);await O(S,"audio",b)}catch(c){console.error("Audio Upload Workflow Failed",c),alert("áž€áž¶ážšáž”áž‰áŸ’áž‡áž¼áž“ážŸáž˜áŸ’áž›áŸáž„áž”ážšáž¶áž‡áŸáž™ (Failed to upload audio).")}finally{V(!1),R(0)}}}catch(t){console.error("Recording Error",t),V(!1),R(0)}},me=t=>{const r=Math.floor(t/60),o=t%60;return`${r}:${o<10?"0":""}${o}`},ee=s.useCallback(t=>{w(r=>{const o=typeof t=="function"?t(r):t;return f&&localStorage.setItem(f,JSON.stringify(o)),o})},[f]),te=s.useCallback(t=>{const r=ue.current.find(c=>c.UserName===t.UserName),o=(t.MessageType||"text").toLowerCase();let i=t.Content;return o==="audio"&&t.FileID?i=`${U}/api/chat/audio/${t.FileID}`:o==="image"&&(i=ke(t.Content)),{id:t.Timestamp,user:t.UserName,fullName:(r==null?void 0:r.FullName)||t.UserName,avatar:(r==null?void 0:r.ProfilePictureURL)||"",content:i,timestamp:t.Timestamp,type:o,fileID:t.FileID,isOptimistic:!1}},[]),se=s.useCallback(async()=>{if(z.current){a.length===0&&ie(!0);try{const t=await fetch(`${U}/api/chat/messages`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();if(r.status==="success"){const o=r.data.map(te);ee(o.sort((i,c)=>new Date(i.timestamp).getTime()-new Date(c.timestamp).getTime()))}}catch{console.warn("Chat history service unavailable")}finally{ie(!1)}}},[te,ee,a.length]),re=(t="smooth")=>{K.current&&K.current.scrollIntoView({behavior:t})};s.useEffect(()=>{const t=window.location.protocol==="https:"?"wss":"ws",r=U.replace(/^https?:\/\//,""),o=`${t}://${r}/api/chat/ws`,i=()=>{var l;if(((l=G.current)==null?void 0:l.readyState)===WebSocket.OPEN)return;q("connecting");const c=new WebSocket(o);G.current=c,c.onopen=()=>{q("connected"),z.current&&se()},c.onclose=()=>{q("disconnected"),setTimeout(i,3e3)},c.onmessage=b=>{var S;try{const h=JSON.parse(b.data);if(h.action==="new_message"){const u=h.payload,A=u.UserName===((S=Q.current)==null?void 0:S.UserName),fe=u.Content&&u.Content.includes("ðŸ“¢ NEW ORDER:"),he=u.Content&&u.Content.includes("ðŸ“¢ SYSTEM_ALERT:");if(fe||he){let x=u.Content;fe?x=u.Content.replace("ðŸ“¢ NEW ORDER:","").trim():he&&(x=u.Content.replace("ðŸ“¢ SYSTEM_ALERT:","").trim()),console.log("ðŸ”” SYSTEM ALERT RECEIVED via WS:",x),I(x,"success"),X.current||new Audio(ae.NOTIFICATION).play().catch(N=>console.warn("Audio play failed",N)),pe("áž€áž¶ážšáž€áž˜áŸ’áž˜áž„áŸ‹ážáŸ’áž˜áž¸ ðŸ“¦",x)}else if(!A){const x=u.FullName||u.UserName;let k=u.Content;u.MessageType==="Image"?k="ðŸ“· Sent an image":u.MessageType==="Audio"&&(k="ðŸŽ¤ Sent a voice message"),I(`${x}: ${k}`,"info"),document.hidden&&pe(x,k)}const P=te(u);ee(x=>{if(x.some(N=>N.id===P.id))return x;const k=x.findIndex(N=>N.isOptimistic&&N.user===P.user&&N.type===P.type);if(k!==-1){const N=[...x];return N[k]=P,N}return[...x,P]}),setTimeout(()=>re("smooth"),100),A||(z.current||C(x=>x+1),!X.current&&!u.Content.includes("SYSTEM_ALERT")&&(_.current.currentTime=0,_.current.play().catch(()=>{})))}}catch(h){console.error("WS Message Error",h)}}};return i(),()=>{var c;(c=G.current)==null||c.close()}},[]),s.useEffect(()=>{d&&se()},[d,se]),s.useEffect(()=>{if(!d||L!=="chat"||J)return;const t=de.current;if(t){const{scrollTop:r,scrollHeight:o,clientHeight:i}=t,c=o-r-i<250,l=a[a.length-1],b=(l==null?void 0:l.user)===(n==null?void 0:n.UserName);(b||l!=null&&l.isOptimistic||c||r===0)&&re(r===0&&!b?"auto":"smooth")}else re("auto")},[a,d,L,J]);const O=async(t,r,o)=>{if(!t&&r==="text")return;const i=Q.current;if(!i){alert("Please login to send messages.");return}const c=Date.now().toString();let l=t;r==="image"&&!t.startsWith("http")&&!t.startsWith("data:")&&(l=`data:image/jpeg;base64,${t}`);const b={id:c,user:i.UserName||"Unknown",fullName:i.FullName||"Me",avatar:i.ProfilePictureURL||"",content:l,timestamp:new Date().toISOString(),type:r,fileID:o,isOptimistic:!0};w(h=>[...h,b]),r==="text"&&Y("");const S=r.charAt(0).toUpperCase()+r.slice(1);try{const h={userName:i.UserName,UserName:i.UserName,type:S,MessageType:S,content:t.trim(),Content:t.trim()};o&&(h.FileID=o,h.fileId=o);const u=await fetch(`${U}/api/chat/send`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!u.ok){const A=await u.text();throw new Error(`Server returned ${u.status}: ${A}`)}M||($.current.currentTime=0,$.current.play().catch(()=>{}))}catch(h){console.error("Send Error:",h),w(u=>u.filter(A=>A.id!==c)),r==="text"&&Y(t),alert("áž€áž¶ážšáž”áž‰áŸ’áž‡áž¼áž“ážŸáž¶ážšáž”ážšáž¶áž‡áŸáž™ (Send Failed). Please try again.")}},Ee=async t=>{ne(!0);try{const r=await Me(t),o=await Te(r);await O(o,"image")}finally{ne(!1)}};return e.jsxs("div",{className:`chat-widget-container ${d?"":"closed"}`,children:[e.jsxs("div",{className:"chat-header",children:[e.jsxs("div",{className:"title-group flex items-center gap-2",children:[e.jsx("div",{className:`connection-status w-3 h-3 rounded-full ${ve==="connected"?"bg-green-500 shadow-[0_0_10px_#22c55e]":"bg-yellow-500 animate-pulse"}`}),e.jsx("h3",{className:"font-black text-white uppercase tracking-wider text-sm",children:"Team Chat"})]}),e.jsxs("div",{className:"controls flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{const t=!M;ye(t),localStorage.setItem("chatMuted",String(t)),t||xe().then(r=>{r&&console.log("Notification permission granted via toggle")})},className:"p-2 hover:bg-white/10 rounded-full transition-colors text-gray-400 hover:text-white",children:M?"ðŸ”‡":"ðŸ””"}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-red-500/20 hover:text-red-400 rounded-full transition-colors text-gray-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsxs("div",{className:"chat-tabs bg-gray-900/50 p-1",children:[e.jsx("button",{onClick:()=>ce("chat"),className:`text-xs font-bold uppercase tracking-wider transition-all ${L==="chat"?"active bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:"Chat Stream"}),e.jsx("button",{onClick:()=>ce("users"),className:`text-xs font-bold uppercase tracking-wider transition-all ${L==="users"?"active bg-blue-600 text-white shadow-lg":"text-gray-500 hover:text-gray-300"}`,children:"Members"})]}),e.jsx("div",{className:"chat-body custom-scrollbar bg-[#0f172a] relative",ref:de,children:L==="chat"?e.jsxs("div",{className:"chat-messages p-4 space-y-6 min-h-full",children:[J?e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 space-y-3",children:[e.jsx(ge,{size:"md"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Loading history..."})]}):a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center opacity-50",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-gray-500",children:"No messages yet"}),e.jsx("p",{className:"text-[10px] text-gray-600 mt-1",children:"Start the conversation!"})]}):a.map((t,r)=>{const o=t.user===(n==null?void 0:n.UserName),i=p.find(b=>b.UserName===t.user),c=r===0||a[r-1].user!==t.user,l=t.content.includes("SYSTEM_ALERT")||t.content.includes("NEW ORDER");return e.jsx("div",{className:`flex flex-col ${o?"items-end":"items-start"} animate-fade-in-up`,children:l?e.jsx("div",{className:"w-full flex justify-center my-2",children:e.jsx("div",{className:"bg-blue-900/40 border border-blue-500/30 rounded-xl px-4 py-2 text-[10px] font-bold text-blue-300 text-center shadow-lg",children:t.content.replace("ðŸ“¢ SYSTEM_ALERT:","").replace("ðŸ“¢ NEW ORDER:","").trim()})}):e.jsxs("div",{className:`flex max-w-[85%] gap-3 ${o?"flex-row-reverse":""}`,children:[e.jsx("div",{className:"flex-shrink-0 w-8 flex flex-col justify-end",children:c?e.jsx(we,{avatarUrl:(i==null?void 0:i.ProfilePictureURL)||t.avatar,name:(i==null?void 0:i.FullName)||t.fullName,size:"sm",className:"ring-2 ring-white/10"}):e.jsx("div",{className:"w-8"})}),e.jsxs("div",{className:`relative px-4 py-3 shadow-lg ${o?"bg-blue-600 text-white rounded-2xl rounded-tr-sm":"bg-gray-800 text-gray-200 rounded-2xl rounded-tl-sm border border-white/5"} ${t.isOptimistic?"opacity-70":""}`,children:[!o&&c&&e.jsx("p",{className:"text-[10px] font-black text-blue-400 mb-1 uppercase tracking-wider",children:(i==null?void 0:i.FullName)||t.fullName}),t.type==="text"&&e.jsx("p",{className:"leading-relaxed text-sm whitespace-pre-wrap",children:t.content}),t.type==="image"&&e.jsx("img",{src:t.content,className:"rounded-xl max-w-full cursor-pointer hover:opacity-90 transition-opacity border border-black/20",onClick:()=>j(t.content),alt:"attachment"}),t.type==="audio"&&e.jsx($e,{src:t.content,isMe:o}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1.5",children:[e.jsx("p",{className:`text-[9px] font-medium ${o?"text-blue-200":"text-gray-500"}`,children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.isOptimistic&&e.jsxs("svg",{className:"w-3 h-3 text-white/50 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})]})]})]})},t.id+r)}),e.jsx("div",{ref:K})]}):e.jsx(Ie,{users:p,loading:W,onRefresh:Z})}),L==="chat"&&e.jsxs("div",{className:"p-3 bg-gray-900 border-t border-gray-800",children:[v?e.jsxs("div",{className:"flex items-center gap-3 bg-red-900/20 p-2 rounded-2xl border border-red-500/30 animate-pulse relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-20 pointer-events-none gap-1",children:[...Array(10)].map((t,r)=>e.jsx("div",{className:"w-1 bg-red-500 rounded-full animate-bounce",style:{height:`${Math.random()*80+20}%`,animationDuration:`${Math.random()*.5+.5}s`}},r))}),e.jsx("div",{className:"w-10 h-10 flex items-center justify-center bg-red-600 rounded-full shadow-lg shadow-red-600/40 relative z-10",children:e.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-ping"})}),e.jsxs("div",{className:"flex-grow text-center relative z-10",children:[e.jsx("p",{className:"text-red-400 font-black text-lg font-mono tracking-widest",children:me(F)}),e.jsx("p",{className:"text-[8px] text-red-500 font-bold uppercase tracking-wider",children:"Recording..."})]}),e.jsxs("div",{className:"flex gap-2 relative z-10",children:[e.jsx("button",{onClick:je,className:"p-2.5 bg-gray-800 text-gray-400 hover:text-white rounded-xl hover:bg-gray-700 transition-all active:scale-95 border border-white/5",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("button",{onClick:Re,className:"p-2.5 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-500 transition-all active:scale-95 border border-blue-500/50",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})]}):e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{onClick:()=>{var t;return(t=le.current)==null?void 0:t.click()},className:"p-3 text-gray-400 hover:text-blue-400 hover:bg-gray-800 rounded-xl transition-all",title:"Attach Image",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h14a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("input",{type:"file",ref:le,className:"hidden",accept:"image/*",onChange:t=>t.target.files&&Ee(t.target.files[0])}),e.jsx("div",{className:"flex-grow relative",children:e.jsx("textarea",{value:B,onChange:t=>Y(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),O(B,"text"))},placeholder:"Type a message...",className:"w-full bg-gray-800 text-white rounded-2xl py-3 pl-4 pr-10 border-transparent focus:border-blue-500 focus:ring-0 resize-none text-sm max-h-24 custom-scrollbar",rows:1,style:{minHeight:"44px"}})}),B.trim()?e.jsx("button",{onClick:()=>O(B,"text"),className:"p-3 bg-blue-600 text-white rounded-xl shadow-lg shadow-blue-600/20 active:scale-95 transition-all hover:bg-blue-500",children:e.jsx("svg",{className:"w-5 h-5 transform rotate-90",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})}):e.jsx("button",{onClick:Ne,disabled:oe,className:"p-3 bg-gray-800 text-white rounded-xl border border-gray-700 hover:bg-red-500/20 hover:border-red-500/50 hover:text-red-500 transition-all active:scale-95 group",children:e.jsx("svg",{className:"w-5 h-5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})})]}),(be||oe)&&e.jsx("div",{className:"absolute inset-x-0 bottom-full bg-blue-600/90 text-white text-[10px] font-black uppercase tracking-widest text-center py-1",children:"Processing Transfer..."})]})]})};export{We as default};
